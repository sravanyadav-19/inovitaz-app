Project Structure for: inovitaz-app


================================================
FILE: backend\.env.example
================================================
ï»¿# ============================================
# .env.example - Template for environment variables
# Copy this file to .env and fill with your actual values
# ============================================

# Server Configuration
PORT=4000
NODE_ENV=development

# Database Configuration
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=Sravan@7152
DB_NAME=inovitaz_db

# JWT Configuration
# Generate a random 64-character string for production
# You can use: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_SECRET=3d3bd3d74226170d7f35f997ed922aebd5bb5a03fb49e1ab44678857e5ac98242152c72a62b2e9fd9ecf266ed8507a1b707de2369536179a753296911c26dd9c
JWT_EXPIRES_IN=7d

# Razorpay Payment Gateway
# Get from: https://dashboard.razorpay.com/app/keys
RAZORPAY_KEY_ID=rzp_test_RlFEjpvvWRfnjI
RAZORPAY_KEY_SECRET=21dFuxIEh0aqHnF28lNf4wGB

# Frontend URL (for CORS)
FRONTEND_URL=http://localhost:5173


================================================
FILE: backend\.gitignore
================================================
ï»¿# Dependencies
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Environment variables
.env
.env.local
.env.production

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Uploads
uploads/
*.log

# Build
dist/
build/


================================================
FILE: backend\package.json
================================================
{
  "name": "inovitaz-backend",
  "version": "1.0.0",
  "description": "Inovitaz - IoT Project Selling Platform Backend",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "setup-db": "node scripts/setup-db.js"
  },
  "dependencies": {
    "bcrypt": "^6.0.0",
    "bcryptjs": "^2.4.3",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "express-validator": "^7.0.1",
    "jsonwebtoken": "^9.0.2",
    "multer": "^1.4.5-lts.1",
    "mysql2": "^3.6.5",
    "razorpay": "^2.9.2",
    "uuid": "^9.0.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.2"
  }
}



================================================
FILE: backend\scripts\setup-db.js
================================================
const mysql = require('mysql2/promise');
const bcrypt = require('bcryptjs');
require('dotenv').config();

const setupDatabase = async () => {
  let connection;

  try {
    // Connect without database first
    connection = await mysql.createConnection({
      host: process.env.DB_HOST || 'localhost',
      port: process.env.DB_PORT || 3306,
      user: process.env.DB_USER || 'root',
      password: process.env.DB_PASSWORD || '',
      multipleStatements: true,
    });

    console.log('Connected to MySQL server');

    const dbName = process.env.DB_NAME || 'inovitaz';

    // Create database if not exists
    await connection.query(`CREATE DATABASE IF NOT EXISTS \`${dbName}\``);
    console.log(`Database '${dbName}' created/verified`);

    // Select the database
    await connection.query(`USE \`${dbName}\``);

    // DROP old tables so schema is guaranteed correct (DEV ONLY)
    await connection.query('SET FOREIGN_KEY_CHECKS = 0');
    await connection.query('DROP TABLE IF EXISTS orders');
    await connection.query('DROP TABLE IF EXISTS projects');
    await connection.query('DROP TABLE IF EXISTS users');
    await connection.query('SET FOREIGN_KEY_CHECKS = 1');
    console.log('Old tables dropped (users, projects, orders)');

    // Create Users table
    await connection.query(`
      CREATE TABLE IF NOT EXISTS users (
        id INT AUTO_INCREMENT PRIMARY KEY,
        email VARCHAR(255) NOT NULL UNIQUE,
        password VARCHAR(255) NOT NULL,
        name VARCHAR(100) NOT NULL,
        role ENUM('user', 'admin') DEFAULT 'user',
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        INDEX idx_email (email),
        INDEX idx_role (role)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
    `);
    console.log('Users table created/verified');

    // Create Projects table
    await connection.query(`
      CREATE TABLE IF NOT EXISTS projects (
        id INT AUTO_INCREMENT PRIMARY KEY,
        title VARCHAR(255) NOT NULL,
        description TEXT NOT NULL,
        price DECIMAL(10, 2) NOT NULL,
        thumbnail VARCHAR(500),
        content_url VARCHAR(500),
        category VARCHAR(100) DEFAULT 'IoT',
        features JSON,
        tech_stack JSON,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        INDEX idx_category (category),
        INDEX idx_price (price)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
    `);
    console.log('Projects table created/verified');

    // Create Orders table
    await connection.query(`
      CREATE TABLE IF NOT EXISTS orders (
        id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT NOT NULL,
        project_id INT NOT NULL,
        razorpay_order_id VARCHAR(100),
        razorpay_payment_id VARCHAR(100),
        amount DECIMAL(10, 2) NOT NULL,
        status ENUM('pending', 'paid', 'failed', 'refunded') DEFAULT 'pending',
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
        FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
        INDEX idx_user_id (user_id),
        INDEX idx_project_id (project_id),
        INDEX idx_status (status),
        INDEX idx_razorpay_order_id (razorpay_order_id)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
    `);
    console.log('Orders table created/verified');

    // Create admin user if not exists
    const adminEmail = 'admin@inovitaz.com';
    const [existingAdmin] = await connection.query(
      'SELECT id FROM users WHERE email = ?',
      [adminEmail]
    );

    if (existingAdmin.length === 0) {
      const hashedPassword = await bcrypt.hash('admin123', 12);
      await connection.query(
        `INSERT INTO users (email, password, name, role) VALUES (?, ?, ?, 'admin')`,
        [adminEmail, hashedPassword, 'Admin User']
      );
      console.log('Admin user created (admin@inovitaz.com / admin123)');
    }

    // Insert sample projects if none exist
    const [existingProjects] = await connection.query(
      'SELECT COUNT(*) as count FROM projects'
    );

    if (existingProjects[0].count === 0) {
      const sampleProjects = [
        {
          title: 'Smart Home Automation System',
          description:
            'Complete IoT-based home automation system with mobile app control. Features include smart lighting, temperature control, security monitoring, and voice assistant integration. Built with ESP32, MQTT protocol, and React Native mobile app.',
          price: 2499.0,
          thumbnail:
            'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400',
          content_url: 'https://example.com/downloads/smart-home.zip',
          category: 'IoT',
          features: JSON.stringify([
            'ESP32-based controller',
            'React Native mobile app',
            'MQTT protocol',
            'Voice assistant integration',
            'Real-time monitoring',
            'Energy usage tracking',
          ]),
          tech_stack: JSON.stringify([
            'ESP32',
            'MQTT',
            'React Native',
            'Node.js',
            'MongoDB',
          ]),
        },
        {
          title: 'IoT Weather Monitoring Station',
          description:
            'Advanced weather monitoring system with real-time data visualization. Includes temperature, humidity, pressure, wind speed, and rainfall sensors. Features cloud data storage and web dashboard.',
          price: 1799.0,
          thumbnail:
            'https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=400',
          content_url: 'https://example.com/downloads/weather-station.zip',
          category: 'IoT',
          features: JSON.stringify([
            'Multiple sensor integration',
            'Real-time data visualization',
            'Historical data analysis',
            'Weather prediction',
            'Mobile alerts',
            'Solar powered option',
          ]),
          tech_stack: JSON.stringify([
            'Arduino',
            'ESP8266',
            'InfluxDB',
            'Grafana',
            'Python',
          ]),
        },
        {
          title: 'Automatic Plant Watering System',
          description:
            'Smart irrigation system for home gardens and farms. Automatically monitors soil moisture and waters plants based on requirements. Includes mobile app for remote monitoring and control.',
          price: 1299.0,
          thumbnail:
            'https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=400',
          content_url: 'https://example.com/downloads/plant-watering.zip',
          category: 'IoT',
          features: JSON.stringify([
            'Soil moisture sensing',
            'Automatic watering schedule',
            'Water level monitoring',
            'Mobile app control',
            'Multiple zone support',
            'Water usage analytics',
          ]),
          tech_stack: JSON.stringify([
            'ESP32',
            'Flutter',
            'Firebase',
            'Soil Sensors',
          ]),
        },
        {
          title: 'Smart Energy Meter',
          description:
            'IoT-based energy monitoring system for homes and offices. Track real-time energy consumption, get usage analytics, and receive alerts for unusual consumption patterns.',
          price: 1999.0,
          thumbnail:
            'https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?w=400',
          content_url: 'https://example.com/downloads/energy-meter.zip',
          category: 'IoT',
          features: JSON.stringify([
            'Real-time consumption tracking',
            'Cost estimation',
            'Usage analytics',
            'Anomaly detection',
            'Bill prediction',
            'Multi-device support',
          ]),
          tech_stack: JSON.stringify([
            'ESP32',
            'Current Sensors',
            'React',
            'PostgreSQL',
            'Redis',
          ]),
        },
        {
          title: 'Vehicle GPS Tracking System',
          description:
            'Complete vehicle tracking solution with real-time location, speed monitoring, and geofencing. Includes web dashboard and mobile app for fleet management.',
          price: 2999.0,
          thumbnail:
            'https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?w=400',
          content_url: 'https://example.com/downloads/gps-tracker.zip',
          category: 'IoT',
          features: JSON.stringify([
            'Real-time GPS tracking',
            'Speed monitoring',
            'Geofencing alerts',
            'Route history',
            'Fuel monitoring',
            'Driver behavior analysis',
          ]),
          tech_stack: JSON.stringify([
            'ESP32',
            'GPS Module',
            'React',
            'Node.js',
            'MongoDB',
            'Google Maps API',
          ]),
        },
      ];

      for (const project of sampleProjects) {
        await connection.query(
          `INSERT INTO projects (title, description, price, thumbnail, content_url, category, features, tech_stack) 
           VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
          [
            project.title,
            project.description,
            project.price,
            project.thumbnail,
            project.content_url,
            project.category,
            project.features,
            project.tech_stack,
          ]
        );
      }
      console.log(`${sampleProjects.length} sample projects inserted`);
    }

    console.log('\nâœ… Database setup completed successfully!');
    console.log('\nAdmin credentials:');
    console.log('Email: admin@inovitaz.com');
    console.log('Password: admin123');
  } catch (error) {
    console.error('âŒ Database setup failed:', error.message);
    process.exit(1);
  } finally {
    if (connection) {
      await connection.end();
    }
  }
};

setupDatabase();


================================================
FILE: backend\server.js
================================================
ï»¿// server.js
const express = require('express');
const cors = require('cors');
const path = require('path');
const os = require('os');
require('dotenv').config();

// Fix MaxListeners warning
const EventEmitter = require('events');
EventEmitter.defaultMaxListeners = 15;

// Import routes
const authRoutes = require('./src/routes/auth.routes');
const projectRoutes = require('./src/routes/project.routes');
const paymentRoutes = require('./src/routes/payment.routes');
const adminRoutes = require('./src/routes/admin.routes');
const orderRoutes = require('./src/routes/order.routes');
const couponRoutes = require('./src/routes/coupon.routes');
const reviewRoutes = require('./src/routes/review.routes');
const wishlistRoutes = require('./src/routes/wishlist.routes');

// Import database connection
const db = require('./src/config/db');

const app = express();
const PORT = process.env.PORT || 4000;

// Helper: Get network IP (Only used for local development)
const getNetworkIP = () => {
  const interfaces = os.networkInterfaces();
  for (const name of Object.keys(interfaces)) {
    for (const iface of interfaces[name]) {
      if (iface.family === 'IPv4' && !iface.internal) {
        return iface.address;
      }
    }
  }
  return 'localhost';
};

// Middleware - CORS Configuration
// This is critical for connecting your Frontend to this Backend
const allowedOrigins = [
  'http://localhost:5173',      // Vite Localhost
  'http://127.0.0.1:5173',      // IP Localhost
  process.env.FRONTEND_URL      // Your Render Frontend URL (e.g., https://inovitaz.onrender.com)
];

// Add local network IP only if we are NOT in production
if (process.env.NODE_ENV !== 'production') {
  const networkIP = getNetworkIP();
  allowedOrigins.push(`http://${networkIP}:5173`);
}

app.use(cors({
  origin: function (origin, callback) {
    // Allow requests with no origin (like mobile apps or curl requests)
    if (!origin) return callback(null, true);
    
    // Check if the origin is in our allowed list
    if (allowedOrigins.indexOf(origin) !== -1 || !process.env.NODE_ENV) {
      // !process.env.NODE_ENV means "if development, allow everything"
      return callback(null, true);
    } else {
      console.log('Blocked by CORS:', origin); // Log blocked attempts for debugging
      return callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Static files (Note: On Render Free Tier, these files disappear after restart)
app.use('/uploads', express.static(path.join(__dirname, 'uploads')));

// Health check
app.get('/api/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    message: 'Inovitaz API is running',
    environment: process.env.NODE_ENV || 'development',
    timestamp: new Date().toISOString()
  });
});

// API Routes
app.use('/api/auth', authRoutes);
app.use('/api/projects', projectRoutes);
app.use('/api/payment', paymentRoutes);
app.use('/api/admin', adminRoutes);
app.use('/api/orders', orderRoutes);
app.use('/api/coupons', couponRoutes);
app.use('/api/reviews', reviewRoutes);
app.use('/api/wishlist', wishlistRoutes);

// 404 handler
app.use((req, res) => {
  res.status(404).json({
    success: false,
    message: 'API endpoint not found'
  });
});

// Error handler
app.use((err, req, res, next) => {
  console.error('SERVER ERROR:', err); // Better logging for cloud
  res.status(err.status || 500).json({
    success: false,
    message: err.message || 'Internal server error'
  });
});

// Start server
const startServer = async () => {
  try {
    // Test Database Connection
    await db.testConnection();
    console.log('âœ… Database connected successfully');
    
    // Bind to 0.0.0.0 is REQUIRED for Render
    app.listen(PORT, "0.0.0.0", () => {
      console.log(`\nðŸš€ Inovitaz Backend Server Started`);
      console.log(`âžœ  Port: ${PORT}`);
      console.log(`âžœ  Environment: ${process.env.NODE_ENV || 'development'}`);
    });
  } catch (error) {
    console.error('âŒ Failed to start server:', error.message);
    process.exit(1);
  }
};

startServer();

module.exports = app;


================================================
FILE: backend\sql\schema.sql
================================================
ï»¿-- sql/schema.sql
-- ============================================
-- Inovitaz Database Schema - Complete Version
-- ============================================

CREATE DATABASE IF NOT EXISTS inovitaz_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE inovitaz_db;

-- ============================================
-- DROP ALL TABLES IN CORRECT ORDER
-- ============================================

SET FOREIGN_KEY_CHECKS = 0;

DROP TABLE IF EXISTS coupon_usage;
DROP TABLE IF EXISTS download_logs;
DROP TABLE IF EXISTS wishlist;
DROP TABLE IF EXISTS reviews;
DROP TABLE IF EXISTS coupons;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS payments;  -- Old table
DROP TABLE IF EXISTS projects;
DROP TABLE IF EXISTS users;

-- Drop views if exist
DROP VIEW IF EXISTS project_stats;
DROP VIEW IF EXISTS user_purchases;

-- Drop triggers if exist
DROP TRIGGER IF EXISTS update_project_rating_after_review;
DROP TRIGGER IF EXISTS update_project_rating_after_review_update;
DROP TRIGGER IF EXISTS update_project_rating_after_review_delete;
DROP TRIGGER IF EXISTS increment_coupon_usage;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- CORE TABLES
-- ============================================

-- Users Table
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  role ENUM('user', 'admin') DEFAULT 'user',
  name VARCHAR(255),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_email (email),
  INDEX idx_role (role)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Projects Table (ENHANCED)
CREATE TABLE projects (
  id INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  price INT NOT NULL DEFAULT 49900, -- price in paise (â‚¹499)
  thumbnail VARCHAR(512),
  content_url VARCHAR(1024),
  category VARCHAR(100) DEFAULT 'IoT',
  difficulty ENUM('Beginner', 'Intermediate', 'Advanced') DEFAULT 'Beginner',
  average_rating DECIMAL(3, 2) DEFAULT 0.00,
  reviews_count INT DEFAULT 0,
  features TEXT, -- JSON array
  tech_stack TEXT, -- JSON array
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_category (category),
  INDEX idx_difficulty (difficulty),
  INDEX idx_rating (average_rating),
  INDEX idx_price (price),
  FULLTEXT idx_search (title, description)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Orders Table (ENHANCED)
CREATE TABLE orders (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  project_id INT NOT NULL,
  razorpay_order_id VARCHAR(255),
  razorpay_payment_id VARCHAR(255),
  amount INT NOT NULL,
  original_amount INT DEFAULT NULL, -- amount before discount
  discount_amount INT DEFAULT 0,
  coupon_code VARCHAR(50) DEFAULT NULL,
  currency VARCHAR(10) DEFAULT 'INR',
  status ENUM('created', 'paid', 'failed') DEFAULT 'created',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  INDEX idx_user (user_id),
  INDEX idx_project (project_id),
  INDEX idx_status (status),
  INDEX idx_razorpay_order (razorpay_order_id),
  INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- NEW FEATURE TABLES
-- ============================================

-- Coupons Table
CREATE TABLE coupons (
  id INT AUTO_INCREMENT PRIMARY KEY,
  code VARCHAR(50) UNIQUE NOT NULL,
  description VARCHAR(255),
  discount_type ENUM('percentage', 'fixed') NOT NULL,
  discount_value DECIMAL(10, 2) NOT NULL,
  min_purchase_amount INT DEFAULT 0, -- in paise
  max_discount_amount INT DEFAULT NULL, -- in paise
  usage_limit INT DEFAULT NULL,
  used_count INT DEFAULT 0,
  valid_from DATETIME DEFAULT CURRENT_TIMESTAMP,
  valid_until DATETIME DEFAULT NULL,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_code (code),
  INDEX idx_active (is_active),
  INDEX idx_valid_until (valid_until)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Reviews Table
CREATE TABLE reviews (
  id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  user_id INT NOT NULL,
  order_id INT NOT NULL,
  rating INT NOT NULL CHECK (rating BETWEEN 1 AND 5),
  comment TEXT,
  is_verified_purchase BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
  UNIQUE KEY unique_user_project_review (user_id, project_id),
  INDEX idx_project (project_id),
  INDEX idx_user (user_id),
  INDEX idx_rating (rating),
  INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Wishlist Table
CREATE TABLE wishlist (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  project_id INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  UNIQUE KEY unique_user_project (user_id, project_id),
  INDEX idx_user (user_id),
  INDEX idx_project (project_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Download Logs Table
CREATE TABLE download_logs (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  project_id INT NOT NULL,
  order_id INT NOT NULL,
  download_count INT DEFAULT 0,
  max_downloads INT DEFAULT 5,
  expiry_date DATETIME NOT NULL,
  last_downloaded_at TIMESTAMP NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
  UNIQUE KEY unique_user_project_order (user_id, project_id, order_id),
  INDEX idx_user_project (user_id, project_id),
  INDEX idx_expiry (expiry_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Coupon Usage Table
CREATE TABLE coupon_usage (
  id INT AUTO_INCREMENT PRIMARY KEY,
  coupon_id INT NOT NULL,
  user_id INT NOT NULL,
  order_id INT NOT NULL,
  discount_amount INT NOT NULL, -- in paise
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (coupon_id) REFERENCES coupons(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
  INDEX idx_coupon (coupon_id),
  INDEX idx_user (user_id),
  INDEX idx_order (order_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- SEED DATA
-- ============================================

-- Admin User (password: admin123)
INSERT INTO users (email, password, role, name) VALUES
('admin@local', '$2a$10$7u7f5H1nG6l1y3P0/1qXfuVwYvX5bKf/7dTq9C3k8WqJp3yHqGqW6', 'admin', 'Admin User');

-- Sample Projects (ENHANCED)
INSERT INTO projects (title, description, price, category, difficulty, thumbnail, features, tech_stack) VALUES
(
  'Automated Plant Watering System',
  '{"overview": "Soil moisture-based irrigation with mobile monitoring. Complete guide with circuit diagrams and code.", "components": "Arduino Uno\nSoil Moisture Sensor\nWater Pump\nRelay Module\nJumper Wires", "circuitText": "Connect soil moisture sensor to A0 pin. Relay to pin 7. Power supply 5V.", "steps": "1. Assemble circuit\n2. Upload code\n3. Calibrate sensor\n4. Test system", "download_url": "https://drive.google.com/file/d/example"}',
  49900,
  'IoT',
  'Beginner',
  'https://images.unsplash.com/photo-1466692476868-aef1dfb1e735?w=400',
  '["Automatic Watering", "Soil Monitoring", "Mobile Alerts"]',
  '["Arduino", "C++", "IoT"]'
),
(
  'IoT Weather Monitoring Station',
  '{"overview": "Real-time weather monitoring with cloud-based dashboard and docs.", "components": "ESP32\nDHT22 Sensor\nBMP280 Sensor\nOLED Display", "circuitText": "DHT22 to GPIO 4, BMP280 to I2C pins, OLED to I2C", "steps": "1. Wire components\n2. Configure WiFi\n3. Deploy to cloud\n4. Setup dashboard", "download_url": "https://drive.google.com/file/d/example2"}',
  49900,
  'IoT',
  'Intermediate',
  'https://images.unsplash.com/photo-1592210454359-9043f067919b?w=400',
  '["Cloud Integration", "Real-time Data", "Mobile Dashboard"]',
  '["ESP32", "Arduino", "ThingSpeak"]'
),
(
  'Smart Home Automation System',
  '{"overview": "Complete IoT home automation with mobile control and docs.", "components": "NodeMCU\n4 Channel Relay\nIR Sensor\nLEDs\nBreadboard", "circuitText": "Relay channels to D1-D4 pins. IR sensor to D5.", "steps": "1. Setup hardware\n2. Install Blynk app\n3. Configure devices\n4. Test automation", "download_url": "https://drive.google.com/file/d/example3"}',
  49900,
  'IoT',
  'Advanced',
  'https://images.unsplash.com/photo-1558002038-1055907df827?w=400',
  '["Voice Control", "Remote Access", "Scheduling"]',
  '["NodeMCU", "Blynk", "Firebase"]'
),
(
  'Smart Parking System',
  '{"overview": "Automated parking slot detection with mobile app integration.", "components": "Arduino Mega\nUltrasonic Sensors (4x)\nServo Motor\nLCD Display", "circuitText": "Ultrasonic sensors to digital pins 2,4,6,8. Servo to pin 9.", "steps": "1. Mount sensors\n2. Calibrate distances\n3. Setup display\n4. Test detection", "download_url": "https://drive.google.com/file/d/example4"}',
  39900,
  'Arduino',
  'Intermediate',
  'https://images.unsplash.com/photo-1590674899484-d5640e854abe?w=400',
  '["Real-time Status", "Auto Gate Control", "Mobile App"]',
  '["Arduino", "Bluetooth", "MIT App Inventor"]'
),
(
  'Line Following Robot',
  '{"overview": "Autonomous robot that follows black line using IR sensors.", "components": "Arduino Uno\nL293D Motor Driver\nDC Motors (2x)\nIR Sensors (5x)\nWheels\nChassis", "circuitText": "IR sensors to pins 2-6. Motor driver connections to pins 8-11.", "steps": "1. Assemble robot\n2. Calibrate sensors\n3. Upload code\n4. Test on track", "download_url": "https://drive.google.com/file/d/example5"}',
  29900,
  'Robotics',
  'Beginner',
  'https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=400',
  '["PID Control", "Obstacle Detection", "Speed Control"]',
  '["Arduino", "Robotics", "C++"]'
),
(
  'Raspberry Pi Media Center',
  '{"overview": "Turn your Pi into a complete media streaming center with Kodi.", "components": "Raspberry Pi 4\nMicroSD Card (32GB)\nHDMI Cable\nPower Supply\nRemote Control", "circuitText": "Connect Pi to TV via HDMI. Power via USB-C.", "steps": "1. Install Kodi OS\n2. Configure network\n3. Add media sources\n4. Setup remote", "download_url": "https://drive.google.com/file/d/example6"}',
  59900,
  'Raspberry Pi',
  'Beginner',
  'https://images.unsplash.com/photo-1551817958-20ebe528f0f6?w=400',
  '["4K Streaming", "Voice Control", "NAS Integration"]',
  '["Raspberry Pi", "Kodi", "Python"]'
);

-- Sample Coupons
INSERT INTO coupons (code, description, discount_type, discount_value, min_purchase_amount, max_discount_amount, usage_limit, valid_until) VALUES
('FIRST20', '20% off for first-time buyers', 'percentage', 20.00, 0, 10000, 100, DATE_ADD(NOW(), INTERVAL 3 MONTH)),
('SAVE50', 'â‚¹50 off on any project', 'fixed', 50.00, 20000, NULL, 200, DATE_ADD(NOW(), INTERVAL 2 MONTH)),
('STUDENT25', '25% student discount', 'percentage', 25.00, 0, 15000, 500, DATE_ADD(NOW(), INTERVAL 6 MONTH)),
('WELCOME100', 'Welcome offer - â‚¹100 off', 'fixed', 100.00, 50000, NULL, 50, DATE_ADD(NOW(), INTERVAL 1 MONTH)),
('FLASH30', 'Flash sale - 30% off', 'percentage', 30.00, 30000, 20000, 1000, DATE_ADD(NOW(), INTERVAL 7 DAY));

-- ============================================
-- USEFUL VIEWS
-- ============================================

-- Project Statistics View
CREATE VIEW project_stats AS
SELECT 
  p.id,
  p.title,
  p.category,
  p.price,
  p.difficulty,
  p.average_rating,
  p.reviews_count,
  COUNT(DISTINCT o.id) as total_sales,
  COUNT(DISTINCT w.id) as wishlist_count,
  SUM(CASE WHEN o.status = 'paid' THEN o.amount ELSE 0 END) as total_revenue
FROM projects p
LEFT JOIN orders o ON p.id = o.project_id
LEFT JOIN wishlist w ON p.id = w.project_id
GROUP BY p.id;

-- User Purchase History View
CREATE VIEW user_purchases AS
SELECT 
  o.id as order_id,
  o.user_id,
  u.name as user_name,
  u.email,
  o.project_id,
  p.title as project_title,
  p.category,
  p.thumbnail,
  o.amount,
  o.original_amount,
  o.discount_amount,
  o.coupon_code,
  o.status,
  o.created_at as purchased_at,
  dl.download_count,
  dl.max_downloads,
  (dl.max_downloads - dl.download_count) as downloads_remaining,
  dl.expiry_date,
  dl.last_downloaded_at
FROM orders o
JOIN users u ON o.user_id = u.id
JOIN projects p ON o.project_id = p.id
LEFT JOIN download_logs dl ON o.id = dl.order_id
WHERE o.status = 'paid';

-- ============================================
-- TRIGGERS
-- ============================================

DELIMITER $$

-- Update project rating when review added
CREATE TRIGGER update_project_rating_after_review
AFTER INSERT ON reviews
FOR EACH ROW
BEGIN
  UPDATE projects 
  SET 
    average_rating = (SELECT AVG(rating) FROM reviews WHERE project_id = NEW.project_id),
    reviews_count = (SELECT COUNT(*) FROM reviews WHERE project_id = NEW.project_id)
  WHERE id = NEW.project_id;
END$$

-- Update project rating when review updated
CREATE TRIGGER update_project_rating_after_review_update
AFTER UPDATE ON reviews
FOR EACH ROW
BEGIN
  UPDATE projects 
  SET 
    average_rating = (SELECT AVG(rating) FROM reviews WHERE project_id = NEW.project_id),
    reviews_count = (SELECT COUNT(*) FROM reviews WHERE project_id = NEW.project_id)
  WHERE id = NEW.project_id;
END$$

-- Update project rating when review deleted
CREATE TRIGGER update_project_rating_after_review_delete
AFTER DELETE ON reviews
FOR EACH ROW
BEGIN
  UPDATE projects 
  SET 
    average_rating = COALESCE((SELECT AVG(rating) FROM reviews WHERE project_id = OLD.project_id), 0),
    reviews_count = (SELECT COUNT(*) FROM reviews WHERE project_id = OLD.project_id)
  WHERE id = OLD.project_id;
END$$

-- Increment coupon usage count
CREATE TRIGGER increment_coupon_usage
AFTER INSERT ON coupon_usage
FOR EACH ROW
BEGIN
  UPDATE coupons 
  SET used_count = used_count + 1
  WHERE id = NEW.coupon_id;
END$$

DELIMITER ;

-- ============================================
-- INDEXES FOR PERFORMANCE
-- ============================================

CREATE INDEX idx_orders_user_status ON orders(user_id, status);
CREATE INDEX idx_orders_project_status ON orders(project_id, status);
CREATE INDEX idx_reviews_project_rating ON reviews(project_id, rating);

-- ============================================
-- SCHEMA COMPLETE
-- ============================================

SELECT 'âœ… Database schema created successfully!' as status;
SELECT CONCAT('ðŸ“Š Total projects: ', COUNT(*)) as info FROM projects;
SELECT CONCAT('ðŸŽ« Total coupons: ', COUNT(*)) as info FROM coupons;
SELECT CONCAT('ðŸ‘¤ Admin user created: admin@local (password: admin123)') as info;


================================================
FILE: backend\src\config\db.js
================================================
ï»¿const mysql = require('mysql2/promise');

// Load .env only for LOCAL development
if (process.env.NODE_ENV !== 'production') {
  require('dotenv').config();
}

const poolConfig = {
  host: process.env.DB_HOST,
  port: Number(process.env.DB_PORT),
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0,
  enableKeepAlive: true,
  keepAliveInitialDelay: 0,
  // ðŸ‘‡ THIS IS THE FIX ðŸ‘‡
  ssl: {
    minVersion: 'TLSv1.2',
    rejectUnauthorized: false // Change from true to false
  }
};

const pool = mysql.createPool(poolConfig);

// Test connection
const testConnection = async () => {
  try {
    const connection = await pool.getConnection();
    console.log('Database connection established');
    connection.release();
    return true;
  } catch (error) {
    console.error('Database connection failed:', error.message);
    throw error;
  }
};

// Query helper with error handling
const query = async (sql, params = []) => {
  try {
    const [results] = await pool.query(sql, params);
    return results;
  } catch (error) {
    console.error('Query error:', error.message);
    console.error('SQL:', sql);
    console.error('Params:', params);
    throw error;
  }
};

// Transaction helper
const transaction = async (callback) => {
  const connection = await pool.getConnection();
  try {
    await connection.beginTransaction();
    const result = await callback(connection);
    await connection.commit();
    return result;
  } catch (error) {
    await connection.rollback();
    throw error;
  } finally {
    connection.release();
  }
};

module.exports = {
  pool,
  query,
  transaction,
  testConnection
};


================================================
FILE: backend\src\controllers\admin.controller.js
================================================
const db = require('../config/db');

/**
 * Create a new project (Admin only)
 * POST /api/admin/projects
 */
const createProject = async (req, res) => {
  try {
    const {
      title,
      description,
      price,
      thumbnail,
      content_url,
      category,
      features,
      tech_stack
    } = req.body;

    const result = await db.query(
      `INSERT INTO projects 
       (title, description, price, thumbnail, content_url, category, features, tech_stack, created_at, updated_at) 
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())`,
      [
        title,
        description,
        price,
        thumbnail,
        content_url,
        category || 'IoT',
        JSON.stringify(features || []),
        JSON.stringify(tech_stack || [])
      ]
    );

    const newProject = await db.query(
      'SELECT * FROM projects WHERE id = ?',
      [result.insertId]
    );

    res.status(201).json({
      success: true,
      message: 'Project created successfully',
      data: newProject[0]
    });
  } catch (error) {
    console.error('Create project error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to create project'
    });
  }
};

/**
 * Update a project (Admin only)
 * PUT /api/admin/projects/:id
 */
const updateProject = async (req, res) => {
  try {
    const { id } = req.params;
    const {
      title,
      description,
      price,
      thumbnail,
      content_url,
      category,
      features,
      tech_stack
    } = req.body;

    // Check if project exists
    const existingProjects = await db.query(
      'SELECT id FROM projects WHERE id = ?',
      [id]
    );

    if (existingProjects.length === 0) {
      return res.status(404).json({
        success: false,
        message: 'Project not found'
      });
    }

    // Build update query dynamically
    const updates = [];
    const params = [];

    if (title !== undefined) {
      updates.push('title = ?');
      params.push(title);
    }
    if (description !== undefined) {
      updates.push('description = ?');
      params.push(description);
    }
    if (price !== undefined) {
      updates.push('price = ?');
      params.push(price);
    }
    if (thumbnail !== undefined) {
      updates.push('thumbnail = ?');
      params.push(thumbnail);
    }
    if (content_url !== undefined) {
      updates.push('content_url = ?');
      params.push(content_url);
    }
    if (category !== undefined) {
      updates.push('category = ?');
      params.push(category);
    }
    if (features !== undefined) {
      updates.push('features = ?');
      params.push(JSON.stringify(features));
    }
    if (tech_stack !== undefined) {
      updates.push('tech_stack = ?');
      params.push(JSON.stringify(tech_stack));
    }

    updates.push('updated_at = NOW()');
    params.push(id);

    await db.query(
      `UPDATE projects SET ${updates.join(', ')} WHERE id = ?`,
      params
    );

    const updatedProject = await db.query(
      'SELECT * FROM projects WHERE id = ?',
      [id]
    );

    res.json({
      success: true,
      message: 'Project updated successfully',
      data: updatedProject[0]
    });
  } catch (error) {
    console.error('Update project error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to update project'
    });
  }
};

/**
 * Delete a project (Admin only)
 * DELETE /api/admin/projects/:id
 */
const deleteProject = async (req, res) => {
  try {
    const { id } = req.params;

    // Check if project exists
    const existingProjects = await db.query(
      'SELECT id FROM projects WHERE id = ?',
      [id]
    );

    if (existingProjects.length === 0) {
      return res.status(404).json({
        success: false,
        message: 'Project not found'
      });
    }

    // Check if there are any paid orders for this project
    const paidOrders = await db.query(
      `SELECT COUNT(*) as count FROM orders WHERE project_id = ? AND status = 'paid'`,
      [id]
    );

    if (paidOrders[0].count > 0) {
      return res.status(400).json({
        success: false,
        message: 'Cannot delete project with existing paid orders. Consider archiving instead.'
      });
    }

    // Delete pending orders first
    await db.query(
      'DELETE FROM orders WHERE project_id = ? AND status != ?',
      [id, 'paid']
    );

    // Delete the project
    await db.query('DELETE FROM projects WHERE id = ?', [id]);

    res.json({
      success: true,
      message: 'Project deleted successfully'
    });
  } catch (error) {
    console.error('Delete project error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to delete project'
    });
  }
};

/**
 * Get all orders (Admin only)
 * GET /api/admin/orders
 */
const getAllOrders = async (req, res) => {
  try {
    const { status, page = 1, limit = 20 } = req.query;

    let sql = `
      SELECT 
        o.*,
        u.email as user_email,
        u.name as user_name,
        p.title as project_title
      FROM orders o
      JOIN users u ON o.user_id = u.id
      JOIN projects p ON o.project_id = p.id
    `;
    const params = [];

    if (status) {
      sql += ' WHERE o.status = ?';
      params.push(status);
    }

    sql += ' ORDER BY o.created_at DESC';

    const offset = (parseInt(page) - 1) * parseInt(limit);
    sql += ' LIMIT ? OFFSET ?';
    params.push(parseInt(limit), offset);

    const orders = await db.query(sql, params);

    // Get total count
    let countSql = 'SELECT COUNT(*) as total FROM orders';
    if (status) {
      countSql += ' WHERE status = ?';
    }
    const countResult = await db.query(countSql, status ? [status] : []);

    res.json({
      success: true,
      data: {
        orders,
        pagination: {
          page: parseInt(page),
          limit: parseInt(limit),
          total: countResult[0].total,
          pages: Math.ceil(countResult[0].total / parseInt(limit))
        }
      }
    });
  } catch (error) {
    console.error('Get all orders error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch orders'
    });
  }
};

/**
 * Get dashboard stats (Admin only)
 * GET /api/admin/stats
 */
const getDashboardStats = async (req, res) => {
  try {
    // Total users
    const usersResult = await db.query(
      'SELECT COUNT(*) as total FROM users WHERE role = ?',
      ['user']
    );

    // Total projects
    const projectsResult = await db.query(
      'SELECT COUNT(*) as total FROM projects'
    );

    // Total revenue
    const revenueResult = await db.query(
      `SELECT COALESCE(SUM(amount), 0) as total FROM orders WHERE status = 'paid'`
    );

    // Total orders
    const ordersResult = await db.query(
      `SELECT COUNT(*) as total FROM orders WHERE status = 'paid'`
    );

    // Recent orders
    const recentOrders = await db.query(
      `SELECT 
        o.*,
        u.email as user_email,
        p.title as project_title
       FROM orders o
       JOIN users u ON o.user_id = u.id
       JOIN projects p ON o.project_id = p.id
       WHERE o.status = 'paid'
       ORDER BY o.created_at DESC
       LIMIT 5`
    );

    // Monthly revenue (last 6 months)
    const monthlyRevenue = await db.query(
      `SELECT 
        DATE_FORMAT(created_at, '%Y-%m') as month,
        SUM(amount) as revenue,
        COUNT(*) as orders
       FROM orders 
       WHERE status = 'paid' 
       AND created_at >= DATE_SUB(NOW(), INTERVAL 6 MONTH)
       GROUP BY DATE_FORMAT(created_at, '%Y-%m')
       ORDER BY month ASC`
    );

    res.json({
      success: true,
      data: {
        totalUsers: usersResult[0].total,
        totalProjects: projectsResult[0].total,
        totalRevenue: revenueResult[0].total,
        totalOrders: ordersResult[0].total,
        recentOrders,
        monthlyRevenue
      }
    });
  } catch (error) {
    console.error('Get dashboard stats error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch dashboard stats'
    });
  }
};

/**
 * Get all users (Admin only)
 * GET /api/admin/users
 */
const getAllUsers = async (req, res) => {
  try {
    const { page = 1, limit = 20 } = req.query;

    const offset = (parseInt(page) - 1) * parseInt(limit);

    const users = await db.query(
      `SELECT id, email, name, role, created_at 
       FROM users 
       ORDER BY created_at DESC 
       LIMIT ? OFFSET ?`,
      [parseInt(limit), offset]
    );

    const countResult = await db.query('SELECT COUNT(*) as total FROM users');

    res.json({
      success: true,
      data: {
        users,
        pagination: {
          page: parseInt(page),
          limit: parseInt(limit),
          total: countResult[0].total,
          pages: Math.ceil(countResult[0].total / parseInt(limit))
        }
      }
    });
  } catch (error) {
    console.error('Get all users error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch users'
    });
  }
};

module.exports = {
  createProject,
  updateProject,
  deleteProject,
  getAllOrders,
  getDashboardStats,
  getAllUsers
};


================================================
FILE: backend\src\controllers\auth.controller.js
================================================
ï»¿const bcrypt = require('bcryptjs');
const { validationResult } = require('express-validator');
const db = require('../config/db');
const { generateToken } = require('../middlewares/auth.middleware');

/**
 * Register a new user
 * POST /api/auth/register
 */
const register = async (req, res) => {
  try {
    // Validate request
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        success: false,
        message: 'Validation failed',
        errors: errors.array()
      });
    }

    const { email, password, name } = req.body;

    // Check if user already exists
    const existingUsers = await db.query(
      'SELECT id FROM users WHERE email = ?',
      [email.toLowerCase()]
    );

    if (existingUsers.length > 0) {
      return res.status(409).json({
        success: false,
        message: 'User with this email already exists'
      });
    }

    // Hash password
    const saltRounds = 12;
    const hashedPassword = await bcrypt.hash(password, saltRounds);

    // Insert new user
    const result = await db.query(
      `INSERT INTO users (email, password, name, role, created_at) 
       VALUES (?, ?, ?, 'user', NOW())`,
      [email.toLowerCase(), hashedPassword, name]
    );

    // Get created user
    const newUser = {
      id: result.insertId,
      email: email.toLowerCase(),
      name,
      role: 'user'
    };

    // Generate token
    const token = generateToken(newUser);

    res.status(201).json({
      success: true,
      message: 'Registration successful',
      data: {
        user: newUser,
        token
      }
    });
  } catch (error) {
    console.error('Registration error:', error);
    res.status(500).json({
      success: false,
      message: 'Registration failed. Please try again.'
    });
  }
};

/**
 * Login user
 * POST /api/auth/login
 */
const login = async (req, res) => {
  try {
    // Validate request
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        success: false,
        message: 'Validation failed',
        errors: errors.array()
      });
    }

    const { email, password } = req.body;

    // Find user
    const users = await db.query(
      'SELECT id, email, password, name, role FROM users WHERE email = ?',
      [email.toLowerCase()]
    );

    if (users.length === 0) {
      return res.status(401).json({
        success: false,
        message: 'Invalid email or password'
      });
    }

    const user = users[0];

    // Verify password
    const isValidPassword = await bcrypt.compare(password, user.password);

    if (!isValidPassword) {
      return res.status(401).json({
        success: false,
        message: 'Invalid email or password'
      });
    }

    // Generate token
    const token = generateToken(user);

    // Remove password from response
    const { password: _, ...userWithoutPassword } = user;

    res.json({
      success: true,
      message: 'Login successful',
      data: {
        user: userWithoutPassword,
        token
      }
    });
  } catch (error) {
    console.error('Login error:', error);
    res.status(500).json({
      success: false,
      message: 'Login failed. Please try again.'
    });
  }
};

/**
 * Get current user profile
 * GET /api/auth/me
 */
const getMe = async (req, res) => {
  try {
    const user = await db.query(
      'SELECT id, email, name, role, created_at FROM users WHERE id = ?',
      [req.user.id]
    );

    if (user.length === 0) {
      return res.status(404).json({
        success: false,
        message: 'User not found'
      });
    }

    res.json({
      success: true,
      data: user[0]
    });
  } catch (error) {
    console.error('Get profile error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch profile'
    });
  }
};

/**
 * Update user profile
 * PUT /api/auth/profile
 */
const updateProfile = async (req, res) => {
  try {
    const { name } = req.body;

    await db.query(
      'UPDATE users SET name = ? WHERE id = ?',
      [name, req.user.id]
    );

    res.json({
      success: true,
      message: 'Profile updated successfully'
    });
  } catch (error) {
    console.error('Update profile error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to update profile'
    });
  }
};

/**
 * Change password
 * PUT /api/auth/password
 */
const changePassword = async (req, res) => {
  try {
    const { currentPassword, newPassword } = req.body;

    // Get current user with password
    const users = await db.query(
      'SELECT password FROM users WHERE id = ?',
      [req.user.id]
    );

    if (users.length === 0) {
      return res.status(404).json({
        success: false,
        message: 'User not found'
      });
    }

    // Verify current password
    const isValid = await bcrypt.compare(currentPassword, users[0].password);
    if (!isValid) {
      return res.status(401).json({
        success: false,
        message: 'Current password is incorrect'
      });
    }

    // Hash new password
    const hashedPassword = await bcrypt.hash(newPassword, 12);

    // Update password
    await db.query(
      'UPDATE users SET password = ? WHERE id = ?',
      [hashedPassword, req.user.id]
    );

    res.json({
      success: true,
      message: 'Password changed successfully'
    });
  } catch (error) {
    console.error('Change password error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to change password'
    });
  }
};

module.exports = {
  register,
  login,
  getMe,
  updateProfile,
  changePassword
};


================================================
FILE: backend\src\controllers\coupon.controller.js
================================================
// src/controllers/coupon.controller.js
const db = require('../config/db');

const couponController = {
  // Validate and apply coupon
  validateCoupon: async (req, res) => {
    try {
      const { code, project_id, amount } = req.body;
      const userId = req.user.id;

      if (!code || !amount) {
        return res.status(400).json({
          success: false,
          message: 'Coupon code and amount are required'
        });
      }

      // Get coupon details
      const [coupons] = await db.query(
        `SELECT * FROM coupons 
         WHERE code = ? 
         AND is_active = TRUE 
         AND (valid_until IS NULL OR valid_until > NOW())`,
        [code.trim().toUpperCase()]
      );

      if (coupons.length === 0) {
        return res.status(404).json({
          success: false,
          message: 'Invalid or expired coupon code'
        });
      }

      const coupon = coupons[0];

      // Check usage limit
      if (coupon.usage_limit && coupon.used_count >= coupon.usage_limit) {
        return res.status(400).json({
          success: false,
          message: 'This coupon has reached its usage limit'
        });
      }

      // Check minimum purchase amount (convert to paise)
      const amountInPaise = amount * 100;
      if (amountInPaise < coupon.min_purchase_amount) {
        return res.status(400).json({
          success: false,
          message: `Minimum purchase amount is â‚¹${coupon.min_purchase_amount / 100}`
        });
      }

      // Check if user already used this coupon
      const [usage] = await db.query(
        'SELECT id FROM coupon_usage WHERE coupon_id = ? AND user_id = ?',
        [coupon.id, userId]
      );

      if (usage.length > 0) {
        return res.status(400).json({
          success: false,
          message: 'You have already used this coupon'
        });
      }

      // Calculate discount (in rupees)
      let discountAmount = 0;
      if (coupon.discount_type === 'percentage') {
        discountAmount = (amount * coupon.discount_value) / 100;
      } else {
        discountAmount = coupon.discount_value;
      }

      // Apply max discount limit (convert from paise to rupees)
      if (coupon.max_discount_amount) {
        const maxDiscountRupees = coupon.max_discount_amount / 100;
        discountAmount = Math.min(discountAmount, maxDiscountRupees);
      }

      // Ensure discount doesn't exceed amount
      discountAmount = Math.min(discountAmount, amount);

      const finalAmount = amount - discountAmount;

      res.json({
        success: true,
        data: {
          code: coupon.code,
          description: coupon.description,
          discount_type: coupon.discount_type,
          discount_value: coupon.discount_value,
          discount_amount: Math.round(discountAmount),
          final_amount: Math.round(finalAmount),
          original_amount: amount
        }
      });

    } catch (error) {
      console.error('Coupon validation error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to validate coupon'
      });
    }
  },

  // Get all active coupons (admin)
  getAllCoupons: async (req, res) => {
    try {
      const [coupons] = await db.query(
        `SELECT 
          id, code, description, discount_type, discount_value,
          min_purchase_amount, max_discount_amount, usage_limit,
          used_count, valid_from, valid_until, is_active, created_at
         FROM coupons 
         ORDER BY created_at DESC`
      );

      res.json({
        success: true,
        data: coupons
      });
    } catch (error) {
      console.error('Get coupons error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to fetch coupons'
      });
    }
  },

  // Create coupon (admin)
  createCoupon: async (req, res) => {
    try {
      const {
        code,
        description,
        discount_type,
        discount_value,
        min_purchase_amount,
        max_discount_amount,
        usage_limit,
        valid_until
      } = req.body;

      const [result] = await db.query(
        `INSERT INTO coupons 
         (code, description, discount_type, discount_value, 
          min_purchase_amount, max_discount_amount, usage_limit, valid_until)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
        [
          code.toUpperCase(),
          description,
          discount_type,
          discount_value,
          min_purchase_amount || 0,
          max_discount_amount,
          usage_limit,
          valid_until
        ]
      );

      res.status(201).json({
        success: true,
        message: 'Coupon created successfully',
        data: { id: result.insertId }
      });
    } catch (error) {
      if (error.code === 'ER_DUP_ENTRY') {
        return res.status(400).json({
          success: false,
          message: 'Coupon code already exists'
        });
      }
      console.error('Create coupon error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to create coupon'
      });
    }
  }
};

module.exports = couponController;


================================================
FILE: backend\src\controllers\order.controller.js
================================================
const db = require('../config/db');

/**
 * Get user's orders
 * GET /api/orders/my
 */
const getMyOrders = async (req, res) => {
  try {
    const userId = req.user.id;
    const { status, page = 1, limit = 10 } = req.query;

    let sql = `
      SELECT 
        o.id,
        o.project_id,
        o.razorpay_order_id,
        o.razorpay_payment_id,
        o.amount,
        o.status,
        o.created_at,
        p.title as project_title,
        p.thumbnail as project_thumbnail,
        p.category as project_category
      FROM orders o
      JOIN projects p ON o.project_id = p.id
      WHERE o.user_id = ?
    `;
    const params = [userId];

    if (status) {
      sql += ' AND o.status = ?';
      params.push(status);
    }

    sql += ' ORDER BY o.created_at DESC';

    const offset = (parseInt(page) - 1) * parseInt(limit);
    sql += ' LIMIT ? OFFSET ?';
    params.push(parseInt(limit), offset);

    const orders = await db.query(sql, params);

    // Get total count
    let countSql = 'SELECT COUNT(*) as total FROM orders WHERE user_id = ?';
    const countParams = [userId];
    if (status) {
      countSql += ' AND status = ?';
      countParams.push(status);
    }
    const countResult = await db.query(countSql, countParams);

    res.json({
      success: true,
      data: {
        orders,
        pagination: {
          page: parseInt(page),
          limit: parseInt(limit),
          total: countResult[0].total,
          pages: Math.ceil(countResult[0].total / parseInt(limit))
        }
      }
    });
  } catch (error) {
    console.error('Get my orders error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch orders'
    });
  }
};

/**
 * Get user's purchased projects
 * GET /api/orders/purchased
 */
const getPurchasedProjects = async (req, res) => {
  try {
    const userId = req.user.id;

    // Join orders with projects and download_logs
    const projects = await db.query(
      `SELECT 
        p.id,
        p.title,
        p.description,
        p.thumbnail,
        p.category,
        o.created_at as purchased_at,
        o.amount as paid_amount,
        dl.download_count,
        dl.max_downloads,
        dl.expiry_date
       FROM orders o
       JOIN projects p ON o.project_id = p.id
       LEFT JOIN download_logs dl ON o.id = dl.order_id
       WHERE o.user_id = ? AND o.status = 'paid'
       ORDER BY o.created_at DESC`,
      [userId]
    );

    res.json({
      success: true,
      data: {
        downloads: projects // Return as 'downloads' array to match frontend
      }
    });
  } catch (error) {
    console.error('Get purchased projects error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch purchased projects'
    });
  }
};

/**
 * Get single order details
 * GET /api/orders/:id
 */
const getOrderById = async (req, res) => {
  try {
    const { id } = req.params;
    const userId = req.user.id;

    const orders = await db.query(
      `SELECT 
        o.*,
        p.title as project_title,
        p.description as project_description,
        p.thumbnail as project_thumbnail,
        p.category as project_category
       FROM orders o
       JOIN projects p ON o.project_id = p.id
       WHERE o.id = ? AND o.user_id = ?`,
      [id, userId]
    );

    if (orders.length === 0) {
      return res.status(404).json({
        success: false,
        message: 'Order not found'
      });
    }

    res.json({
      success: true,
      data: orders[0]
    });
  } catch (error) {
    console.error('Get order by ID error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch order'
    });
  }
};

module.exports = {
  getMyOrders,
  getPurchasedProjects,
  getOrderById
};


================================================
FILE: backend\src\controllers\payment.controller.js
================================================
ï»¿const Razorpay = require("razorpay");
const crypto = require("crypto");
const db = require("../config/db");

// ------------------------------
// Initialize Razorpay
// ------------------------------
const razorpay = new Razorpay({
  key_id: process.env.RAZORPAY_KEY_ID,
  key_secret: process.env.RAZORPAY_KEY_SECRET,
});

// ------------------------------
// CREATE ORDER
// ------------------------------
exports.createOrder = async (req, res) => {
  try {
    const { projectId, couponCode } = req.body;  // âœ… Added couponCode support

    if (!projectId) {
      return res.json({ success: false, message: "projectId is required" });
    }

    // 1. Get project price from DB
    const rows = await db.query(
      "SELECT id, price FROM projects WHERE id = ? LIMIT 1",
      [projectId]
    );

    if (!rows.length) {
      return res.json({ success: false, message: "Project not found" });
    }

    let originalAmount = Number(rows[0].price);
    let discountAmount = 0;
    let finalAmount = originalAmount;

    // âœ… Apply coupon if provided
    if (couponCode) {
      const coupons = await db.query(
        `SELECT * FROM coupons 
         WHERE code = ? AND is_active = TRUE 
         AND (valid_until IS NULL OR valid_until > NOW())`,
        [couponCode.toUpperCase()]
      );

      if (coupons.length > 0) {
        const coupon = coupons[0];
        
        // Check usage limit
        if (!coupon.usage_limit || coupon.used_count < coupon.usage_limit) {
          // Check if user already used this coupon
          const userUsage = await db.query(
            'SELECT id FROM coupon_usage WHERE coupon_id = ? AND user_id = ?',
            [coupon.id, req.user.id]
          );

          if (userUsage.length === 0) {
            // Calculate discount (values in DB are in paise for fixed, percentage for %)
            if (coupon.discount_type === 'percentage') {
              discountAmount = (originalAmount * coupon.discount_value) / 100;
            } else {
              discountAmount = coupon.discount_value; // Fixed amount in rupees
            }

            // Apply max discount limit (stored in paise, convert to rupees)
            if (coupon.max_discount_amount) {
              const maxDiscount = coupon.max_discount_amount / 100;
              discountAmount = Math.min(discountAmount, maxDiscount);
            }

            // Ensure discount doesn't exceed price
            discountAmount = Math.min(discountAmount, originalAmount);
            finalAmount = originalAmount - discountAmount;
            finalAmount = Math.max(0, finalAmount);
          }
        }
      }
    }

    const amountInPaise = Math.round(finalAmount * 100);

    // 2. Create Razorpay order
    const options = {
      amount: amountInPaise,
      currency: "INR",
      receipt: `order_${projectId}_${Date.now()}`,
    };

    const order = await razorpay.orders.create(options);

    return res.json({
      success: true,
      orderId: order.id,
      amount: order.amount,
      originalAmount,
      discountAmount,
      couponCode: couponCode || null
    });
  } catch (error) {
    console.error("Create order error:", error);
    return res.json({
      success: false,
      message: "Failed to create order",
    });
  }
};

// ------------------------------
// VERIFY PAYMENT
// ------------------------------
exports.verifyPayment = async (req, res) => {
  try {
    const {
      projectId,
      razorpay_order_id,
      razorpay_payment_id,
      razorpay_signature,
      couponCode,
      discountAmount
    } = req.body;

    if (!projectId || !razorpay_order_id || !razorpay_payment_id || !razorpay_signature) {
      return res.json({ success: false, message: "Missing payment fields" });
    }

    // 1. Verify signature
    const signData = `${razorpay_order_id}|${razorpay_payment_id}`;

    const expectedSignature = crypto
      .createHmac("sha256", process.env.RAZORPAY_KEY_SECRET)
      .update(signData)
      .digest("hex");

    if (expectedSignature !== razorpay_signature) {
      return res.json({ success: false, message: "Invalid signature" });
    }

    // 2. Get project price
    const rows = await db.query(
      "SELECT price FROM projects WHERE id = ? LIMIT 1",
      [projectId]
    );

    if (!rows.length) {
      return res.json({ success: false, message: "Project not found" });
    }

    const originalAmount = Number(rows[0].price);
    const discount = discountAmount || 0;
    const finalAmount = originalAmount - discount;

    // 3. Save order with coupon info
    const result = await db.query(
      `INSERT INTO orders (user_id, project_id, razorpay_order_id, razorpay_payment_id, 
                           amount, original_amount, discount_amount, coupon_code, status, created_at)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'paid', NOW())`,
      [
        req.user.id, 
        projectId, 
        razorpay_order_id,
        razorpay_payment_id, 
        finalAmount,
        originalAmount,
        discount,
        couponCode || null
      ]
    );

    const orderId = result.insertId;

    // 4. If coupon used, log it and increment usage
    if (couponCode) {
      const coupons = await db.query(
        'SELECT id FROM coupons WHERE code = ?',
        [couponCode.toUpperCase()]
      );
      
      if (coupons.length > 0) {
        const couponId = coupons[0].id;
        
        // Log coupon usage
        await db.query(
          `INSERT INTO coupon_usage (coupon_id, user_id, order_id, discount_amount, created_at)
           VALUES (?, ?, ?, ?, NOW())`,
          [couponId, req.user.id, orderId, Math.round(discount * 100)]
        );
      }
    }

    // 5. Create download log (6 months expiry, 5 downloads max)
    const expiryDate = new Date();
    expiryDate.setMonth(expiryDate.getMonth() + 6);

    await db.query(
      `INSERT INTO download_logs (user_id, project_id, order_id, download_count, max_downloads, expiry_date, created_at)
       VALUES (?, ?, ?, 0, 5, ?, NOW())`,
      [req.user.id, projectId, orderId, expiryDate]
    );

    // âœ… REMOVED: purchases table insert (table doesn't exist)

    return res.json({ 
      success: true,
      message: "Payment verified successfully",
      orderId 
    });
  } catch (error) {
    console.error("Verify payment error:", error);
    return res.json({
      success: false,
      message: "Payment verification failed",
    });
  }
};


================================================
FILE: backend\src\controllers\project.controller.js
================================================
ï»¿// src/controllers/project.controller.js
const db = require('../config/db');

/**
 * Get all projects (public)
 * GET /api/projects
 */
const getAllProjects = async (req, res) => {
  try {
    const { 
      category, 
      search, 
      sort, 
      page = 1, 
      limit = 12,
      difficulty,      // NEW
      maxPrice,        // NEW
      technology       // NEW
    } = req.query;
    
    let sql = `
      SELECT 
        p.id, p.title, p.description, p.price, p.thumbnail, p.category,
        p.difficulty, p.average_rating, p.reviews_count, p.created_at, p.updated_at
      FROM projects p
      WHERE 1=1
    `;
    const params = [];

    // Filter by category
    if (category) {
      sql += ' AND p.category = ?';
      params.push(category);
    }

    // NEW: Filter by difficulty
    if (difficulty) {
      sql += ' AND p.difficulty = ?';
      params.push(difficulty);
    }

    // NEW: Filter by max price
    if (maxPrice && maxPrice !== '999') {
      sql += ' AND p.price <= ?';
      params.push(parseInt(maxPrice));
    }

    // NEW: Filter by technology (searches in title/description)
    if (technology) {
      sql += ' AND (p.title LIKE ? OR p.description LIKE ? OR p.category LIKE ?)';
      params.push(`%${technology}%`, `%${technology}%`, `%${technology}%`);
    }

    // Search
    if (search) {
      sql += ' AND (p.title LIKE ? OR p.description LIKE ? OR p.category LIKE ?)';
      params.push(`%${search}%`, `%${search}%`, `%${search}%`);
    }

    // Sorting
    switch (sort) {
      case 'price_asc':
        sql += ' ORDER BY p.price ASC';
        break;
      case 'price_desc':
        sql += ' ORDER BY p.price DESC';
        break;
      case 'oldest':
        sql += ' ORDER BY p.created_at ASC';
        break;
      case 'popular':  // NEW
        sql += ' ORDER BY p.reviews_count DESC, p.average_rating DESC';
        break;
      case 'rating':   // NEW
        sql += ' ORDER BY p.average_rating DESC, p.reviews_count DESC';
        break;
      case 'newest':
      default:
        sql += ' ORDER BY p.created_at DESC';
    }

    // Pagination
    const offset = (parseInt(page) - 1) * parseInt(limit);
    sql += ' LIMIT ? OFFSET ?';
    params.push(parseInt(limit), offset);

    const projects = await db.query(sql, params);

    // Get total count for pagination
    let countSql = 'SELECT COUNT(*) as total FROM projects p WHERE 1=1';
    const countParams = [];
    
    if (category) {
      countSql += ' AND p.category = ?';
      countParams.push(category);
    }
    if (difficulty) {
      countSql += ' AND p.difficulty = ?';
      countParams.push(difficulty);
    }
    if (maxPrice && maxPrice !== '999') {
      countSql += ' AND p.price <= ?';
      countParams.push(parseInt(maxPrice));
    }
    if (technology) {
      countSql += ' AND (p.title LIKE ? OR p.description LIKE ? OR p.category LIKE ?)';
      countParams.push(`%${technology}%`, `%${technology}%`, `%${technology}%`);
    }
    if (search) {
      countSql += ' AND (p.title LIKE ? OR p.description LIKE ? OR p.category LIKE ?)';
      countParams.push(`%${search}%`, `%${search}%`, `%${search}%`);
    }

    const countResult = await db.query(countSql, countParams);
    const total = countResult[0].total;

    res.json({
      success: true,
      data: {
        projects,
        pagination: {
          page: parseInt(page),
          limit: parseInt(limit),
          total,
          pages: Math.ceil(total / parseInt(limit))
        }
      }
    });
  } catch (error) {
    console.error('Get projects error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch projects'
    });
  }
};

/**
 * Get single project by ID (public)
 * GET /api/projects/:id
 */
const getProjectById = async (req, res) => {
  try {
    const { id } = req.params;

    const projects = await db.query(
      `SELECT 
        id, title, description, price, thumbnail, category,
        difficulty, average_rating, reviews_count,
        features, tech_stack, created_at, updated_at
       FROM projects 
       WHERE id = ?`,
      [id]
    );

    if (projects.length === 0) {
      return res.status(404).json({
        success: false,
        message: 'Project not found'
      });
    }

    const project = projects[0];
    
    // Parse JSON fields
    if (project.features) {
      try {
        project.features = JSON.parse(project.features);
      } catch (e) {
        project.features = [];
      }
    }
    
    if (project.tech_stack) {
      try {
        project.tech_stack = JSON.parse(project.tech_stack);
      } catch (e) {
        project.tech_stack = [];
      }
    }

    // Check if user has purchased this project
    let isPurchased = false;
    
    if (req.user) {  // This will now work because authOptional sets req.user
      const orders = await db.query(
        `SELECT id FROM orders 
         WHERE user_id = ? AND project_id = ? AND status = 'paid'`,
        [req.user.id, id]
      );
      isPurchased = orders.length > 0 || req.user.role === 'admin';
    }

    res.json({
      success: true,
      data: {
        project: {
          ...project,
          isPurchased
        }
      }
    });
  } catch (error) {
    console.error('Get project error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch project'
    });
  }
};

/**
 * Get project download (protected - only for purchased users)
 * GET /api/projects/:id/download
 * ENHANCED: Now tracks downloads
 */
const downloadProject = async (req, res) => {
  try {
    const { id } = req.params;
    const userId = req.user.id;
    const isAdmin = req.user.role === 'admin';

    // Admin bypass
    if (isAdmin) {
      const projects = await db.query(
        'SELECT description, title FROM projects WHERE id = ?',
        [id]
      );

      if (projects.length === 0) {
        return res.status(404).json({
          success: false,
          message: 'Project not found',
        });
      }

      let downloadUrl = null;
      try {
        const desc = JSON.parse(projects[0].description);
        downloadUrl = desc.download_url;
      } catch (e) {
        downloadUrl = null;
      }

      return res.json({
        success: true,
        data: {
          downloadUrl: downloadUrl || '#',
          fileName: `${projects[0].title.replace(/\s+/g, '_')}.zip`,
          message: 'Admin download'
        },
      });
    }

    // Check if user purchased this project
    const orders = await db.query(
      `SELECT id, created_at FROM orders 
       WHERE user_id = ? AND project_id = ? AND status = 'paid'
       ORDER BY created_at DESC
       LIMIT 1`,
      [userId, id]
    );

    if (orders.length === 0) {
      return res.status(403).json({
        success: false,
        message: 'You must purchase this project to download'
      });
    }

    const orderId = orders[0].id;

    // Check/create download log
    const [logs] = await db.query(
      `SELECT * FROM download_logs 
       WHERE user_id = ? AND project_id = ? AND order_id = ?`,
      [userId, id, orderId]
    );

    let downloadLog;
    const MAX_DOWNLOADS = 5;
    const EXPIRY_DAYS = 180; // 6 months

    if (logs.length === 0) {
      // Create new download log
      const expiryDate = new Date();
      expiryDate.setDate(expiryDate.getDate() + EXPIRY_DAYS);

      const [result] = await db.query(
        `INSERT INTO download_logs 
         (user_id, project_id, order_id, download_count, max_downloads, expiry_date, last_downloaded_at)
         VALUES (?, ?, ?, 1, ?, ?, NOW())`,
        [userId, id, orderId, MAX_DOWNLOADS, expiryDate]
      );

      downloadLog = {
        id: result.insertId,
        download_count: 1,
        max_downloads: MAX_DOWNLOADS,
        expiry_date: expiryDate
      };
    } else {
      downloadLog = logs[0];

      // Check expiry
      if (new Date(downloadLog.expiry_date) < new Date()) {
        return res.status(403).json({
          success: false,
          message: 'Download link has expired. Contact support to renew access.'
        });
      }

      // Check download limit
      if (downloadLog.download_count >= downloadLog.max_downloads) {
        return res.status(403).json({
          success: false,
          message: `Download limit (${downloadLog.max_downloads}) reached. Contact support for additional downloads.`
        });
      }

      // Increment download count
      await db.query(
        `UPDATE download_logs 
         SET download_count = download_count + 1,
             last_downloaded_at = NOW()
         WHERE id = ?`,
        [downloadLog.id]
      );

      downloadLog.download_count += 1;
    }

    // Get project download URL
    const projects = await db.query(
      'SELECT title, description FROM projects WHERE id = ?',
      [id]
    );

    if (projects.length === 0) {
      return res.status(404).json({
        success: false,
        message: 'Project not found'
      });
    }

    let downloadUrl = null;
    try {
      const desc = JSON.parse(projects[0].description);
      downloadUrl = desc.download_url;
    } catch (e) {
      downloadUrl = null;
    }

    if (!downloadUrl) {
      return res.status(404).json({
        success: false,
        message: 'Download link not available'
      });
    }

    const downloadsRemaining = downloadLog.max_downloads - downloadLog.download_count;
    const daysUntilExpiry = Math.ceil(
      (new Date(downloadLog.expiry_date) - new Date()) / (1000 * 60 * 60 * 24)
    );

    res.json({
      success: true,
      data: {
        downloadUrl,
        fileName: `${projects[0].title.replace(/\s+/g, '_')}.zip`,
        downloads_remaining: downloadsRemaining,
        total_downloads: downloadLog.max_downloads,
        expiry_date: downloadLog.expiry_date,
        days_until_expiry: daysUntilExpiry
      },
      message: `Download started. ${downloadsRemaining} download${downloadsRemaining !== 1 ? 's' : ''} remaining.`
    });

  } catch (error) {
    console.error('Download project error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to process download'
    });
  }
};

/**
 * Get all categories with project counts
 * GET /api/projects/categories
 */
const getCategories = async (req, res) => {
  try {
    const categories = await db.query(
      `SELECT category, COUNT(*) as count 
       FROM projects 
       WHERE category IS NOT NULL AND category != ''
       GROUP BY category 
       ORDER BY count DESC, category ASC`
    );

    res.json({
      success: true,
      data: categories
    });
  } catch (error) {
    console.error('Get categories error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to fetch categories'
    });
  }
};

module.exports = {
  getAllProjects,
  getProjectById,
  downloadProject,
  getCategories
};


================================================
FILE: backend\src\controllers\review.controller.js
================================================
// src/controllers/review.controller.js
const db = require('../config/db');

const reviewController = {
  // Get reviews for a project
  getProjectReviews: async (req, res) => {
    try {
      const { projectId } = req.params;

      const [reviews] = await db.query(
        `SELECT 
          r.id,
          r.rating,
          r.comment,
          r.is_verified_purchase,
          r.created_at,
          u.name as user_name,
          u.id as user_id
         FROM reviews r
         JOIN users u ON r.user_id = u.id
         WHERE r.project_id = ?
         ORDER BY r.created_at DESC`,
        [projectId]
      );

      // Calculate average rating
      const [stats] = await db.query(
        `SELECT 
          AVG(rating) as average_rating,
          COUNT(*) as total_reviews
         FROM reviews 
         WHERE project_id = ?`,
        [projectId]
      );

      res.json({
        success: true,
        data: {
          reviews,
          average_rating: stats[0].average_rating ? parseFloat(stats[0].average_rating).toFixed(1) : 0,
          total_reviews: stats[0].total_reviews
        }
      });
    } catch (error) {
      console.error('Get reviews error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to fetch reviews'
      });
    }
  },

  // Submit a review
  submitReview: async (req, res) => {
    try {
      const { project_id, rating, comment } = req.body;
      const userId = req.user.id;

      // Validate rating
      if (!rating || rating < 1 || rating > 5) {
        return res.status(400).json({
          success: false,
          message: 'Rating must be between 1 and 5'
        });
      }

      // Check if user purchased this project
      const [orders] = await db.query(
        `SELECT id FROM orders 
         WHERE user_id = ? AND project_id = ? AND status = 'paid'
         LIMIT 1`,
        [userId, project_id]
      );

      if (orders.length === 0) {
        return res.status(403).json({
          success: false,
          message: 'You must purchase this project before reviewing'
        });
      }

      const orderId = orders[0].id;

      // Check if review already exists
      const [existing] = await db.query(
        'SELECT id FROM reviews WHERE user_id = ? AND project_id = ?',
        [userId, project_id]
      );

      if (existing.length > 0) {
        // Update existing review
        await db.query(
          `UPDATE reviews 
           SET rating = ?, comment = ?, updated_at = NOW()
           WHERE user_id = ? AND project_id = ?`,
          [rating, comment, userId, project_id]
        );
      } else {
        // Insert new review
        await db.query(
          `INSERT INTO reviews (project_id, user_id, order_id, rating, comment)
           VALUES (?, ?, ?, ?, ?)`,
          [project_id, userId, orderId, rating, comment]
        );
      }

      res.json({
        success: true,
        message: 'Review submitted successfully'
      });
    } catch (error) {
      console.error('Submit review error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to submit review'
      });
    }
  },

  // Delete review
  deleteReview: async (req, res) => {
    try {
      const { id } = req.params;
      const userId = req.user.id;

      const [result] = await db.query(
        'DELETE FROM reviews WHERE id = ? AND user_id = ?',
        [id, userId]
      );

      if (result.affectedRows === 0) {
        return res.status(404).json({
          success: false,
          message: 'Review not found or unauthorized'
        });
      }

      res.json({
        success: true,
        message: 'Review deleted successfully'
      });
    } catch (error) {
      console.error('Delete review error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to delete review'
      });
    }
  }
};

module.exports = reviewController;


================================================
FILE: backend\src\controllers\wishlist.controller.js
================================================
// src/controllers/wishlist.controller.js
const db = require('../config/db');

const wishlistController = {
  // Get user's wishlist
  getWishlist: async (req, res) => {
    try {
      const userId = req.user.id;

      const [items] = await db.query(
        `SELECT 
          w.id as wishlist_id,
          p.id,
          p.title,
          p.description,
          p.price,
          p.thumbnail,
          p.category,
          p.difficulty,
          p.average_rating,
          p.reviews_count,
          w.created_at as added_at
         FROM wishlist w
         JOIN projects p ON w.project_id = p.id
         WHERE w.user_id = ?
         ORDER BY w.created_at DESC`,
        [userId]
      );

      res.json({
        success: true,
        data: items
      });
    } catch (error) {
      console.error('Get wishlist error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to fetch wishlist'
      });
    }
  },

  // Add to wishlist
  addToWishlist: async (req, res) => {
    try {
      const { project_id } = req.body;
      const userId = req.user.id;

      // Check if project exists
      const [projects] = await db.query(
        'SELECT id FROM projects WHERE id = ?',
        [project_id]
      );

      if (projects.length === 0) {
        return res.status(404).json({
          success: false,
          message: 'Project not found'
        });
      }

      // Check if already in wishlist
      const [existing] = await db.query(
        'SELECT id FROM wishlist WHERE user_id = ? AND project_id = ?',
        [userId, project_id]
      );

      if (existing.length > 0) {
        return res.status(400).json({
          success: false,
          message: 'Project already in wishlist'
        });
      }

      // Add to wishlist
      await db.query(
        'INSERT INTO wishlist (user_id, project_id) VALUES (?, ?)',
        [userId, project_id]
      );

      res.status(201).json({
        success: true,
        message: 'Added to wishlist'
      });
    } catch (error) {
      console.error('Add to wishlist error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to add to wishlist'
      });
    }
  },

  // Remove from wishlist
  removeFromWishlist: async (req, res) => {
    try {
      const { projectId } = req.params;
      const userId = req.user.id;

      const [result] = await db.query(
        'DELETE FROM wishlist WHERE user_id = ? AND project_id = ?',
        [userId, projectId]
      );

      if (result.affectedRows === 0) {
        return res.status(404).json({
          success: false,
          message: 'Item not found in wishlist'
        });
      }

      res.json({
        success: true,
        message: 'Removed from wishlist'
      });
    } catch (error) {
      console.error('Remove from wishlist error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to remove from wishlist'
      });
    }
  }
};

module.exports = wishlistController;


================================================
FILE: backend\src\middlewares\auth.middleware.js
================================================
ï»¿// src/middlewares/auth.middleware.js
const jwt = require('jsonwebtoken');
const db = require('../config/db');

/**
 * authOptional - Allows anonymous browsing but attaches req.user if token valid
 */
const authOptional = async (req, res, next) => {
  try {
    const authHeader = req.headers.authorization;
    
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      req.user = null;
      return next();
    }
    
    const token = authHeader.split(' ')[1];
    
    try {
      const decoded = jwt.verify(token, process.env.JWT_SECRET);
      
      // FIXED: No array destructuring
      const users = await db.query(
        'SELECT id, email, name, role FROM users WHERE id = ?',
        [decoded.id]
      );
      
      if (users && users.length > 0) {
        req.user = users[0];
      } else {
        req.user = null;
      }
    } catch (jwtError) {
      req.user = null;
    }
    
    next();
  } catch (error) {
    req.user = null;
    next();
  }
};

/**
 * authRequired - Blocks access unless a valid JWT is provided
 */
const authRequired = async (req, res, next) => {
  try {
    const authHeader = req.headers.authorization;
    
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      return res.status(401).json({
        success: false,
        message: 'Access denied. No token provided.'
      });
    }
    
    const token = authHeader.split(' ')[1];
    
    try {
      const decoded = jwt.verify(token, process.env.JWT_SECRET);
      
      // FIXED: No array destructuring
      const users = await db.query(
        'SELECT id, email, name, role FROM users WHERE id = ?',
        [decoded.id]
      );
      
      if (!users || users.length === 0) {
        return res.status(401).json({
          success: false,
          message: 'User not found or has been deactivated.'
        });
      }
      
      req.user = users[0];
      next();
    } catch (jwtError) {
      if (jwtError.name === 'TokenExpiredError') {
        return res.status(401).json({
          success: false,
          message: 'Token has expired. Please login again.'
        });
      }
      
      return res.status(401).json({
        success: false,
        message: 'Invalid token.'
      });
    }
  } catch (error) {
    console.error('Auth middleware error:', error);
    return res.status(500).json({
      success: false,
      message: 'Authentication error.'
    });
  }
};

/**
 * adminOnly - Only admin users can access these routes
 */
const adminOnly = async (req, res, next) => {
  try {
    const authHeader = req.headers.authorization;
    
    console.log('ðŸ” [ADMIN CHECK] Authorization Header:', authHeader ? 'Present âœ“' : 'Missing âœ—');
    
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      console.log('ðŸ” [ADMIN CHECK] Failed: No Bearer token');
      return res.status(401).json({
        success: false,
        message: 'Access denied. No token provided.'
      });
    }
    
    const token = authHeader.split(' ')[1];
    console.log('ðŸ” [ADMIN CHECK] Token:', token.substring(0, 30) + '...');
    
    try {
      const decoded = jwt.verify(token, process.env.JWT_SECRET);
      console.log('ðŸ” [ADMIN CHECK] Decoded:', decoded);
      
      // FIXED: No array destructuring
      const users = await db.query(
        'SELECT id, email, name, role FROM users WHERE id = ?',
        [decoded.id]
      );
      
      console.log('ðŸ” [ADMIN CHECK] Query result:', users);
      
      if (!users || users.length === 0) {
        console.log('ðŸ” [ADMIN CHECK] Failed: User not found in DB');
        return res.status(401).json({
          success: false,
          message: 'User not found.'
        });
      }
      
      const user = users[0];
      console.log('ðŸ” [ADMIN CHECK] User from DB:', user);
      
      if (user.role !== 'admin') {
        console.log('ðŸ” [ADMIN CHECK] Failed: User role is', user.role, 'not admin');
        return res.status(403).json({
          success: false,
          message: 'Access denied. Admin privileges required.'
        });
      }
      
      console.log('ðŸ” [ADMIN CHECK] Success! User is admin âœ“');
      req.user = user;
      next();
    } catch (jwtError) {
      console.log('ðŸ” [ADMIN CHECK] JWT Error:', jwtError.message);
      return res.status(401).json({
        success: false,
        message: 'Invalid or expired token.'
      });
    }
  } catch (error) {
    console.error('ðŸ” [ADMIN CHECK] Unexpected error:', error);
    return res.status(500).json({
      success: false,
      message: 'Authorization error.'
    });
  }
};

/**
 * Generate JWT token
 */
const generateToken = (user) => {
  return jwt.sign(
    {
      id: user.id,
      email: user.email,
      role: user.role
    },
    process.env.JWT_SECRET,
    { expiresIn: process.env.JWT_EXPIRES_IN || '7d' }
  );
};

module.exports = {
  authOptional,
  authRequired,
  adminOnly,
  generateToken
};


================================================
FILE: backend\src\middlewares\authOptional.js
================================================
// src/middlewares/authOptional.js
const jwt = require("jsonwebtoken");
const db = require('../config/db');

module.exports = async function authOptional(req, res, next) {
  try {
    const authHeader = req.headers.authorization;

    if (authHeader && authHeader.startsWith("Bearer ")) {
      const token = authHeader.split(" ")[1];
      
      try {
        const decoded = jwt.verify(token, process.env.JWT_SECRET);
        
        // FIX: Removed array destructuring [users] -> users
        const users = await db.query(
          'SELECT id, email, name, role FROM users WHERE id = ?',
          [decoded.id]
        );
        
        if (users && users.length > 0) {
          req.user = users[0]; // Correctly attach user
        } else {
          req.user = null;
        }
      } catch (jwtError) {
        req.user = null;
      }
    } else {
      req.user = null;
    }
  } catch (err) {
    req.user = null;
  }

  next();
};


================================================
FILE: backend\src\middlewares\error.middleware.js
================================================
ï»¿module.exports = (err, req, res, next) => {
  console.error(err);
  res.status(err.status || 500).json({ error: err.message || "Internal Server Error" });
};



================================================
FILE: backend\src\models\payment.model.js
================================================
ï»¿/* payment.model.js - simple wrapper */
const pool = require("../config/db");

module.exports = {
  create: async ({ user_id, order_id, payment_id, signature, status }) => {
    const [result] = await pool.query("INSERT INTO payments (user_id, order_id, payment_id, signature, status, created_at) VALUES (?, ?, ?, ?, ?, NOW())", [user_id, order_id, payment_id, signature, status]);
    return result.insertId;
  }
};



================================================
FILE: backend\src\models\project.model.js
================================================
ï»¿/* project.model.js - simple wrapper */
const pool = require("../config/db");

module.exports = {
  list: async () => {
    const [rows] = await pool.query("SELECT id, title, description, price, thumbnail FROM projects ORDER BY id DESC");
    return rows;
  }
};



================================================
FILE: backend\src\models\user.model.js
================================================
ï»¿/* user.model.js - simple query wrapper */
const pool = require("../config/db");

module.exports = {
  findByEmail: async (email) => {
    const [rows] = await pool.query("SELECT id, email, password_hash FROM users WHERE email = ?", [email]);
    return rows[0];
  }
};



================================================
FILE: backend\src\routes\admin.routes.js
================================================
const express = require('express');
const { body } = require('express-validator');
const router = express.Router();
const adminController = require('../controllers/admin.controller');
const { adminOnly } = require('../middlewares/auth.middleware');

// All admin routes require admin authentication
router.use(adminOnly);

// Project management
router.post(
  '/projects',
  [
    body('title').trim().notEmpty().withMessage('Title is required'),
    body('description').trim().notEmpty().withMessage('Description is required'),
    body('price').isFloat({ min: 0 }).withMessage('Valid price is required'),
    body('thumbnail').optional().isURL().withMessage('Valid thumbnail URL is required'),
    body('content_url').optional().isURL().withMessage('Valid content URL is required')
  ],
  adminController.createProject
);

router.put('/projects/:id', adminController.updateProject);
router.delete('/projects/:id', adminController.deleteProject);

// Order management
router.get('/orders', adminController.getAllOrders);

// User management
router.get('/users', adminController.getAllUsers);

// Dashboard
router.get('/stats', adminController.getDashboardStats);

module.exports = router;


================================================
FILE: backend\src\routes\auth.routes.js
================================================
ï»¿const express = require('express');
const { body } = require('express-validator');
const router = express.Router();
const authController = require('../controllers/auth.controller');
const { authRequired } = require('../middlewares/auth.middleware');

// Validation rules
const registerValidation = [
  body('email')
    .isEmail()
    .normalizeEmail()
    .withMessage('Please provide a valid email'),
  body('password')
    .isLength({ min: 6 })
    .withMessage('Password must be at least 6 characters'),
  body('name')
    .trim()
    .isLength({ min: 2, max: 100 })
    .withMessage('Name must be between 2 and 100 characters')
];

const loginValidation = [
  body('email')
    .isEmail()
    .normalizeEmail()
    .withMessage('Please provide a valid email'),
  body('password')
    .notEmpty()
    .withMessage('Password is required')
];

// Routes
router.post('/register', registerValidation, authController.register);
router.post('/login', loginValidation, authController.login);
router.get('/me', authRequired, authController.getMe);
router.put('/profile', authRequired, authController.updateProfile);
router.put('/password', authRequired, authController.changePassword);

module.exports = router;


================================================
FILE: backend\src\routes\coupon.routes.js
================================================
// src/routes/coupon.routes.js
const express = require('express');
const router = express.Router();
const couponController = require('../controllers/coupon.controller');
const { authRequired, adminOnly } = require('../middlewares/auth.middleware');

// User routes
router.post('/validate', authRequired, couponController.validateCoupon);

// Admin routes
router.get('/', adminOnly, couponController.getAllCoupons);
router.post('/', adminOnly, couponController.createCoupon);

module.exports = router;


================================================
FILE: backend\src\routes\order.routes.js
================================================
const express = require("express");
const router = express.Router();
const db = require("../config/db");
const { authRequired } = require("../middlewares/auth.middleware");

// ---------------------------
// GET USER ORDERS (Orders Tab)
// ---------------------------
router.get("/", authRequired, async (req, res) => {
  try {
    const orders = await db.query(
      `SELECT o.id, o.project_id, o.amount, o.status, o.created_at,
              p.title AS project_title, p.thumbnail AS project_thumbnail,
              p.category AS project_category
       FROM orders o
       JOIN projects p ON o.project_id = p.id
       WHERE o.user_id = ?
       ORDER BY o.created_at DESC`,
      [req.user.id]
    );

    return res.json({ success: true, data: { orders } });
  } catch (error) {
    console.error("Get orders error:", error);
    return res.json({ success: false, message: "Failed to load orders" });
  }
});

// ---------------------------
// GET USER DOWNLOADABLE PROJECTS (Downloads Tab)
// ---------------------------
// ---------------------------
// GET USER DOWNLOADABLE PROJECTS (Downloads Tab)
// ---------------------------
// ðŸ‘‡ CHANGED FROM "/downloads" TO "/purchased"
router.get("/purchased", authRequired, async (req, res) => {
  try {
    const downloads = await db.query(
      `SELECT p.id, p.title, p.thumbnail, p.content_url, o.created_at AS purchased_at
       FROM orders o
       JOIN projects p ON o.project_id = p.id
       WHERE o.user_id = ? AND o.status = 'paid'
       ORDER BY o.created_at DESC`,
      [req.user.id]
    );

    return res.json({ success: true, data: { downloads } });
  } catch (error) {
    console.error("Get downloads error:", error);
    return res.json({ success: false, message: "Failed to load downloads" });
  }
});

module.exports = router;



================================================
FILE: backend\src\routes\payment.routes.js
================================================
ï»¿const express = require("express");
const router = express.Router();
const { authRequired } = require("../middlewares/auth.middleware");
const paymentController = require("../controllers/payment.controller");

// All payment routes require authentication
router.use(authRequired);

// Create order
router.post("/create-order", paymentController.createOrder);

// Verify payment
router.post("/verify", paymentController.verifyPayment);

module.exports = router;



================================================
FILE: backend\src\routes\project.routes.js
================================================
ï»¿const express = require('express');
const router = express.Router();

const projectController = require('../controllers/project.controller');
const { authRequired } = require('../middlewares/auth.middleware');
const authOptional = require('../middlewares/authOptional');

// Public routes
router.get('/', authOptional, projectController.getAllProjects);
router.get('/categories', projectController.getCategories);
router.get('/:id', authOptional, projectController.getProjectById);


// Protected route (download only for paid users or admin)
router.get('/:id/download', authRequired, projectController.downloadProject);

module.exports = router;



================================================
FILE: backend\src\routes\review.routes.js
================================================
// src/routes/review.routes.js
const express = require('express');
const router = express.Router();
const reviewController = require('../controllers/review.controller');
const { authRequired } = require('../middlewares/auth.middleware');
const authOptional = require('../middlewares/authOptional');

// Public routes (optional auth)
router.get('/:projectId', authOptional, reviewController.getProjectReviews);

// Protected routes
router.post('/', authRequired, reviewController.submitReview);
router.delete('/:id', authRequired, reviewController.deleteReview);

module.exports = router;


================================================
FILE: backend\src\routes\wishlist.routes.js
================================================
// src/routes/wishlist.routes.js
const express = require('express');
const router = express.Router();
const wishlistController = require('../controllers/wishlist.controller');
const { authRequired } = require('../middlewares/auth.middleware');

// All wishlist routes require authentication
router.get('/', authRequired, wishlistController.getWishlist);
router.post('/', authRequired, wishlistController.addToWishlist);
router.delete('/:projectId', authRequired, wishlistController.removeFromWishlist);

module.exports = router;


================================================
FILE: backend\src\services\razorpay.js
================================================
ï»¿const Razorpay = require('razorpay');

/**
 * Razorpay Service
 * Supports both real Razorpay and mock payment modes
 */
class RazorpayService {
  constructor() {
    this.isMockMode = !process.env.RAZORPAY_KEY_ID || !process.env.RAZORPAY_KEY_SECRET;
    
    if (!this.isMockMode) {
      this.razorpay = new Razorpay({
        key_id: process.env.RAZORPAY_KEY_ID,
        key_secret: process.env.RAZORPAY_KEY_SECRET
      });
      console.log('ðŸ’³ Razorpay initialized in LIVE mode');
    } else {
      console.log('ðŸ’³ Razorpay initialized in MOCK mode');
    }
  }

  /**
   * Create a new order
   * @param {Object} options - Order options
   * @param {number} options.amount - Amount in paise
   * @param {string} options.currency - Currency code (INR)
   * @param {string} options.receipt - Receipt ID
   * @param {Object} options.notes - Additional notes
   * @returns {Promise<Object>} Order object
   */
  async createOrder({ amount, currency = 'INR', receipt, notes = {} }) {
    if (this.isMockMode) {
      // Return mock order
      return {
        id: `order_mock_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        entity: 'order',
        amount: amount,
        amount_paid: 0,
        amount_due: amount,
        currency: currency,
        receipt: receipt,
        status: 'created',
        notes: notes,
        created_at: Math.floor(Date.now() / 1000)
      };
    }

    try {
      const order = await this.razorpay.orders.create({
        amount,
        currency,
        receipt,
        notes
      });
      return order;
    } catch (error) {
      console.error('Razorpay create order error:', error);
      throw new Error('Failed to create payment order');
    }
  }

  /**
   * Fetch order details
   * @param {string} orderId - Razorpay order ID
   * @returns {Promise<Object>} Order details
   */
  async fetchOrder(orderId) {
    if (this.isMockMode) {
      return {
        id: orderId,
        status: 'paid',
        amount: 0,
        currency: 'INR'
      };
    }

    try {
      return await this.razorpay.orders.fetch(orderId);
    } catch (error) {
      console.error('Razorpay fetch order error:', error);
      throw new Error('Failed to fetch order details');
    }
  }

  /**
   * Fetch payment details
   * @param {string} paymentId - Razorpay payment ID
   * @returns {Promise<Object>} Payment details
   */
  async fetchPayment(paymentId) {
    if (this.isMockMode) {
      return {
        id: paymentId,
        status: 'captured',
        amount: 0,
        currency: 'INR'
      };
    }

    try {
      return await this.razorpay.payments.fetch(paymentId);
    } catch (error) {
      console.error('Razorpay fetch payment error:', error);
      throw new Error('Failed to fetch payment details');
    }
  }

  /**
   * Verify payment signature
   * @param {Object} params - Verification parameters
   * @param {string} params.order_id - Razorpay order ID
   * @param {string} params.payment_id - Razorpay payment ID
   * @param {string} params.signature - Payment signature
   * @returns {boolean} Whether signature is valid
   */
  verifyPaymentSignature({ order_id, payment_id, signature }) {
    if (this.isMockMode) {
      return true;
    }

    const crypto = require('crypto');
    const expectedSignature = crypto
      .createHmac('sha256', process.env.RAZORPAY_KEY_SECRET)
      .update(`${order_id}|${payment_id}`)
      .digest('hex');

    return expectedSignature === signature;
  }

  /**
   * Check if running in mock mode
   * @returns {boolean}
   */
  isMock() {
    return this.isMockMode;
  }
}

module.exports = new RazorpayService();


================================================
FILE: backend\src\utils\jwt.js
================================================
ï»¿const jwt = require("jsonwebtoken");
const SECRET = process.env.JWT_SECRET || "change_me";

module.exports = {
  sign: (payload) => jwt.sign(payload, SECRET, { expiresIn: "7d" }),
  verify: (token) => jwt.verify(token, SECRET)
};



================================================
FILE: backend\src\utils\validator.js
================================================
ï»¿/* validator.js - placeholder for input validation */
module.exports = {
  requireFields: (obj, fields) => {
    for (const f of fields) {
      if (!Object.prototype.hasOwnProperty.call(obj, f) || obj[f] === undefined || obj[f] === null || obj[f] === "") {
        return { ok: false, missing: f };
      }
    }
    return { ok: true };
  }
};



================================================
FILE: backend\test-db.js
================================================
const pool = require("./src/config/db");

(async () => {
  try {
    const [rows] = await pool.query("SELECT 1 + 1 AS result");
    console.log("DB Connected. Result:", rows);
  } catch (err) {
    console.error("DB Error:", err);
  } finally {
    process.exit();
  }
})();



================================================
FILE: frontend\.gitignore
================================================
# Dependencies
node_modules
.pnp
.pnp.js

# Environment variables
.env
.env.local
.env.production

# Testing
coverage

# Production
dist
dist-ssr
*.local

# Editor
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# Logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*


================================================
FILE: frontend\eslint.config.js
================================================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])



================================================
FILE: frontend\index.html
================================================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>InovitaZ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Favicon (PNG OK) -->
    <link rel="icon" type="image/png" href="/InovitaZ.png" />

    <!-- Razorpay checkout (required for frontend popup) -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>



================================================
FILE: frontend\package.json
================================================
{
  "name": "inovitaz-frontend",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0"
  },
  "dependencies": {
    "axios": "^1.6.2",
    "linkifyjs": "^4.3.2",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-hot-toast": "^2.6.0",
    "react-icons": "^4.12.0",
    "react-linkify": "^1.0.0-alpha",
    "react-router-dom": "^6.21.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.16",
    "eslint": "^8.55.0",
    "eslint-plugin-react": "^7.33.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.5",
    "postcss": "^8.4.32",
    "tailwindcss": "^3.3.6",
    "vite": "^7.2.4"
  }
}



================================================
FILE: frontend\postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};


================================================
FILE: frontend\README.md
================================================
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.



================================================
FILE: frontend\src\api\auth.js
================================================
import axios from 'axios';

const API_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:4000/api';  // âœ… Changed from VITE_API_URL

const api = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Add auth token to requests
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Handle response errors
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      // Optionally redirect to login
      if (window.location.pathname !== '/login') {
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);

export const authAPI = {
  register: async (data) => {
    const response = await api.post('/auth/register', data);
    return response.data;
  },

  login: async (data) => {
    const response = await api.post('/auth/login', data);
    return response.data;
  },

  getMe: async () => {
    const response = await api.get('/auth/me');
    return response.data;
  },

  updateProfile: async (data) => {
    const response = await api.put('/auth/profile', data);
    return response.data;
  },

  changePassword: async (data) => {
    const response = await api.put('/auth/password', data);
    return response.data;
  },
};

export default api;



================================================
FILE: frontend\src\api\axios.js
================================================
import axios from "axios";

const api = axios.create({
  baseURL: "http://localhost:4000/api",
});

api.interceptors.request.use((config) => {
  const token = localStorage.getItem("token");
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

export default api;



================================================
FILE: frontend\src\api\payments.js
================================================
ï»¿import api from './auth';

const API_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:4000/api';

export const paymentsAPI = {
  createOrder: async (projectId, couponCode = null) => {
    const response = await api.post('/payment/create-order', { 
      projectId,
      couponCode 
    });
    return response.data;
  },

  verifyPayment: async (data) => {
    const response = await api.post('/payment/verify-payment', data);
    return response.data;
  },

  getStatus: async (orderId) => {
    const response = await api.get(`/payment/status/${orderId}`);
    return response.data;
  },
};

export const ordersAPI = {
  getMyOrders: async () => {
    const res = await fetch(`${API_URL}/orders`, {  // âœ… FIXED: consistent API_URL
      headers: {
        Authorization: `Bearer ${localStorage.getItem("token")}`,
      },
    });
    return res.json();
  },

  getPurchased: async () => {
    const res = await fetch(`${API_URL}/orders/purchased`, {  // âœ… FIXED: changed from /downloads
      headers: {
        Authorization: `Bearer ${localStorage.getItem("token")}`,
      },
    });
    const data = await res.json();
    
    // Map response to expected format
    return {
      success: data.success,
      data: {
        downloads: data.data || []
      }
    };
  },
};


================================================
FILE: frontend\src\api\projects.js
================================================
// src/api/projects.js
const API_URL = 'http://localhost:4000/api';

// Read token from localStorage
const getToken = () => localStorage.getItem('token');

// PUBLIC PROJECT APIs
export const projectsAPI = {
  getAll: async (params = {}) => {
    try {
      const q = new URLSearchParams(params).toString();
      const res = await fetch(`${API_URL}/projects?${q}`);
      return await res.json();
    } catch (err) {
      console.error('Error fetching projects:', err);
      return { success: false, data: { projects: [] } };
    }
  },

  getById: async (id) => {
    const token = localStorage.getItem("token");

    const response = await fetch(`${API_URL}/projects/${id}`, {
      headers: token ? { Authorization: `Bearer ${token}` } : {}
    });

    const res = await response.json();

    // Normalize backend structure for frontend
    return {
      success: res.success,
      data: res.data?.project || res.data || null
    };
  },

  getByCategory: async (category) => {
    try {
      const res = await fetch(`${API_URL}/projects?category=${category}`);
      return await res.json();
    } catch (err) {
      console.error('Error fetching projects:', err);
      return { success: false, data: { projects: [] } };
    }
  },

  // âœ… ADDED: Get categories function
  getCategories: async () => {
    try {
      const res = await fetch(`${API_URL}/projects/categories`);
      const data = await res.json();
      return data;
    } catch (err) {
      console.error('Error fetching categories:', err);
      // Fallback to hardcoded categories if API not ready
      return { 
        success: true, 
        data: [
          { category: 'IoT', count: 0 },
          { category: 'Arduino', count: 0 },
          { category: 'ESP32', count: 0 },
          { category: 'Raspberry Pi', count: 0 },
          { category: 'Robotics', count: 0 }
        ] 
      };
    }
  },

  // âš ï¸ MODIFIED: Wishlist functions (disabled until backend ready)
  getWishlist: async () => {
    // Return empty wishlist until backend is ready
    return { success: true, data: [] };
    
    /* UNCOMMENT WHEN BACKEND IS READY:
    try {
      const token = getToken();
      if (!token) return { success: false, data: [] };

      const res = await fetch(`${API_URL}/wishlist`, {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });
      return await res.json();
    } catch (err) {
      console.error('Error fetching wishlist:', err);
      return { success: false, data: [] };
    }
    */
  },

  addToWishlist: async (projectId) => {
    // Temporarily use localStorage until backend ready
    const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
    if (!wishlist.includes(projectId)) {
      wishlist.push(projectId);
      localStorage.setItem('wishlist', JSON.stringify(wishlist));
    }
    return { success: true, message: 'Added to wishlist (local)' };
    
    /* UNCOMMENT WHEN BACKEND IS READY:
    try {
      const token = getToken();
      if (!token) throw new Error('Not authenticated');

      const res = await fetch(`${API_URL}/wishlist`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ project_id: projectId })
      });
      return await res.json();
    } catch (err) {
      console.error('Error adding to wishlist:', err);
      return { success: false, message: err.message };
    }
    */
  },

  removeFromWishlist: async (projectId) => {
    // Temporarily use localStorage until backend ready
    let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
    wishlist = wishlist.filter(id => id !== projectId);
    localStorage.setItem('wishlist', JSON.stringify(wishlist));
    return { success: true, message: 'Removed from wishlist (local)' };
    
    /* UNCOMMENT WHEN BACKEND IS READY:
    try {
      const token = getToken();
      if (!token) throw new Error('Not authenticated');

      const res = await fetch(`${API_URL}/wishlist/${projectId}`, {
        method: 'DELETE',
        headers: {
          Authorization: `Bearer ${token}`
        }
      });
      return await res.json();
    } catch (err) {
      console.error('Error removing from wishlist:', err);
      return { success: false, message: err.message };
    }
    */
  },

  download: async (projectId) => {
    try {
      const token = localStorage.getItem("token");

      const response = await fetch(`${API_URL}/projects/${projectId}/download`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          Authorization: token ? `Bearer ${token}` : "",
        },
      });

      return await response.json();
    } catch (error) {
      console.error("Download request failed:", error);
      return { success: false, message: "Download failed" };
    }
  },
};


// FIXED ADMIN FETCH (with Bearer auth)
const adminFetch = async (url, options = {}) => {
  const token = getToken();

  const res = await fetch(url, {
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${token}`,
      ...(options.headers || {}),
    },
    ...options,
  });

  return await res.json();
};

// ADMIN APIs
export const adminProjectsAPI = {
  getStats: async () => {
    return await adminFetch(`${API_URL}/admin/stats`);
  },

  create: async (data) => {
    return await adminFetch(`${API_URL}/admin/projects`, {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },

  update: async (id, data) => {
    return await adminFetch(`${API_URL}/admin/projects/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },

  delete: async (id) => {
    return await adminFetch(`${API_URL}/admin/projects/${id}`, {
      method: 'DELETE',
    });
  },

  getAllOrders: async () => {
    return await adminFetch(`${API_URL}/admin/orders`);
  },

  getAllUsers: async () => {
    return await adminFetch(`${API_URL}/admin/users`);
  },
};


================================================
FILE: frontend\src\App.css
================================================
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}



================================================
FILE: frontend\src\App.jsx
================================================
ï»¿import { Routes, Route } from 'react-router-dom';
import Navbar from './components/Navbar';
import Footer from './components/Footer';
import ProtectedRoute from './components/ProtectedRoute';
import AdminRoute from './components/AdminRoute';
import ScrollToTop from './components/ScrollToTop'; // âœ… Imported

// Pages
import Home from './pages/Home';
import Projects from './pages/Projects';
import ProjectDetails from './pages/ProjectDetails';
import Login from './pages/Login';
import Signup from './pages/Signup';
import Dashboard from './pages/Dashboard';
import AdminDashboard from './pages/AdminDashboard';
import NotFound from './pages/NotFound';
import Support from './pages/Support';
import About from "./pages/About";
import Privacy from "./pages/Privacy";
import Terms from "./pages/Terms";
import Refund from "./pages/Refund";

function App() {
  return (
    <div className="min-h-screen flex flex-col">
      {/* ðŸ‘‡ ADD THIS LINE HERE ðŸ‘‡ */}
      <ScrollToTop />
      
      <Navbar />
      <main className="flex-grow">
        <Routes>
          {/* Public Routes */}
          <Route path="/" element={<Home />} />
          <Route path="/projects" element={<Projects />} />
          <Route path="/projects/:id" element={<ProjectDetails />} />
          <Route path="/login" element={<Login />} />
          <Route path="/signup" element={<Signup />} />
          <Route path="/support" element={<Support />} />
          <Route path="/about" element={<About />} />
          <Route path="/privacy" element={<Privacy />} />
          <Route path="/terms" element={<Terms />} />
          <Route path="/refund" element={<Refund />} />

          {/* Protected Routes */}
          <Route
            path="/dashboard"
            element={
              <ProtectedRoute>
                <Dashboard />
              </ProtectedRoute>
            }
          />

          {/* Admin Routes */}
          <Route
            path="/admin/*"
            element={
              <AdminRoute>
                <AdminDashboard />
              </AdminRoute>
            }
          />

          {/* 404 */}
          <Route path="*" element={<NotFound />} />
        </Routes>
      </main>
      <Footer />
    </div>
  );
}

export default App;


================================================
FILE: frontend\src\components\AdminRoute.jsx
================================================
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';

const AdminRoute = ({ children }) => {
  const { isAuthenticated, isAdmin, loading } = useAuth();
  const location = useLocation();

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="loader"></div>
      </div>
    );
  }

  if (!isAuthenticated) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  if (!isAdmin) {
    return <Navigate to="/" replace />;
  }

  return children;
};

export default AdminRoute;



================================================
FILE: frontend\src\components\BuyModal.jsx
================================================
ï»¿import React, { useEffect, useState } from "react";
import { createOrder, confirmPayment } from "../api/payments";

export default function BuyModal({ project, token, onClose, onSuccess }) {
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!document.getElementById("razorpay-script")) {
      const s = document.createElement("script");
      s.src = "https://checkout.razorpay.com/v1/checkout.js";
      s.id = "razorpay-script";
      document.body.appendChild(s);
    }
  }, []);

  async function handlePay() {
    setLoading(true);
    const resp = await createOrder(token, project.id);
    if (!resp.order) { alert("order failed"); setLoading(false); return; }
    const options = {
      key: import.meta.env.VITE_RAZORPAY_KEY_ID || "",
      amount: resp.order.amount,
      currency: resp.order.currency || "INR",
      name: "InovitaZ",
      description: project.title,
      order_id: resp.order.id,
      handler: async function (response) {
        const confirm = await confirmPayment(token, {
          razorpay_payment_id: response.razorpay_payment_id,
          razorpay_order_id: response.razorpay_order_id,
          signature: response.razorpay_signature
        });
        if (confirm.ok) {
          onSuccess && onSuccess();
          onClose && onClose();
        } else {
          alert("Payment verification failed");
        }
      }
    };
    const rzp = new window.Razorpay(options);
    rzp.open();
    setLoading(false);
  }

  return (
    <div style={{ position: "fixed", inset: 0, display: "grid", placeItems: "center", background: "rgba(0,0,0,0.6)" }}>
      <div style={{ background: "#fff", color: "#000", padding: 20, width: 560, borderRadius: 8 }}>
        <h3>Buy {project.title}</h3>
        <p>Price: Ã¢â€šÂ¹{Math.round(project.price/100)}</p>
        <div style={{ display: "flex", justifyContent: "flex-end", gap: 8 }}>
          <button onClick={onClose}>Close</button>
          <button onClick={handlePay} disabled={loading}>{loading ? "..." : "Pay"}</button>
        </div>
      </div>
    </div>
  );
}



================================================
FILE: frontend\src\components\Footer.jsx
================================================
import { Link } from "react-router-dom";
import { useContext } from "react";
import { AuthContext } from "../context/AuthContext";
import { 
  HiMail, 
  HiPhone, 
  HiLocationMarker, 
  HiChat, 
  HiArrowRight,
  HiShieldCheck,
  HiCreditCard 
} from "react-icons/hi";
import { FaInstagram, FaFacebook, FaLinkedin, FaYoutube } from "react-icons/fa"; // Standard social icons

const Footer = () => {
  const currentYear = new Date().getFullYear();
  const { user } = useContext(AuthContext);

  return (
    <footer className="bg-secondary-900 text-secondary-300 mt-auto border-t border-secondary-800">
      
      {/* ========= CTA SECTION (For Visitors Only) ========= */}
      {!user && (
        <div className="relative bg-secondary-800 border-b border-secondary-700">
          <div className="max-w-7xl mx-auto px-6 py-10">
            <div className="flex flex-col md:flex-row items-center justify-between gap-6 text-center md:text-left">
              <div>
                <h3 className="text-xl font-bold text-white mb-1">Need help choosing a project?</h3>
                <p className="text-secondary-400 text-sm">Our engineering team is available 24/7 to assist you.</p>
              </div>
              <div className="flex flex-wrap justify-center gap-3">
                <a
                  href="https://wa.me/919705594777"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="px-5 py-2.5 rounded-lg bg-green-600 hover:bg-green-700 text-white text-sm font-medium flex items-center gap-2 transition-all shadow-lg shadow-green-900/20"
                >
                  <HiChat className="w-5 h-5" /> WhatsApp
                </a>
                <Link
                  to="/support"
                  className="px-5 py-2.5 rounded-lg bg-secondary-700 hover:bg-secondary-600 text-white text-sm font-medium flex items-center gap-2 transition-all"
                >
                  Contact Support <HiArrowRight />
                </Link>
              </div>
            </div>
          </div>
        </div>
      )}

      <div className="max-w-7xl mx-auto px-6 pt-16 pb-8">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12">
          
          {/* 1. Brand & Description */}
          <div className="space-y-4">
{/* Replace Logo Section with this: */}
<Link to="/" className="flex items-center gap-2 group">
  <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center shadow-lg shadow-blue-900/20 group-hover:scale-105 transition-transform">
    {/* Microchip Icon */}
    <svg className="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
    </svg>
  </div>
              <span className="text-2xl font-bold text-white tracking-tight">Inovitaz</span>
</Link>
            <p className="text-secondary-400 text-sm leading-relaxed">
              India's #1 Marketplace for IoT, Embedded Systems, and Robotics projects. 
              Get production-ready code, circuit diagrams, and expert support.
            </p>
            
            {/* Social Icons */}
            <div className="flex gap-4 pt-2">
              {[
                { icon: FaInstagram, link: "#" },
                { icon: FaFacebook, link: "#" },
                { icon: FaLinkedin, link: "#" },
                { icon: FaYoutube, link: "#" }
              ].map((social, idx) => (
                <a 
                  key={idx}
                  href={social.link} 
                  className="w-8 h-8 flex items-center justify-center rounded-full bg-secondary-800 hover:bg-primary-600 text-secondary-400 hover:text-white transition-all duration-300"
                >
                  <social.icon className="w-4 h-4" />
                </a>
              ))}
            </div>
          </div>

          {/* 2. Quick Links */}
          <div>
            <h3 className="text-white font-semibold text-lg mb-5">Explore</h3>
            <ul className="space-y-3 text-sm">
              <li><Link to="/projects" className="hover:text-primary-400 transition-colors flex items-center gap-2"><span className="w-1.5 h-1.5 rounded-full bg-primary-500"></span> Browse Projects</Link></li>
              <li><Link to="/projects?category=IoT" className="hover:text-primary-400 transition-colors flex items-center gap-2"><span className="w-1.5 h-1.5 rounded-full bg-secondary-600"></span> IoT Solutions</Link></li>
              <li><Link to="/projects?category=Robotics" className="hover:text-primary-400 transition-colors flex items-center gap-2"><span className="w-1.5 h-1.5 rounded-full bg-secondary-600"></span> Robotics</Link></li>
              <li><Link to="/about" className="hover:text-primary-400 transition-colors flex items-center gap-2"><span className="w-1.5 h-1.5 rounded-full bg-secondary-600"></span> About Us</Link></li>
            </ul>
          </div>

          {/* 3. Legal & Account */}
          <div>
            <h3 className="text-white font-semibold text-lg mb-5">Account</h3>
            <ul className="space-y-3 text-sm">
              {user ? (
                <>
                  <li><Link to="/dashboard" className="hover:text-primary-400 transition-colors">My Dashboard</Link></li>
                  <li><Link to="/dashboard" className="hover:text-primary-400 transition-colors">Order History</Link></li>
                </>
              ) : (
                <>
                  <li><Link to="/login" className="hover:text-primary-400 transition-colors">Login</Link></li>
                  <li><Link to="/signup" className="hover:text-primary-400 transition-colors">Register</Link></li>
                </>
              )}
              <li><Link to="/privacy" className="hover:text-primary-400 transition-colors">Privacy Policy</Link></li>
              <li><Link to="/terms" className="hover:text-primary-400 transition-colors">Terms & Conditions</Link></li>
              <li><Link to="/refund" className="hover:text-primary-400 transition-colors">Refund Policy</Link></li>
            </ul>
          </div>

          {/* 4. Newsletter & Contact */}
          <div>
            <h3 className="text-white font-semibold text-lg mb-5">Stay Updated</h3>
            <div className="bg-secondary-800 p-1 rounded-lg flex mb-6 border border-secondary-700">
              <input 
                type="email" 
                placeholder="Enter your email" 
                className="bg-transparent text-sm text-white px-3 py-2 w-full focus:outline-none placeholder-secondary-500"
              />
              <button className="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                Join
              </button>
            </div>

            <div className="space-y-3 text-sm">
              <div className="flex items-start gap-3">
                <HiLocationMarker className="w-5 h-5 text-primary-500 mt-0.5 flex-shrink-0" />
                <span>Amaravati, Andhra Pradesh,<br />India - 522020</span>
              </div>
              <div className="flex items-center gap-3">
                <HiPhone className="w-5 h-5 text-primary-500 flex-shrink-0" />
                <a href="tel:+919705594777" className="hover:text-white">+91 9705594777</a>
              </div>
              <div className="flex items-center gap-3">
                <HiMail className="w-5 h-5 text-primary-500 flex-shrink-0" />
                <a href="mailto:inovitaz.help@gmail.com" className="hover:text-white">inovitaz.help@gmail.com</a>
              </div>
            </div>
          </div>
        </div>

        {/* Footer Bottom */}
        <div className="pt-8 border-t border-secondary-800 flex flex-col md:flex-row justify-between items-center gap-4 text-sm">
          <p className="text-secondary-500 text-center md:text-left">
            Â© {currentYear} <span className="text-white font-medium">Inovitaz</span>. All Rights Reserved.
          </p>
          
          {/* Payment Trust Badges */}
          <div className="flex items-center gap-4">
            <div className="flex items-center gap-1 text-secondary-500 text-xs">
              <HiShieldCheck className="w-4 h-4 text-green-500" />
              <span>100% Secure Payment</span>
            </div>
            <div className="h-4 w-px bg-secondary-700"></div>
            <div className="flex items-center gap-2 text-secondary-400">
              <HiCreditCard className="w-6 h-6" title="Credit/Debit Card" />
              <span className="font-bold text-xs tracking-wider">UPI</span>
              <span className="font-bold text-xs tracking-wider">Razorpay</span>
            </div>
          </div>
        </div>
      </div>
    </footer>
  );
};

export default Footer;


================================================
FILE: frontend\src\components\LoadingSpinner.jsx
================================================
const LoadingSpinner = ({ size = 'medium', text = '' }) => {
  const sizeClasses = {
    small: 'w-6 h-6',
    medium: 'w-10 h-10',
    large: 'w-16 h-16',
  };

  return (
    <div className="flex flex-col items-center justify-center gap-3">
      <div className={`loader ${sizeClasses[size]}`}></div>
      {text && <p className="text-secondary-600 text-sm">{text}</p>}
    </div>
  );
};

export default LoadingSpinner;


================================================
FILE: frontend\src\components\Navbar.jsx
================================================
ï»¿// src/components/Navbar.jsx
import { useState } from 'react';
import { Link, NavLink, useNavigate } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import {
  HiMenu,
  HiX,
  HiLogout,
  HiViewGrid,
  HiHome,
  HiCollection,
  HiSupport,
  HiShieldCheck, // Changed from HiShoppingCart for Admin
} from 'react-icons/hi';

const Navbar = () => {
  const { user, isAuthenticated, isAdmin, logout } = useAuth();
  const [isOpen, setIsOpen] = useState(false);
  const [showDropdown, setShowDropdown] = useState(false);
  const navigate = useNavigate();

  const handleLogout = () => {
    logout();
    navigate('/');
    setShowDropdown(false);
    setIsOpen(false);
  };

  const navLinkClass = ({ isActive }) =>
    `flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${
      isActive
        ? 'bg-primary-100 text-primary-700 font-medium'
        : 'text-secondary-600 hover:bg-secondary-100 hover:text-secondary-900'
    }`;

  return (
    <nav className="bg-white shadow-sm sticky top-0 z-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between h-16">
          {/* Logo */}
{/* Replace Logo Section with this: */}
<Link to="/" className="flex items-center gap-2 group">
  <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center shadow-lg shadow-blue-900/20 group-hover:scale-105 transition-transform">
    {/* Microchip Icon */}
    <svg className="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
    </svg>
  </div>
  <span className="text-xl font-bold text-secondary-900 tracking-tight">Inovitaz</span>
</Link>

          {/* Desktop Navigation */}
          <div className="hidden md:flex items-center gap-2">
            <NavLink to="/" className={navLinkClass}>
              <HiHome className="w-5 h-5" />
              Home
            </NavLink>

            <NavLink to="/projects" className={navLinkClass}>
              <HiCollection className="w-5 h-5" />
              Projects
            </NavLink>

            <NavLink to="/support" className={navLinkClass}>
              <HiSupport className="w-5 h-5" />
              Support
            </NavLink>

            {isAuthenticated && (
              <>
                {/* Dashboard for logged-in users */}
                <NavLink to="/dashboard" className={navLinkClass}>
                  <HiViewGrid className="w-5 h-5" />
                  Dashboard
                </NavLink>

                {/* Admin link only for admins */}
                {isAdmin && (
                  <NavLink to="/admin" className={navLinkClass}>
                    <HiShieldCheck className="w-5 h-5" />
                    Admin
                  </NavLink>
                )}

                {/* User Dropdown */}
                <div className="relative ml-2">
                  <button
                    onClick={() => setShowDropdown(!showDropdown)}
                    className="flex items-center gap-2 px-3 py-2 rounded-lg bg-secondary-100 hover:bg-secondary-200 transition-colors"
                  >
                    <div className="w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center">
                      <span className="text-white font-medium text-sm">
                        {user?.name?.charAt(0).toUpperCase()}
                      </span>
                    </div>
                    <span className="text-secondary-700 font-medium max-w-[100px] truncate">
                      {user?.name}
                    </span>
                  </button>

                  {/* Dropdown Menu */}
                  {showDropdown && (
                    <>
                      {/* Invisible backdrop to close menu when clicking outside */}
                      <div 
                        className="fixed inset-0 z-10" 
                        onClick={() => setShowDropdown(false)}
                      ></div>
                      
                      <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-secondary-200 py-1 fade-in z-20">
                        <div className="px-4 py-2 border-b border-secondary-100">
                          <p className="text-sm font-medium text-secondary-900 truncate">
                            {user?.name}
                          </p>
                          <p className="text-xs text-secondary-500 truncate">
                            {user?.email}
                          </p>
                        </div>
                        <button
                          onClick={handleLogout}
                          className="w-full flex items-center gap-2 px-4 py-2 text-left text-red-600 hover:bg-red-50 transition-colors"
                        >
                          <HiLogout className="w-5 h-5" />
                          Logout
                        </button>
                      </div>
                    </>
                  )}
                </div>
              </>
            )}

            {!isAuthenticated && (
              <div className="flex items-center gap-2 ml-4">
                <Link
                  to="/login"
                  className="px-4 py-2 text-secondary-600 hover:text-secondary-900 font-medium transition-colors"
                >
                  Login
                </Link>
                <Link to="/signup" className="btn btn-primary">
                  Sign Up
                </Link>
              </div>
            )}
          </div>

          {/* Mobile menu button */}
          <div className="md:hidden flex items-center">
            <button
              onClick={() => setIsOpen(!isOpen)}
              className="p-2 rounded-lg text-secondary-600 hover:bg-secondary-100"
            >
              {isOpen ? <HiX className="w-6 h-6" /> : <HiMenu className="w-6 h-6" />}
            </button>
          </div>
        </div>
      </div>

      {/* Mobile Navigation */}
      {isOpen && (
        <div className="md:hidden bg-white border-t border-secondary-200 fade-in absolute w-full shadow-lg">
          <div className="px-4 py-4 space-y-2">
            <NavLink
              to="/"
              className={navLinkClass}
              onClick={() => setIsOpen(false)}
            >
              <HiHome className="w-5 h-5" />
              Home
            </NavLink>

            <NavLink
              to="/projects"
              className={navLinkClass}
              onClick={() => setIsOpen(false)}
            >
              <HiCollection className="w-5 h-5" />
              Projects
            </NavLink>

            <NavLink
              to="/support"
              className={navLinkClass}
              onClick={() => setIsOpen(false)}
            >
              <HiSupport className="w-5 h-5" />
              Support
            </NavLink>

            {isAuthenticated && (
              <>
                <NavLink
                  to="/dashboard"
                  className={navLinkClass}
                  onClick={() => setIsOpen(false)}
                >
                  <HiViewGrid className="w-5 h-5" />
                  Dashboard
                </NavLink>

                {isAdmin && (
                  <NavLink
                    to="/admin"
                    className={navLinkClass}
                    onClick={() => setIsOpen(false)}
                  >
                    <HiShieldCheck className="w-5 h-5" />
                    Admin Panel
                  </NavLink>
                )}

                <div className="pt-4 border-t border-secondary-200">
                  <div className="flex items-center gap-3 px-3 py-2">
                    <div className="w-10 h-10 bg-primary-500 rounded-full flex items-center justify-center">
                      <span className="text-white font-medium">
                        {user?.name?.charAt(0).toUpperCase()}
                      </span>
                    </div>
                    <div className="overflow-hidden">
                      <p className="font-medium text-secondary-900 truncate">{user?.name}</p>
                      <p className="text-sm text-secondary-500 truncate">{user?.email}</p>
                    </div>
                  </div>
                  <button
                    onClick={handleLogout}
                    className="w-full flex items-center gap-2 px-3 py-2 mt-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                  >
                    <HiLogout className="w-5 h-5" />
                    Logout
                  </button>
                </div>
              </>
            )}

            {!isAuthenticated && (
              <div className="pt-4 border-t border-secondary-200 space-y-2">
                <Link
                  to="/login"
                  className="block w-full text-center px-4 py-2 text-secondary-600 hover:bg-secondary-100 rounded-lg font-medium transition-colors"
                  onClick={() => setIsOpen(false)}
                >
                  Login
                </Link>
                <Link
                  to="/signup"
                  className="block w-full btn btn-primary text-center"
                  onClick={() => setIsOpen(false)}
                >
                  Sign Up
                </Link>
              </div>
            )}
          </div>
        </div>
      )}
    </nav>
  );
};

export default Navbar;


================================================
FILE: frontend\src\components\PaymentModal.jsx
================================================
// src/components/PaymentModal.jsx
import { useState } from 'react';
import { 
  HiX, 
  HiShieldCheck, 
  HiCreditCard,
  HiTag,
  HiCheckCircle,
  HiXCircle
} from 'react-icons/hi';
import toast from 'react-hot-toast';
import { paymentsAPI } from '../api/payments';
import { useAuth } from '../hooks/useAuth';

const PaymentModal = ({ project, isOpen, onClose, onSuccess }) => {
  const { user } = useAuth();
  const [loading, setLoading] = useState(false);
  
  // ADDED: Coupon states
  const [couponCode, setCouponCode] = useState('');
  const [appliedCoupon, setAppliedCoupon] = useState(null);
  const [couponLoading, setCouponLoading] = useState(false);
  const [couponError, setCouponError] = useState('');

  const formatPrice = (price) => {
    return new Intl.NumberFormat('en-IN', {
      style: 'currency',
      currency: 'INR',
      minimumFractionDigits: 0,
    }).format(price);
  };

  // ADDED: Calculate final price with discount
  const calculateFinalPrice = () => {
    let finalPrice = project.price;
    
    if (appliedCoupon) {
      if (appliedCoupon.discount_type === 'percentage') {
        finalPrice = finalPrice - (finalPrice * appliedCoupon.discount_value / 100);
      } else {
        finalPrice = finalPrice - appliedCoupon.discount_value;
      }
      
      // Ensure price doesn't go below 0
      finalPrice = Math.max(0, finalPrice);
    }
    
    return Math.round(finalPrice);
  };

  // ADDED: Apply coupon
  const handleApplyCoupon = async () => {
    if (!couponCode.trim()) {
      setCouponError('Please enter a coupon code');
      return;
    }

    setCouponLoading(true);
    setCouponError('');

    try {
      // TODO: Replace with actual API call
      // const response = await fetch('/api/coupons/validate', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify({ 
      //     code: couponCode,
      //     project_id: project.id,
      //     amount: project.price 
      //   })
      // });
      // const data = await response.json();

      // TEMPORARY: Mock coupon validation
      const mockCoupons = {
        'FIRST20': { code: 'FIRST20', discount_type: 'percentage', discount_value: 20, description: '20% off for first-time buyers' },
        'SAVE50': { code: 'SAVE50', discount_type: 'fixed', discount_value: 50, description: 'â‚¹50 off on any project' },
        'STUDENT25': { code: 'STUDENT25', discount_type: 'percentage', discount_value: 25, description: '25% student discount' },
      };

      await new Promise(resolve => setTimeout(resolve, 800)); // Simulate API delay

      const coupon = mockCoupons[couponCode.toUpperCase()];

      if (coupon) {
        setAppliedCoupon(coupon);
        toast.success(`Coupon "${coupon.code}" applied!`);
      } else {
        setCouponError('Invalid or expired coupon code');
      }
    } catch (error) {
      setCouponError('Failed to validate coupon');
    } finally {
      setCouponLoading(false);
    }
  };

  // ADDED: Remove coupon
  const handleRemoveCoupon = () => {
    setAppliedCoupon(null);
    setCouponCode('');
    setCouponError('');
    toast.success('Coupon removed');
  };

  const handlePayment = async () => {
    setLoading(true);

    try {
      // MODIFIED: Include coupon in order creation
      const orderResponse = await paymentsAPI.createOrder(
        project.id,
        appliedCoupon?.code // Pass coupon code if applied
      );
      
      if (!orderResponse.success) {
        throw new Error(orderResponse.message);
      }

      const { razorpayOrderId, amount, keyId, isMockPayment } = orderResponse.data;

      if (isMockPayment) {
        // Handle mock payment
        const mockPaymentId = `pay_mock_${Date.now()}`;
        const mockSignature = 'mock_signature';

        const verifyResponse = await paymentsAPI.verifyPayment({
          razorpay_order_id: razorpayOrderId,
          razorpay_payment_id: mockPaymentId,
          razorpay_signature: mockSignature,
        });

        if (verifyResponse.success) {
          toast.success('Payment successful! (Mock Mode)');
          onSuccess();
        }
      } else {
        // Real Razorpay payment
        const options = {
          key: keyId,
          amount: amount,
          currency: 'INR',
          name: 'Inovitaz',
          description: `Purchase: ${project.title}`,
          order_id: razorpayOrderId,
          handler: async (response) => {
            try {
              const verifyResponse = await paymentsAPI.verifyPayment({
                razorpay_order_id: response.razorpay_order_id,
                razorpay_payment_id: response.razorpay_payment_id,
                razorpay_signature: response.razorpay_signature,
              });

              if (verifyResponse.success) {
                toast.success('Payment successful!');
                onSuccess();
              }
            } catch (error) {
              toast.error('Payment verification failed');
            }
          },
          prefill: {
            name: user?.name || '',
            email: user?.email || '',
          },
          theme: {
            color: '#2563eb',
          },
          modal: {
            ondismiss: () => {
              setLoading(false);
            },
          },
        };

        const razorpay = new window.Razorpay(options);
        razorpay.open();
      }
    } catch (error) {
      console.error('Payment error:', error);
      toast.error(error.response?.data?.message || 'Payment failed');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  const finalPrice = calculateFinalPrice();
  const discount = project.price - finalPrice;

  return (
    <div className="fixed inset-0 z-50 overflow-y-auto">
      {/* Backdrop */}
      <div 
        className="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity"
        onClick={onClose}
      ></div>

      {/* Modal */}
      <div className="flex min-h-full items-center justify-center p-4">
        <div className="relative bg-white rounded-2xl shadow-xl max-w-md w-full fade-in">
          {/* Close button */}
          <button
            onClick={onClose}
            className="absolute top-4 right-4 p-2 text-secondary-400 hover:text-secondary-600 transition-colors z-10"
          >
            <HiX className="w-5 h-5" />
          </button>

          {/* Content */}
          <div className="p-6">
            {/* Header */}
            <div className="text-center mb-6">
              <div className="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <HiCreditCard className="w-8 h-8 text-primary-600" />
              </div>
              <h2 className="text-xl font-bold text-secondary-900">Complete Purchase</h2>
              <p className="text-secondary-600 text-sm mt-1">Secure payment powered by Razorpay</p>
            </div>

            {/* Project Info */}
            <div className="bg-secondary-50 rounded-xl p-4 mb-6">
              <div className="flex gap-4">
                <img
                  src={project.thumbnail || 'https://via.placeholder.com/80'}
                  alt={project.title}
                  className="w-20 h-20 object-cover rounded-lg"
                />
                <div className="flex-1">
                  <h3 className="font-semibold text-secondary-900 line-clamp-2">
                    {project.title}
                  </h3>
                  <p className="text-sm text-secondary-500 mt-1">{project.category}</p>
                </div>
              </div>
            </div>

            {/* ADDED: Coupon Section */}
            <div className="mb-6">
              <label className="block text-sm font-medium text-secondary-700 mb-2">
                Have a coupon code?
              </label>
              
              {!appliedCoupon ? (
                <div className="flex gap-2">
                  <div className="flex-1 relative">
                    <HiTag className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-secondary-400" />
                    <input
                      type="text"
                      value={couponCode}
                      onChange={(e) => {
                        setCouponCode(e.target.value.toUpperCase());
                        setCouponError('');
                      }}
                      placeholder="Enter coupon code"
                      className={`input pl-10 ${couponError ? 'border-red-300 focus:ring-red-500' : ''}`}
                      disabled={couponLoading}
                    />
                  </div>
                  <button
                    onClick={handleApplyCoupon}
                    disabled={couponLoading || !couponCode.trim()}
                    className="btn btn-secondary px-6"
                  >
                    {couponLoading ? (
                      <div className="w-4 h-4 border-2 border-secondary-400 border-t-transparent rounded-full animate-spin"></div>
                    ) : (
                      'Apply'
                    )}
                  </button>
                </div>
              ) : (
                <div className="bg-green-50 border border-green-200 rounded-lg p-3">
                  <div className="flex items-start justify-between">
                    <div className="flex items-start gap-2">
                      <HiCheckCircle className="w-5 h-5 text-green-600 mt-0.5" />
                      <div>
                        <p className="font-medium text-green-800 text-sm">
                          {appliedCoupon.code} applied
                        </p>
                        <p className="text-xs text-green-600 mt-0.5">
                          {appliedCoupon.description}
                        </p>
                      </div>
                    </div>
                    <button
                      onClick={handleRemoveCoupon}
                      className="text-green-600 hover:text-green-700 p-1"
                    >
                      <HiXCircle className="w-5 h-5" />
                    </button>
                  </div>
                </div>
              )}

              {couponError && (
                <p className="text-red-600 text-sm mt-2 flex items-center gap-1">
                  <HiXCircle className="w-4 h-4" />
                  {couponError}
                </p>
              )}

              {/* ADDED: Available Coupons Hint */}
              {!appliedCoupon && !couponError && (
                <div className="mt-2 text-xs text-secondary-500">
                  ðŸ’¡ Try: <code className="bg-secondary-100 px-1.5 py-0.5 rounded">FIRST20</code>,{' '}
                  <code className="bg-secondary-100 px-1.5 py-0.5 rounded">SAVE50</code>, or{' '}
                  <code className="bg-secondary-100 px-1.5 py-0.5 rounded">STUDENT25</code>
                </div>
              )}
            </div>

            {/* MODIFIED: Price Breakdown */}
            <div className="space-y-3 py-4 border-t border-b border-secondary-200 mb-6">
              <div className="flex justify-between items-center text-secondary-600">
                <span>Original Price</span>
                <span>{formatPrice(project.price)}</span>
              </div>

              {appliedCoupon && (
                <div className="flex justify-between items-center text-green-600">
                  <span className="flex items-center gap-1">
                    <HiTag className="w-4 h-4" />
                    Discount ({appliedCoupon.code})
                  </span>
                  <span>-{formatPrice(discount)}</span>
                </div>
              )}

              <div className="flex justify-between items-center pt-3 border-t border-secondary-200">
                <span className="font-semibold text-secondary-900">Total Amount</span>
                <div className="text-right">
                  <div className="text-2xl font-bold text-primary-600">
                    {formatPrice(finalPrice)}
                  </div>
                  {appliedCoupon && discount > 0 && (
                    <div className="text-xs text-green-600 font-medium">
                      You save {formatPrice(discount)}!
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* Security Note */}
            <div className="flex items-start gap-3 bg-green-50 rounded-lg p-3 mb-6">
              <HiShieldCheck className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
              <div>
                <p className="text-sm font-medium text-green-800">Secure Transaction</p>
                <p className="text-xs text-green-600 mt-0.5">
                  Your payment information is encrypted and secure. We never store your card details.
                </p>
              </div>
            </div>

            {/* Buttons */}
            <div className="flex gap-3">
              <button
                onClick={onClose}
                className="flex-1 btn btn-secondary"
                disabled={loading}
              >
                Cancel
              </button>
              <button
                onClick={handlePayment}
                className="flex-1 btn btn-primary"
                disabled={loading}
              >
                {loading ? (
                  <span className="flex items-center gap-2 justify-center">
                    <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                    Processing...
                  </span>
                ) : (
                  `Pay ${formatPrice(finalPrice)}`
                )}
              </button>
            </div>

            {/* ADDED: Terms */}
            <p className="text-xs text-center text-secondary-500 mt-4">
              By proceeding, you agree to our{' '}
              <a href="/terms" target="_blank" className="text-primary-600 hover:underline">
                Terms & Conditions
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default PaymentModal;


================================================
FILE: frontend\src\components\ProjectCard.jsx
================================================
ï»¿import { Link } from 'react-router-dom';
import { useState } from 'react';
import { 
  HiShoppingCart, 
  HiEye, 
  HiStar,
  HiHeart,
  HiOutlineHeart,
  HiCheckCircle,
  HiClock
} from 'react-icons/hi';
import { projectsAPI } from '../api/projects';
import toast from 'react-hot-toast';

const ProjectCard = ({ project }) => {
  const { 
    id, 
    title, 
    description, 
    price, 
    thumbnail, 
    image_url, 
    category, 
    difficulty,
    rating,
    reviews_count,
    isPurchased,
    created_at
  } = project;

  const [isWishlisted, setIsWishlisted] = useState(() => {
    const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
    return wishlist.includes(id);
  });

  const [wishlistLoading, setWishlistLoading] = useState(false);

  // --- IMAGE LOGIC ---
  const displayImage = thumbnail || image_url || 'https://images.unsplash.com/photo-1518770660439-4636190af475?w=400';

  // --- SMART DESCRIPTION PARSER ---
  let cleanDescription = description;
  try {
    // If it looks like JSON, try to parse it
    if (description && description.trim().startsWith('{')) {
      const parsed = JSON.parse(description);
      cleanDescription = parsed.overview || description;
    }
  } catch (e) {
    // If JSON parse fails (bad format), try Regex to grab overview
    const match = description.match(/"overview"\s*:\s*"(.*?)(?<!\\)"/);
    if (match && match[1]) {
      cleanDescription = match[1];
    }
    // If all fails, just show original text
  }

  // --- PRICE FIX (Paise to Rupee) ---
  const displayPrice = price > 10000 ? price / 100 : price;

  const diffStyle = {
    Beginner: 'bg-green-100 text-green-800',
    Intermediate: 'bg-yellow-100 text-yellow-800',
    Advanced: 'bg-red-100 text-red-800'
  }[difficulty] || 'bg-gray-100 text-gray-800';

  const isNew = created_at && (new Date() - new Date(created_at)) < 7 * 24 * 60 * 60 * 1000;

  const toggleWishlist = async (e) => {
    e.preventDefault(); // Prevent clicking the card link
    e.stopPropagation();
    setWishlistLoading(true);
    try {
      if (isWishlisted) {
        await projectsAPI.removeFromWishlist(id);
        setIsWishlisted(false);
        toast.success('Removed from wishlist');
      } else {
        await projectsAPI.addToWishlist(id);
        setIsWishlisted(true);
        toast.success('Added to wishlist');
      }
    } catch (error) {
      toast.error('Failed to update wishlist');
    } finally {
      setWishlistLoading(false);
    }
  };

  const StarRating = ({ rating }) => (
    <div className="flex items-center gap-1">
      {[1, 2, 3, 4, 5].map((star) => (
        <HiStar key={star} className={`w-4 h-4 ${star <= rating ? 'text-yellow-400' : 'text-gray-300'}`} />
      ))}
    </div>
  );

  return (
    // FIX: 'relative' here stops the blue hover border from jumping out
    <Link to={`/projects/${id}`} className="group relative block h-full">
      <div className="bg-white rounded-xl shadow-sm border border-secondary-200 overflow-hidden hover:shadow-lg hover:border-primary-300 transition-all duration-300 h-full flex flex-col relative z-10">
        
        {/* Image Section */}
        <div className="relative h-48 overflow-hidden bg-secondary-100">
          <img
            src={displayImage}
            alt={title}
            className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
            onError={(e) => { e.target.src = 'https://via.placeholder.com/400x300?text=No+Image'; }}
          />
          
          <div className="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />

          {/* Badges */}
          <div className="absolute top-3 left-3 right-3 flex items-start justify-between">
            <div className="flex flex-col gap-2">
              <span className="inline-block bg-primary-600 text-white text-xs font-medium px-3 py-1 rounded-full shadow-sm">
                {category || 'IoT'}
              </span>
              {isNew && (
                <span className="inline-block bg-green-500 text-white text-xs font-medium px-3 py-1 rounded-full shadow-sm flex items-center gap-1">
                  <HiClock className="w-3 h-3" /> New
                </span>
              )}
            </div>
            <button onClick={toggleWishlist} disabled={wishlistLoading} className="p-2 bg-white/90 backdrop-blur-sm hover:bg-white rounded-full shadow-sm transition-all duration-200 hover:scale-110">
              {isWishlisted ? <HiHeart className="w-5 h-5 text-red-500" /> : <HiOutlineHeart className="w-5 h-5 text-secondary-600 group-hover:text-red-500" />}
            </button>
          </div>

          {difficulty && (
            <span className={`absolute bottom-3 right-3 ${diffStyle} text-xs font-medium px-3 py-1 rounded-full shadow-sm`}>
              {difficulty}
            </span>
          )}
        </div>

        {/* Content Section */}
        <div className="p-5 flex-1 flex flex-col">
          <h3 className="text-lg font-semibold text-secondary-900 mb-2 line-clamp-1 group-hover:text-primary-600 transition-colors">
            {title}
          </h3>

          <p className="text-secondary-600 text-sm mb-3 line-clamp-2 flex-1 leading-relaxed">
            {cleanDescription || 'Complete IoT project with source code and documentation.'}
          </p>

          <div className="flex items-center gap-2 mb-4">
            <StarRating rating={rating} />
            <span className="text-sm font-medium text-secondary-900">{rating ? Number(rating).toFixed(1) : '0.0'}</span>
            <span className="text-xs text-secondary-500">({reviews_count || 0})</span>
          </div>

          <div className="flex items-center justify-between pt-3 border-t border-secondary-100 mt-auto">
            <div className="flex flex-col">
              <div className="flex items-baseline gap-2">
                <span className="text-2xl font-bold text-primary-600">â‚¹{displayPrice}</span>
                <span className="text-sm text-secondary-500 line-through">â‚¹{Math.round(displayPrice * 1.5)}</span>
              </div>
              <span className="text-xs text-green-600 font-medium">33% OFF</span>
            </div>

            <div className="flex gap-2">
              <div className="p-2.5 bg-secondary-100 rounded-lg hover:bg-secondary-200 transition-colors">
                <HiEye className="w-5 h-5 text-secondary-600" />
              </div>
              {!isPurchased && (
                <div className="p-2.5 bg-primary-600 rounded-lg hover:bg-primary-700 transition-colors">
                  <HiShoppingCart className="w-5 h-5 text-white" />
                </div>
              )}
            </div>
          </div>
        </div>
        
        {/* Hover Border Effect (Fixed z-index) */}
        <div className="absolute inset-0 border-2 border-primary-500 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-20" />
      </div>
    </Link>
  );
};

export default ProjectCard;


================================================
FILE: frontend\src\components\ProtectedRoute.jsx
================================================
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';

const ProtectedRoute = ({ children }) => {
  const { isAuthenticated, loading } = useAuth();
  const location = useLocation();

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="loader"></div>
      </div>
    );
  }

  if (!isAuthenticated) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  return children;
};

export default ProtectedRoute;



================================================
FILE: frontend\src\components\ScrollToTop.jsx
================================================
// src/components/ScrollToTop.jsx
import { useEffect } from "react";
import { useLocation } from "react-router-dom";

const ScrollToTop = () => {
  const { pathname } = useLocation();

  useEffect(() => {
    // Instantly scrolls to top (0,0) whenever the path changes
    window.scrollTo(0, 0);
  }, [pathname]);

  return null;
};

export default ScrollToTop;


================================================
FILE: frontend\src\context\AuthContext.jsx
================================================
// src/context/AuthContext.jsx
import { createContext, useState, useEffect } from 'react';

export const AuthContext = createContext(null);

const API_URL = import.meta.env.VITE_API_BASE_URL ?? "http://localhost:4000/api";

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [token, setToken] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const savedToken = localStorage.getItem('token');
    const savedUser = localStorage.getItem('user');

    if (savedToken && savedUser) {
      setToken(savedToken);
      try {
        setUser(JSON.parse(savedUser));
      } catch {
        localStorage.removeItem('user');
      }
    }

    setLoading(false);
  }, []);

  const login = async (formData) => {
    const response = await fetch(`${API_URL}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData),
    });

    const json = await response.json();

    if (!response.ok || !json.success) {
      throw new Error(json.message || 'Login failed');
    }

    const u = json.data.user;
    const t = json.data.token;

    setUser(u);
    setToken(t);

    localStorage.setItem('token', t);
    localStorage.setItem('user', JSON.stringify(u));

    return json;
  };

  const register = async (formData) => {
    const response = await fetch(`${API_URL}/auth/register`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData),
    });

    const json = await response.json();

    if (!response.ok || !json.success) {
      throw new Error(json.message || 'Registration failed');
    }

    const u = json.data.user;
    const t = json.data.token;

    setUser(u);
    setToken(t);

    localStorage.setItem('token', t);
    localStorage.setItem('user', JSON.stringify(u));

    return json;
  };

  const logout = () => {
    setUser(null);
    setToken(null);
    localStorage.removeItem('token');
    localStorage.removeItem('user');
  };

  const value = {
    user,
    token,
    loading,
    login,
    register,
    logout,
    isAuthenticated: !!token,
    isAdmin: user?.role === 'admin',
  };

  return (
    <AuthContext.Provider value={value}>
      {!loading && children}
    </AuthContext.Provider>
  );
};



================================================
FILE: frontend\src\hooks\useAuth.js
================================================
// src/hooks/useAuth.js
import { useContext } from 'react';
import { AuthContext } from '../context/AuthContext';

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

export default useAuth;


================================================
FILE: frontend\src\index.css
================================================
ï»¿@tailwind base;
@tailwind components;
@tailwind utilities;

/* Animations */
.fade-in {
  animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@layer components {
  .btn {
    @apply inline-flex items-center justify-center px-4 py-2 font-medium rounded-lg transition-all duration-200;
  }

  .btn-lg {
    @apply px-6 py-3 text-base;
  }

  .btn-sm {
    @apply px-3 py-1 text-sm;
  }

  .btn-primary {
    @apply bg-primary-600 text-white hover:bg-primary-700;
  }

  .btn-secondary {
    @apply bg-secondary-100 text-secondary-800 hover:bg-secondary-200;
  }

  .btn-outline {
    @apply border border-secondary-300 text-secondary-700 bg-white hover:bg-secondary-50;
  }

  .card {
    @apply bg-white rounded-xl shadow-md overflow-hidden;
  }

  .input {
    @apply w-full px-3 py-2 border border-secondary-300 rounded-lg text-sm
    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500;
  }

  .input-error {
    @apply border-red-500 ring-red-100;
  }

  .skeleton {
    @apply bg-secondary-200 animate-pulse;
  }

  .line-clamp-1 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
  }

  .line-clamp-2 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .loader {
    @apply border-4 border-secondary-200 border-t-primary-500 rounded-full animate-spin;
  }
}

@layer utilities {
  .bg-primary-50 { background-color: #eff6ff; }
  .bg-primary-100 { background-color: #dbeafe; }
  .bg-primary-200 { background-color: #bfdbfe; }
  .bg-primary-500 { background-color: #3b82f6; }
  .bg-primary-600 { background-color: #2563eb; }
  .bg-primary-700 { background-color: #1d4ed8; }
  .bg-primary-900 { background-color: #1e3a8a; }

  .text-primary-100 { color: #dbeafe; }
  .text-primary-200 { color: #bfdbfe; }
  .text-primary-600 { color: #2563eb; }
  .text-primary-700 { color: #1d4ed8; }

  .bg-secondary-50 { background-color: #f9fafb; }
  .bg-secondary-800 { background-color: #1f2937; }
  .bg-secondary-900 { background-color: #111827; }

  .text-secondary-300 { color: #d1d5db; }
  .text-secondary-600 { color: #4b5563; }
  .text-secondary-900 { color: #111827; }

  .border-primary-500 { border-color: #3b82f6; }
}


================================================
FILE: frontend\src\layout\MainLayout.jsx
================================================
import { Outlet } from "react-router-dom";
import Navbar from "../components/Navbar";
import Footer from "../components/Footer";

export default function MainLayout() {
  return (
    <div className="min-h-screen flex flex-col bg-[#071226] text-slate-100">
      <Navbar />
      <main className="flex-1 container mx-auto px-6 py-10">
        <Outlet />
      </main>
      <Footer />
    </div>
  );
}



================================================
FILE: frontend\src\lib\payments.js
================================================
import { createOrder, verifyPayment } from "../api/payments";

export async function initiatePayment(amount, meta = {}) {
  try {
    const res = await createOrder(amount);
    const order = res.data.order;
    const options = {
      key: import.meta.env.VITE_RAZORPAY_KEY_ID,
      amount: order.amount,
      currency: order.currency,
      name: meta.title || "Inovitaz Purchase",
      order_id: order.id,
      handler: async function (resp) {
        const verifyRes = await verifyPayment(resp);
        if (verifyRes.data?.success) {
          alert("Payment complete â€” verified.");
        } else {
          alert("Payment failed verification.");
        }
      },
      theme: { color: "#06b6d4" },
    };
    const rzp = new window.Razorpay(options);
    rzp.open();
  } catch (e) {
    console.error("Payment error", e);
    alert("Could not create order.");
  }
}

if (typeof window !== "undefined") {
  window.addEventListener("buy", (e) => {
    const amount = e?.detail?.amount || 49900;
    const project = e?.detail?.project || {};
    initiatePayment(amount, { title: project.title });
  });
}



================================================
FILE: frontend\src\main.jsx
================================================
ï»¿import React from 'react'
import ReactDOM from 'react-dom/client'
import { BrowserRouter } from 'react-router-dom'
import { Toaster } from 'react-hot-toast'
import App from './App'
import { AuthProvider } from './context/AuthContext'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <App />
        <Toaster 
          position="top-right"
          toastOptions={{
            duration: 4000,
            style: {
              background: '#363636',
              color: '#fff',
            },
            success: {
              style: {
                background: '#10b981',
              },
            },
            error: {
              style: {
                background: '#ef4444',
              },
            },
          }}
        />
      </AuthProvider>
    </BrowserRouter>
  </React.StrictMode>,
)


================================================
FILE: frontend\src\pages\About.jsx
================================================
import { HiLightBulb, HiAcademicCap, HiChip, HiUserGroup } from "react-icons/hi";

export default function About() {
  return (
    <div className="min-h-screen bg-white fade-in">
      
      {/* Hero */}
      <div className="bg-secondary-900 text-white py-20 text-center px-6">
        <h1 className="text-4xl md:text-5xl font-bold mb-4">Building the Future of Engineering</h1>
        <p className="text-primary-100 text-lg max-w-2xl mx-auto">
          Empowering students, makers, and innovators with premium IoT resources.
        </p>
      </div>

      {/* Mission */}
      <div className="max-w-4xl mx-auto px-6 py-16">
        <div className="prose max-w-none text-secondary-700">
          <h2 className="text-2xl font-bold text-secondary-900 mb-4">Our Mission</h2>
          <p className="text-lg leading-relaxed mb-8">
            Inovitaz Innovations Pvt. Ltd. was built with a single mission â€” to make high-quality
            engineering and IoT project resources accessible, affordable, and ready for real-world implementation.
            We bridge the gap between theory and practical application.
          </p>
        </div>

        {/* Values Grid */}
        <div className="grid md:grid-cols-2 gap-8 mt-12">
          <ValueCard 
            icon={HiChip} 
            title="Premium Quality" 
            desc="Every project is tested, verified, and built with industry-standard components." 
          />
          <ValueCard 
            icon={HiAcademicCap} 
            title="Education First" 
            desc="Designed to help you learn, understand, and master complex systems easily." 
          />
          <ValueCard 
            icon={HiLightBulb} 
            title="Innovation" 
            desc="Cutting-edge projects ranging from basic automation to advanced AI robotics." 
          />
          <ValueCard 
            icon={HiUserGroup} 
            title="Community" 
            desc="Join thousands of engineers building the next generation of technology." 
          />
        </div>
      </div>
    </div>
  );
}

function ValueCard({ icon: Icon, title, desc }) {
  return (
    <div className="p-6 bg-secondary-50 rounded-xl border border-secondary-100 hover:shadow-md transition-all">
      <div className="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mb-4">
        <Icon className="w-6 h-6 text-primary-600" />
      </div>
      <h3 className="text-xl font-semibold text-secondary-900 mb-2">{title}</h3>
      <p className="text-secondary-600">{desc}</p>
    </div>
  );
}


================================================
FILE: frontend\src\pages\AdminDashboard.jsx
================================================
// src/pages/AdminDashboard.jsx
import { useState, useEffect } from "react";
import { Routes, Route, NavLink } from "react-router-dom";
import {
  HiViewGrid,
  HiCollection,
  HiShoppingCart,
  HiUsers,
  HiPlus,
  HiPencil,
  HiTrash,
  HiCurrencyRupee,
  HiTag,
  HiStar,
} from "react-icons/hi";
import toast from "react-hot-toast";
import { adminProjectsAPI, projectsAPI } from "../api/projects";
import LoadingSpinner from "../components/LoadingSpinner";

// ================== Admin Stats ==================
const AdminStats = () => {
  const [stats, setStats] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchStats();
  }, []);

  const fetchStats = async () => {
    try {
      const response = await adminProjectsAPI.getStats();
      if (response.success) {
        setStats(response.data);
      }
    } catch (error) {
      console.error("Failed to fetch stats:", error);
    } finally {
      setLoading(false);
    }
  };

  const formatPrice = (price) =>
    new Intl.NumberFormat("en-IN", {
      style: "currency",
      currency: "INR",
      minimumFractionDigits: 0,
    }).format(Number(price || 0));

  if (loading) return <div className="flex justify-center py-12"><LoadingSpinner /></div>;

  return (
    <div className="space-y-8">
      {/* Stats Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div className="card p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-secondary-600">Total Revenue</p>
              <p className="text-2xl font-bold text-secondary-900 mt-1">{formatPrice(stats?.totalRevenue || 0)}</p>
            </div>
            <div className="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-green-600"><HiCurrencyRupee className="w-6 h-6" /></div>
          </div>
        </div>
        <div className="card p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-secondary-600">Total Orders</p>
              <p className="text-2xl font-bold text-secondary-900 mt-1">{stats?.totalOrders || 0}</p>
            </div>
            <div className="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center text-blue-600"><HiShoppingCart className="w-6 h-6" /></div>
          </div>
        </div>
        <div className="card p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-secondary-600">Total Users</p>
              <p className="text-2xl font-bold text-secondary-900 mt-1">{stats?.totalUsers || 0}</p>
            </div>
            <div className="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center text-purple-600"><HiUsers className="w-6 h-6" /></div>
          </div>
        </div>
        <div className="card p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-secondary-600">Total Projects</p>
              <p className="text-2xl font-bold text-secondary-900 mt-1">{stats?.totalProjects || 0}</p>
            </div>
            <div className="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center text-orange-600"><HiCollection className="w-6 h-6" /></div>
          </div>
        </div>
      </div>

      {/* Recent Orders */}
      <div className="card">
        <div className="p-6 border-b border-secondary-200">
          <h2 className="text-lg font-semibold text-secondary-900">Recent Orders</h2>
        </div>
        <div className="p-6">
          {stats?.recentOrders?.length > 0 ? (
            <div className="space-y-4">
              {stats.recentOrders.map((order) => (
                <div key={order.id} className="flex items-center justify-between py-3 border-b border-secondary-100 last:border-0">
                  <div>
                    <p className="font-medium text-secondary-900">{order.project_title}</p>
                    <p className="text-sm text-secondary-500">{order.user_email}</p>
                  </div>
                  <div className="text-right">
                    <p className="font-medium text-secondary-900">{formatPrice(order.amount)}</p>
                    <p className="text-sm text-secondary-500">{new Date(order.created_at).toLocaleDateString()}</p>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-secondary-500 text-center py-4">No recent orders</p>
          )}
        </div>
      </div>
    </div>
  );
};

// ================== Admin Projects ==================
const AdminProjects = () => {
  const [projects, setProjects] = useState([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingProject, setEditingProject] = useState(null);

  const [formData, setFormData] = useState({
    title: "",
    price: "",
    thumbnail: "",
    content_url: "",
    category: "IoT",
    difficulty: "Beginner",
    overview: "",
    components: [], // { name, quantity, link }
    circuitImage: "",
    circuitText: "",
    steps: "",
    source: "",
    features: "",
    tech_stack: "",
  });

  const [saving, setSaving] = useState(false);

  useEffect(() => {
    fetchProjects();
  }, []);

  const fetchProjects = async () => {
    try {
      const response = await projectsAPI.getAll({ limit: 100 });
      if (response.success) {
        setProjects(response.data.projects);
      }
    } catch (error) {
      console.error("Failed to fetch projects:", error);
    } finally {
      setLoading(false);
    }
  };

  const resetForm = () => {
    setFormData({
      title: "",
      price: "",
      thumbnail: "",
      content_url: "",
      category: "IoT",
      difficulty: "Beginner",
      overview: "",
      components: [],
      circuitImage: "",
      circuitText: "",
      steps: "",
      source: "",
      features: "",
      tech_stack: "",
    });
  };

  const handleCreate = () => {
    setEditingProject(null);
    resetForm();
    setShowModal(true);
  };

  const handleEdit = (project) => {
    let overview = "";
    let components = [];
    let circuitImage = "";
    let circuitText = "";
    let steps = "";
    let source = "";
    let featuresStr = "";
    let techStackStr = "";
    let jsonDownloadUrl = "";

    if (project.description) {
      try {
        const desc = JSON.parse(project.description);
        overview = desc.overview || "";
        jsonDownloadUrl = desc.download_url || "";
        
        if (Array.isArray(desc.components)) {
          components = desc.components.map(c => ({
            name: c.name || c,
            quantity: c.quantity || c.price || "1",
            link: c.link || ""
          }));
        } else if (typeof desc.components === "string") {
          components = desc.components.split("\n").map(line => line.trim()).filter(Boolean).map(line => ({ name: line, quantity: "1", link: "" }));
        }

        circuitImage = desc.circuit?.image || desc.circuitImage || "";
        circuitText = desc.circuit?.text || desc.circuitText || "";
        steps = desc.steps || "";
        source = desc.source || "";
        
        if(desc.features && Array.isArray(desc.features)) featuresStr = desc.features.join("\n");
        if(desc.tech_stack && Array.isArray(desc.tech_stack)) techStackStr = desc.tech_stack.join(", ");

      } catch {
        overview = project.description || "";
      }
    }

    if (!featuresStr && Array.isArray(project.features)) featuresStr = project.features.join("\n");
    if (!techStackStr && Array.isArray(project.tech_stack)) techStackStr = project.tech_stack.join(", ");

    setEditingProject(project);
    setFormData({
      title: project.title,
      price: project.price != null ? String(project.price) : "",
      thumbnail: project.thumbnail || "",
      content_url: project.content_url || jsonDownloadUrl || "", 
      category: project.category || "IoT",
      difficulty: project.difficulty || "Beginner",
      overview,
      components,
      circuitImage,
      circuitText,
      steps,
      source,
      features: featuresStr,
      tech_stack: techStackStr,
    });
    setShowModal(true);
  };

  const handleDelete = async (projectId) => {
    if (!window.confirm("Are you sure you want to delete this project?")) return;
    try {
      const response = await adminProjectsAPI.delete(projectId);
      if (response.success) {
        toast.success("Project deleted successfully");
        fetchProjects();
      } else {
        toast.error(response.message || "Failed to delete project");
      }
    } catch (error) {
      toast.error(error.response?.data?.message || "Failed to delete project");
    }
  };

  const handleComponentChange = (index, field, value) => {
    const next = [...formData.components];
    next[index] = { ...next[index], [field]: field === "quantity" ? value.replace(/[^\d]/g, "") : value };
    setFormData((prev) => ({ ...prev, components: next }));
  };

  const handleAddComponentRow = () => {
    setFormData((prev) => ({ ...prev, components: [...prev.components, { name: "", quantity: "1", link: "" }] }));
  };

  const handleRemoveComponentRow = (index) => {
    const next = [...formData.components];
    next.splice(index, 1);
    setFormData((prev) => ({ ...prev, components: next }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setSaving(true);

    try {
      const featuresArray = formData.features.split("\n").map((f) => f.trim()).filter(Boolean);
      const techStackArray = formData.tech_stack.split(",").map((t) => t.trim()).filter(Boolean);

      const descriptionJson = {
        overview: formData.overview,
        components: formData.components.map((c) => ({
          name: c.name?.trim() || "",
          quantity: c.quantity || "1",
          link: c.link?.trim() || "",
        })),
        circuit: { image: formData.circuitImage, text: formData.circuitText },
        steps: formData.steps,
        source: formData.source,
        download_url: formData.content_url, 
        features: featuresArray, 
        tech_stack: techStackArray 
      };

      const data = {
        title: formData.title,
        price: parseFloat(formData.price),
        thumbnail: formData.thumbnail,
        content_url: formData.content_url, 
        category: formData.category,
        difficulty: formData.difficulty,
        description: JSON.stringify(descriptionJson),
        features: featuresArray,
        tech_stack: techStackArray,
      };

      if (!data.title || Number.isNaN(data.price)) {
        toast.error("Title and valid price are required.");
        setSaving(false);
        return;
      }

      if (editingProject) {
        const res = await adminProjectsAPI.update(editingProject.id, data);
        if (res.success) toast.success("Project updated successfully");
        else toast.error(res.message || "Failed to update project");
      } else {
        const res = await adminProjectsAPI.create(data);
        if (res.success) toast.success("Project created successfully");
        else toast.error(res.message || "Failed to create project");
      }

      setShowModal(false);
      fetchProjects();
    } catch (error) {
      console.error("Save project error:", error);
      toast.error(error.response?.data?.message || "Failed to save project");
    } finally {
      setSaving(false);
    }
  };

  const formatPrice = (price) =>
    new Intl.NumberFormat("en-IN", { style: "currency", currency: "INR", minimumFractionDigits: 0 }).format(Number(price || 0));

  const getShortDescription = (project) => {
    if (!project.description) return "";
    try {
      const d = JSON.parse(project.description);
      return d.overview || "";
    } catch {
      return project.description;
    }
  };

  if (loading) return <div className="flex justify-center py-12"><LoadingSpinner /></div>;

  return (
    <div>
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-xl font-semibold text-secondary-900">Manage Projects</h2>
        <button onClick={handleCreate} className="btn btn-primary"><HiPlus className="w-5 h-5 mr-2" /> Add Project</button>
      </div>

      <div className="card overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-secondary-50">
              <tr>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Project</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Category</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Difficulty</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Rating</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Price</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Actions</th>
              </tr>
            </thead>
            <tbody>
              {projects.map((project) => (
                <tr key={project.id} className="border-b border-secondary-100 hover:bg-secondary-50">
                  <td className="py-4 px-4">
                    <div className="flex items-center gap-3">
                      <img src={project.thumbnail || "https://via.placeholder.com/48"} alt={project.title} className="w-12 h-12 rounded-lg object-cover" />
                      <div>
                        <p className="font-medium text-secondary-900">{project.title}</p>
                        <p className="text-sm text-secondary-500 truncate max-w-xs">{getShortDescription(project)}</p>
                      </div>
                    </div>
                  </td>
                  <td className="py-4 px-4"><span className="px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-xs font-medium">{project.category}</span></td>
                  <td className="py-4 px-4"><span className={`px-2 py-1 rounded-full text-xs font-medium ${project.difficulty === 'Beginner' ? 'bg-green-100 text-green-700' : project.difficulty === 'Intermediate' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}`}>{project.difficulty || 'Beginner'}</span></td>
                  <td className="py-4 px-4"><div className="flex items-center gap-1"><HiStar className="w-4 h-4 text-yellow-400" /><span className="text-sm text-secondary-900">{project.average_rating ? Number(project.average_rating).toFixed(1) : '0.0'}</span><span className="text-xs text-secondary-500">({project.reviews_count || 0})</span></div></td>
                  <td className="py-4 px-4 font-medium text-secondary-900">{formatPrice(project.price)}</td>
                  <td className="py-4 px-4">
                    <div className="flex items-center gap-2">
                      <button onClick={() => handleEdit(project)} className="p-2 text-secondary-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors"><HiPencil className="w-5 h-5" /></button>
                      <button onClick={() => handleDelete(project.id)} className="p-2 text-secondary-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"><HiTrash className="w-5 h-5" /></button>
                    </div>
                  </td>
                </tr>
              ))}
              {projects.length === 0 && <tr><td colSpan={6} className="py-8 text-center text-secondary-500">No projects found.</td></tr>}
            </tbody>
          </table>
        </div>
      </div>

      {showModal && (
        <div className="fixed inset-0 z-50 overflow-y-auto">
          <div className="fixed inset-0 bg-black/50" onClick={() => setShowModal(false)}></div>
          <div className="flex min-h-full items-center justify-center p-4">
            <div className="relative bg-white rounded-2xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto fade-in">
              <div className="p-6 border-b border-secondary-200">
                <h3 className="text-xl font-semibold text-secondary-900">{editingProject ? "Edit Project" : "Add New Project"}</h3>
                <p className="text-sm text-secondary-500 mt-1">Add complete project information.</p>
              </div>
              <form onSubmit={handleSubmit} className="p-6 space-y-6">
                <div className="grid md:grid-cols-2 gap-4 bg-secondary-50 border border-secondary-200 rounded-xl p-4">
                  <h4 className="md:col-span-2 text-xs font-semibold uppercase tracking-wide text-secondary-500 mb-2">Project Info</h4>
                  <div className="md:col-span-2"><label className="block text-sm font-medium text-secondary-700 mb-1">Title *</label><input type="text" required value={formData.title} onChange={(e) => setFormData((prev) => ({...prev, title: e.target.value}))} className="input w-full" placeholder="Project title" /></div>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Price (â‚¹) *</label><input type="number" required min="0" step="0.01" value={formData.price} onChange={(e) => setFormData((prev) => ({...prev, price: e.target.value}))} className="input w-full" placeholder="499" /></div>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Category</label><select value={formData.category} onChange={(e) => setFormData((prev) => ({...prev, category: e.target.value}))} className="input w-full"><option value="IoT">IoT</option><option value="Arduino">Arduino</option><option value="ESP32">ESP32</option><option value="Raspberry Pi">Raspberry Pi</option><option value="Robotics">Robotics</option><option value="Embedded">Embedded</option><option value="Automation">Automation</option></select></div>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Difficulty</label><select value={formData.difficulty} onChange={(e) => setFormData((prev) => ({...prev, difficulty: e.target.value}))} className="input w-full"><option value="Beginner">Beginner</option><option value="Intermediate">Intermediate</option><option value="Advanced">Advanced</option></select></div>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Thumbnail URL</label><input type="url" value={formData.thumbnail} onChange={(e) => setFormData((prev) => ({...prev, thumbnail: e.target.value}))} className="input w-full" placeholder="https://example.com/image.jpg" /></div>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Download URL (ZIP)</label><input type="url" value={formData.content_url} onChange={(e) => setFormData((prev) => ({...prev, content_url: e.target.value}))} className="input w-full" placeholder="https://example.com/download.zip" /></div>
                </div>

                <div className="bg-secondary-50 border border-secondary-200 rounded-xl p-4">
                  <h4 className="text-xs font-semibold uppercase tracking-wide text-secondary-500 mb-2">1. Overview</h4>
                  <textarea required rows={4} value={formData.overview} onChange={(e) => setFormData((prev) => ({...prev, overview: e.target.value}))} className="input w-full min-h-[160px] resize-y" placeholder="High-level summary of the project..." />
                </div>

                <div className="bg-secondary-50 border border-secondary-200 rounded-xl p-4">
                  <div className="flex justify-between items-center mb-2">
                    <h4 className="text-xs font-semibold uppercase tracking-wide text-secondary-500">2. Components &amp; Quantity</h4>
                    <button type="button" onClick={handleAddComponentRow} className="text-xs font-medium text-primary-700 hover:text-primary-800">+ Add Component</button>
                  </div>
                  {formData.components.length > 0 && (
                    <div className="overflow-x-auto border border-secondary-200 rounded-lg">
                      <table className="w-full text-sm">
                        <thead className="bg-white">
                          <tr><th className="text-left px-3 py-2 font-medium text-secondary-600">Component Name</th><th className="text-left px-3 py-2 font-medium text-secondary-600">Quantity</th><th className="text-left px-3 py-2 font-medium text-secondary-600">Link (URL)</th><th className="px-3 py-2"></th></tr>
                        </thead>
                        <tbody>
                          {formData.components.map((row, index) => (
                            <tr key={index} className="border-t border-secondary-100">
                              <td className="px-3 py-2"><input type="text" value={row.name} onChange={(e) => handleComponentChange(index, "name", e.target.value)} className="input w-full text-xs" placeholder="ESP32 Dev Board" /></td>
                              <td className="px-3 py-2"><input type="number" min="1" value={row.quantity} onChange={(e) => handleComponentChange(index, "quantity", e.target.value)} className="input w-full text-xs" placeholder="1" /></td>
                              <td className="px-3 py-2"><input type="url" value={row.link} onChange={(e) => handleComponentChange(index, "link", e.target.value)} className="input w-full text-xs" placeholder="https://shop.com/product" /></td>
                              <td className="px-3 py-2 text-right"><button type="button" onClick={() => handleRemoveComponentRow(index)} className="text-xs text-red-600 hover:text-red-700">Remove</button></td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  )}
                </div>

                <div className="bg-secondary-50 border border-secondary-200 rounded-xl p-4 space-y-3">
                  <h4 className="text-xs font-semibold uppercase tracking-wide text-secondary-500 mb-2">3. Circuit Diagram</h4>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Circuit Diagram Image URL</label><input type="url" value={formData.circuitImage} onChange={(e) => setFormData((prev) => ({...prev, circuitImage: e.target.value}))} className="input w-full" placeholder="https://your-domain.com/images/circuit.png" /></div>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Circuit Explanation</label><textarea rows={4} value={formData.circuitText} onChange={(e) => setFormData((prev) => ({...prev, circuitText: e.target.value}))} className="input w-full min-h-[150px] resize-y" placeholder="Explain connections..." /></div>
                </div>

                <div className="bg-secondary-50 border border-secondary-200 rounded-xl p-4">
                  <h4 className="text-xs font-semibold uppercase tracking-wide text-secondary-500 mb-2">4. Step-by-Step Process</h4>
                  <textarea rows={8} value={formData.steps} onChange={(e) => setFormData((prev) => ({...prev, steps: e.target.value}))} className="input w-full min-h-[200px] resize-y" placeholder={"1. Install Arduino IDE...\n2. Add ESP32 board support..."} />
                </div>

                <div className="bg-secondary-50 border border-secondary-200 rounded-xl p-4">
                  <h4 className="text-xs font-semibold uppercase tracking-wide text-secondary-500 mb-2">5. Source Code &amp; Extra Notes</h4>
                  <textarea rows={5} value={formData.source} onChange={(e) => setFormData((prev) => ({...prev, source: e.target.value}))} className="input w-full min-h-[160px] resize-y" placeholder="Explain what is inside the ZIP..." />
                </div>

                <div className="grid md:grid-cols-2 gap-4 bg-secondary-50 border border-secondary-200 rounded-xl p-4">
                  <h4 className="md:col-span-2 text-xs font-semibold uppercase tracking-wide text-secondary-500 mb-2">Extras</h4>
                  <div className="md:col-span-2"><label className="block text-sm font-medium text-secondary-700 mb-1">Features (one per line)</label><textarea rows={3} value={formData.features} onChange={(e) => setFormData((prev) => ({...prev, features: e.target.value}))} className="input w-full min-h-[120px] resize-y" placeholder={"Feature 1\nFeature 2\nFeature 3"} /></div>
                  <div className="md:col-span-2"><label className="block text-sm font-medium text-secondary-700 mb-1">Tech Stack (comma separated)</label><input type="text" value={formData.tech_stack} onChange={(e) => setFormData((prev) => ({...prev, tech_stack: e.target.value}))} className="input w-full" placeholder="ESP32, Arduino, HTML, CSS" /></div>
                </div>

                <div className="flex justify-end gap-3 pt-4 border-t border-secondary-200">
                  <button type="button" onClick={() => setShowModal(false)} className="btn btn-secondary" disabled={saving}>Cancel</button>
                  <button type="submit" className="btn btn-primary" disabled={saving}>{saving ? "Saving..." : editingProject ? "Update" : "Create"}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// ================== Admin Orders ==================
const AdminOrders = () => {
  const [orders, setOrders] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchOrders();
  }, []);

  const fetchOrders = async () => {
    try {
      const response = await adminProjectsAPI.getAllOrders();
      if (response.success) {
        setOrders(response.data.orders || []);
      }
    } catch (error) {
      console.error("Failed to fetch orders:", error);
    } finally {
      setLoading(false);
    }
  };

  const formatPrice = (price) =>
    new Intl.NumberFormat("en-IN", { style: "currency", currency: "INR", minimumFractionDigits: 0 }).format(Number(price || 0));

  if (loading) return <div className="flex justify-center py-12"><LoadingSpinner /></div>;

  return (
    <div>
      <h2 className="text-xl font-semibold text-secondary-900 mb-6">All Orders</h2>
      <div className="card overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-secondary-50">
              <tr>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Order ID</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Customer</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Project</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Amount</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Coupon</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Status</th>
                <th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Date</th>
              </tr>
            </thead>
            <tbody>
              {orders.length === 0 ? (
                <tr><td colSpan={7} className="py-8 text-center text-secondary-500">No orders found</td></tr>
              ) : (
                orders.map((order) => (
                  <tr key={order.id} className="border-b border-secondary-100 hover:bg-secondary-50">
                    <td className="py-4 px-4 font-mono text-sm text-secondary-600">#{order.id}</td>
                    <td className="py-4 px-4">
                      <div><p className="font-medium text-secondary-900">{order.user_name}</p><p className="text-sm text-secondary-500">{order.user_email}</p></div>
                    </td>
                    <td className="py-4 px-4 text-secondary-900">{order.project_title}</td>
                    <td className="py-4 px-4">
                      <div><p className="font-medium text-secondary-900">{formatPrice(order.amount)}</p>{order.discount_amount > 0 && <p className="text-xs text-green-600">-{formatPrice(order.discount_amount)} off</p>}</div>
                    </td>
                    <td className="py-4 px-4">{order.coupon_code ? <span className="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium">{order.coupon_code}</span> : <span className="text-secondary-400 text-xs">-</span>}</td>
                    <td className="py-4 px-4"><span className={`px-2 py-1 rounded-full text-xs font-medium ${order.status === "paid" ? "bg-green-100 text-green-700" : order.status === "pending" ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700"}`}>{order.status}</span></td>
                    <td className="py-4 px-4 text-secondary-600">{new Date(order.created_at).toLocaleDateString()}</td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

// ================== Admin Users ==================
const AdminUsers = () => {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchUsers();
  }, []);

  const fetchUsers = async () => {
    try {
      const response = await adminProjectsAPI.getAllUsers();
      if (response.success) {
        setUsers(response.data.users || []);
      }
    } catch (error) {
      console.error("Failed to fetch users:", error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <div className="flex justify-center py-12"><LoadingSpinner /></div>;

  return (
    <div>
      <h2 className="text-xl font-semibold text-secondary-900 mb-6">All Users</h2>
      <div className="card overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-secondary-50">
              <tr><th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">User</th><th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Email</th><th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Role</th><th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Joined</th></tr>
            </thead>
            <tbody>
              {users.map((user) => (
                <tr key={user.id} className="border-b border-secondary-100 hover:bg-secondary-50">
                  <td className="py-4 px-4"><div className="flex items-center gap-3"><div className="w-10 h-10 bg-primary-500 rounded-full flex items-center justify-center"><span className="text-white font-medium">{user.name?.charAt(0).toUpperCase()}</span></div><span className="font-medium text-secondary-900">{user.name}</span></div></td>
                  <td className="py-4 px-4 text-secondary-600">{user.email}</td>
                  <td className="py-4 px-4"><span className={`px-2 py-1 rounded-full text-xs font-medium ${user.role === "admin" ? "bg-purple-100 text-purple-700" : "bg-secondary-100 text-secondary-700"}`}>{user.role}</span></td>
                  <td className="py-4 px-4 text-secondary-600">{new Date(user.created_at).toLocaleDateString()}</td>
                </tr>
              ))}
              {users.length === 0 && <tr><td colSpan={4} className="py-8 text-center text-secondary-500">No users found.</td></tr>}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

// ================== Admin Coupons ==================
const AdminCoupons = () => {
  const [coupons, setCoupons] = useState([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [formData, setFormData] = useState({ code: '', description: '', discount_type: 'percentage', discount_value: '', min_purchase_amount: '', max_discount_amount: '', usage_limit: '', valid_until: '' });
  const [saving, setSaving] = useState(false);

  useEffect(() => {
    fetchCoupons();
  }, []);

  const fetchCoupons = async () => {
    try {
      const token = localStorage.getItem('token');
      const response = await fetch('http://localhost:5000/api/coupons', { headers: { Authorization: `Bearer ${token}` } });
      const data = await response.json();
      if (data.success) setCoupons(data.data || []);
    } catch (error) {
      console.error("Failed to fetch coupons:", error);
    } finally {
      setLoading(false);
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setSaving(true);
    try {
      const token = localStorage.getItem('token');
      const response = await fetch('http://localhost:5000/api/coupons', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
        body: JSON.stringify({ ...formData, discount_value: parseFloat(formData.discount_value), min_purchase_amount: formData.min_purchase_amount ? parseFloat(formData.min_purchase_amount) * 100 : 0, max_discount_amount: formData.max_discount_amount ? parseFloat(formData.max_discount_amount) * 100 : null, usage_limit: formData.usage_limit ? parseInt(formData.usage_limit) : null })
      });
      const data = await response.json();
      if (data.success) {
        toast.success('Coupon created successfully');
        setShowModal(false);
        setFormData({ code: '', description: '', discount_type: 'percentage', discount_value: '', min_purchase_amount: '', max_discount_amount: '', usage_limit: '', valid_until: '' });
        fetchCoupons();
      } else {
        toast.error(data.message || 'Failed to create coupon');
      }
    } catch (error) {
      toast.error('Failed to create coupon');
    } finally {
      setSaving(false);
    }
  };

  if (loading) return <div className="flex justify-center py-12"><LoadingSpinner /></div>;

  return (
    <div>
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-xl font-semibold text-secondary-900">Manage Coupons</h2>
        <button onClick={() => setShowModal(true)} className="btn btn-primary"><HiPlus className="w-5 h-5 mr-2" /> Add Coupon</button>
      </div>
      <div className="card overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-secondary-50">
              <tr><th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Code</th><th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Discount</th><th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Usage</th><th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Valid Until</th><th className="text-left py-3 px-4 text-sm font-medium text-secondary-600">Status</th></tr>
            </thead>
            <tbody>
              {coupons.map((coupon) => (
                <tr key={coupon.id} className="border-b border-secondary-100 hover:bg-secondary-50">
                  <td className="py-4 px-4"><div><p className="font-mono font-medium text-secondary-900">{coupon.code}</p><p className="text-xs text-secondary-500">{coupon.description}</p></div></td>
                  <td className="py-4 px-4"><span className="text-secondary-900 font-medium">{coupon.discount_type === 'percentage' ? `${coupon.discount_value}%` : `â‚¹${coupon.discount_value}`}</span></td>
                  <td className="py-4 px-4 text-secondary-600">{coupon.used_count} / {coupon.usage_limit || 'âˆž'}</td>
                  <td className="py-4 px-4 text-secondary-600">{coupon.valid_until ? new Date(coupon.valid_until).toLocaleDateString() : 'No expiry'}</td>
                  <td className="py-4 px-4"><span className={`px-2 py-1 rounded-full text-xs font-medium ${coupon.is_active ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{coupon.is_active ? 'Active' : 'Inactive'}</span></td>
                </tr>
              ))}
              {coupons.length === 0 && <tr><td colSpan={5} className="py-8 text-center text-secondary-500">No coupons found.</td></tr>}
            </tbody>
          </table>
        </div>
      </div>
      {showModal && (
        <div className="fixed inset-0 z-50 overflow-y-auto">
          <div className="fixed inset-0 bg-black/50" onClick={() => setShowModal(false)}></div>
          <div className="flex min-h-full items-center justify-center p-4">
            <div className="relative bg-white rounded-2xl shadow-xl max-w-md w-full fade-in">
              <div className="p-6 border-b border-secondary-200">
                <h3 className="text-xl font-semibold text-secondary-900">Create Coupon</h3>
              </div>
              <form onSubmit={handleSubmit} className="p-6 space-y-4">
                <div><label className="block text-sm font-medium text-secondary-700 mb-1">Code *</label><input type="text" required value={formData.code} onChange={(e) => setFormData({...formData, code: e.target.value.toUpperCase()})} className="input w-full" placeholder="SAVE20" /></div>
                <div><label className="block text-sm font-medium text-secondary-700 mb-1">Description</label><input type="text" value={formData.description} onChange={(e) => setFormData({...formData, description: e.target.value})} className="input w-full" placeholder="20% off for new users" /></div>
                <div className="grid grid-cols-2 gap-4">
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Type *</label><select value={formData.discount_type} onChange={(e) => setFormData({...formData, discount_type: e.target.value})} className="input w-full"><option value="percentage">Percentage</option><option value="fixed">Fixed Amount</option></select></div>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Value *</label><input type="number" required value={formData.discount_value} onChange={(e) => setFormData({...formData, discount_value: e.target.value})} className="input w-full" placeholder={formData.discount_type === 'percentage' ? '20' : '100'} /></div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Min Purchase (â‚¹)</label><input type="number" value={formData.min_purchase_amount} onChange={(e) => setFormData({...formData, min_purchase_amount: e.target.value})} className="input w-full" placeholder="0" /></div>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Max Discount (â‚¹)</label><input type="number" value={formData.max_discount_amount} onChange={(e) => setFormData({...formData, max_discount_amount: e.target.value})} className="input w-full" placeholder="No limit" /></div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Usage Limit</label><input type="number" value={formData.usage_limit} onChange={(e) => setFormData({...formData, usage_limit: e.target.value})} className="input w-full" placeholder="Unlimited" /></div>
                  <div><label className="block text-sm font-medium text-secondary-700 mb-1">Valid Until</label><input type="date" value={formData.valid_until} onChange={(e) => setFormData({...formData, valid_until: e.target.value})} className="input w-full" /></div>
                </div>
                <div className="flex justify-end gap-3 pt-4">
                  <button type="button" onClick={() => setShowModal(false)} className="btn btn-secondary">Cancel</button>
                  <button type="submit" className="btn btn-primary" disabled={saving}>{saving ? 'Creating...' : 'Create Coupon'}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// ================== Main Admin Dashboard ==================
const AdminDashboard = () => {
  const navLinkClass = ({ isActive }) =>
    `flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
      isActive
        ? "bg-primary-100 text-primary-700 font-medium"
        : "text-secondary-600 hover:bg-secondary-100"
    }`;

  return (
    <div className="min-h-screen bg-secondary-50 fade-in">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="flex flex-col lg:flex-row gap-8">
          <div className="lg:w-64 flex-shrink-0">
            <div className="card p-4 sticky top-24">
              <h2 className="text-lg font-semibold text-secondary-900 px-4 py-2 mb-2">Admin Panel</h2>
              <nav className="space-y-1">
                <NavLink to="/admin" end className={navLinkClass}><HiViewGrid className="w-5 h-5" /> Dashboard</NavLink>
                <NavLink to="/admin/projects" className={navLinkClass}><HiCollection className="w-5 h-5" /> Projects</NavLink>
                <NavLink to="/admin/orders" className={navLinkClass}><HiShoppingCart className="w-5 h-5" /> Orders</NavLink>
                <NavLink to="/admin/users" className={navLinkClass}><HiUsers className="w-5 h-5" /> Users</NavLink>
                <NavLink to="/admin/coupons" className={navLinkClass}><HiTag className="w-5 h-5" /> Coupons</NavLink>
              </nav>
            </div>
          </div>
          <div className="flex-1">
            <Routes>
              <Route index element={<AdminStats />} />
              <Route path="projects" element={<AdminProjects />} />
              <Route path="orders" element={<AdminOrders />} />
              <Route path="users" element={<AdminUsers />} />
              <Route path="coupons" element={<AdminCoupons />} />
            </Routes>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AdminDashboard;


================================================
FILE: frontend\src\pages\Dashboard.jsx
================================================
ï»¿import { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { 
  HiShoppingBag, 
  HiDownload, 
  HiCheckCircle,
  HiExternalLink,
  HiHeart,
  HiRefresh,
  HiExclamationCircle,
  HiCalendar,
  HiLockClosed,
  HiXCircle
} from 'react-icons/hi';
import toast from 'react-hot-toast';
import { useAuth } from '../hooks/useAuth';
import { ordersAPI } from '../api/payments';
import { projectsAPI } from '../api/projects';
import LoadingSpinner from '../components/LoadingSpinner';

const Dashboard = () => {
  const { user } = useAuth();
  const [activeTab, setActiveTab] = useState('orders');
  const [orders, setOrders] = useState([]);
  const [purchasedProjects, setPurchasedProjects] = useState([]);
  const [loading, setLoading] = useState(true);
  const [downloadingId, setDownloadingId] = useState(null);
  
  const [wishlist, setWishlist] = useState([]);
  const [expandedOrder, setExpandedOrder] = useState(null);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    setLoading(true);
    try {
      const [ordersRes, purchasedRes] = await Promise.all([
        ordersAPI.getMyOrders(),
        ordersAPI.getPurchased(),
      ]);

      // --- FIX: Safe Array Check for Orders ---
      if (ordersRes?.success && Array.isArray(ordersRes.data?.orders)) {
        setOrders(ordersRes.data.orders);
      } else {
        setOrders([]);
      }

      // --- FIX: Safe Array Check for Downloads ---
      const downloadsData = purchasedRes?.data?.downloads;
      
      if (purchasedRes?.success && Array.isArray(downloadsData)) {
        const enhancedProjects = downloadsData.map(project => ({
          ...project,
          downloads_remaining: project.downloads_remaining ?? 5,
          total_downloads: project.total_downloads ?? 5,
          expiry_date: project.expiry_date || new Date(Date.now() + 180 * 24 * 60 * 60 * 1000).toISOString(),
          last_downloaded: project.last_downloaded || null
        }));
        setPurchasedProjects(enhancedProjects);
      } else {
        setPurchasedProjects([]);
      }
      
      // Wishlist from LocalStorage
      try {
        const wishlistIds = JSON.parse(localStorage.getItem('wishlist') || '[]');
        setWishlist(wishlistIds.map(id => ({ id })));
      } catch (error) {
        console.log('Wishlist error');
      }

    } catch (error) {
      console.error('Failed to fetch dashboard data:', error);
      toast.error('Failed to load dashboard data');
    } finally {
      setLoading(false);
    }
  };

  const handleDownload = async (project) => {
    if (project.downloads_remaining <= 0) {
      toast.error('Download limit reached.');
      return;
    }
    
    setDownloadingId(project.id);
    try {
      const response = await projectsAPI.download(project.id);
      if (response.success) {
        window.open(response.data.downloadUrl, '_blank');
        toast.success('Download started!');
        
        // Update local state
        setPurchasedProjects(prev => prev.map(p => 
          p.id === project.id 
            ? { ...p, downloads_remaining: p.downloads_remaining - 1, last_downloaded: new Date().toISOString() }
            : p
        ));
      }
    } catch (error) {
      toast.error('Download failed.');
    } finally {
      setDownloadingId(null);
    }
  };

  const removeFromWishlist = async (projectId) => {
    try {
      await projectsAPI.removeFromWishlist?.(projectId);
      setWishlist(prev => prev.filter(item => item.id !== projectId));
      toast.success('Removed from wishlist');
    } catch (error) {
      toast.error('Failed to remove');
    }
  };

  const formatPrice = (price) => {
    return new Intl.NumberFormat('en-IN', {
      style: 'currency',
      currency: 'INR',
      minimumFractionDigits: 0,
    }).format(price);
  };

  const formatDate = (dateString) => {
    if (!dateString) return 'N/A';
    return new Date(dateString).toLocaleDateString('en-IN', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
    });
  };

  const getStatusBadge = (status) => {
    const badges = {
      paid: { className: 'bg-green-100 text-green-700', text: 'Paid' },
      pending: { className: 'bg-yellow-100 text-yellow-700', text: 'Pending' },
      failed: { className: 'bg-red-100 text-red-700', text: 'Failed' },
    };
    const badge = badges[status] || badges.pending;
    return (
      <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${badge.className}`}>
        {badge.text}
      </span>
    );
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <LoadingSpinner size="large" text="Loading dashboard..." />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-secondary-50 fade-in">
      {/* Header */}
      <div className="bg-white border-b border-secondary-200">
        <div className="max-w-7xl mx-auto px-4 py-8">
          <div className="flex items-center gap-4">
            <div className="w-16 h-16 bg-primary-500 rounded-full flex items-center justify-center text-white text-2xl font-bold">
              {user?.name?.charAt(0).toUpperCase()}
            </div>
            <div>
              <h1 className="text-2xl font-bold text-secondary-900">Welcome back, {user?.name}!</h1>
              <p className="text-secondary-600">{user?.email}</p>
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-4 py-8">
        {/* Stats */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div className="card p-6 flex items-center gap-4">
            <div className="w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center text-primary-600"><HiShoppingBag className="w-6 h-6" /></div>
            <div><p className="text-sm text-secondary-600">Orders</p><p className="text-2xl font-bold">{orders.length}</p></div>
          </div>
          <div className="card p-6 flex items-center gap-4">
            <div className="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-green-600"><HiCheckCircle className="w-6 h-6" /></div>
            <div><p className="text-sm text-secondary-600">Completed</p><p className="text-2xl font-bold">{orders.filter(o => o.status === 'paid').length}</p></div>
          </div>
          <div className="card p-6 flex items-center gap-4">
            <div className="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center text-blue-600"><HiDownload className="w-6 h-6" /></div>
            <div><p className="text-sm text-secondary-600">Downloads</p><p className="text-2xl font-bold">{purchasedProjects.length}</p></div>
          </div>
          <div className="card p-6 flex items-center gap-4">
            <div className="w-12 h-12 bg-pink-100 rounded-xl flex items-center justify-center text-pink-600"><HiHeart className="w-6 h-6" /></div>
            <div><p className="text-sm text-secondary-600">Wishlist</p><p className="text-2xl font-bold">{wishlist.length}</p></div>
          </div>
        </div>

        {/* Tabs */}
        <div className="card">
          <div className="border-b border-secondary-200">
            <nav className="flex gap-8 px-6">
              {['orders', 'downloads', 'wishlist'].map(tab => (
                <button
                  key={tab}
                  onClick={() => setActiveTab(tab)}
                  className={`py-4 px-1 border-b-2 font-medium text-sm capitalize transition-colors ${activeTab === tab ? 'border-primary-500 text-primary-600' : 'border-transparent text-secondary-500 hover:text-secondary-800'}`}
                >
                  {tab}
                </button>
              ))}
            </nav>
          </div>

          <div className="p-6">
            {/* ORDERS TAB */}
            {activeTab === 'orders' && (
              orders.length === 0 ? <EmptyState title="No orders yet" /> : (
                <div className="space-y-4">
                  {orders.map((order) => (
                    <div key={order.id} className="border border-secondary-200 rounded-lg hover:shadow-sm transition-shadow cursor-pointer" onClick={() => setExpandedOrder(expandedOrder === order.id ? null : order.id)}>
                      <div className="p-4 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          <img src={order.project_thumbnail || 'https://via.placeholder.com/64'} className="w-16 h-16 rounded-lg object-cover" />
                          <div>
                            <h3 className="font-medium text-secondary-900">{order.project_title}</h3>
                            <p className="text-sm text-secondary-500">Order #{order.id}</p>
                            <p className="text-sm text-secondary-500">{formatDate(order.created_at)}</p>
                          </div>
                        </div>
                        <div className="text-right">
                          <p className="font-semibold text-secondary-900">{formatPrice(order.amount)}</p>
                          <div className="mt-1">{getStatusBadge(order.status)}</div>
                        </div>
                      </div>
                      
                      {/* Expanded Details */}
                      {expandedOrder === order.id && (
                        <div className="border-t border-secondary-200 bg-secondary-50 p-4 text-sm grid md:grid-cols-2 gap-4 fade-in">
                          <div>
                            <p><span className="text-secondary-600">Payment ID:</span> {order.razorpay_payment_id || 'N/A'}</p>
                            <p><span className="text-secondary-600">Category:</span> {order.project_category}</p>
                          </div>
                          <div className="flex justify-end gap-2">
                            <Link to={`/projects/${order.project_id}`} className="btn btn-secondary btn-sm">View Project</Link>
                            {order.status === 'paid' && <button onClick={() => setActiveTab('downloads')} className="btn btn-primary btn-sm">Go to Downloads</button>}
                          </div>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              )
            )}

            {/* DOWNLOADS TAB */}
            {activeTab === 'downloads' && (
              purchasedProjects.length === 0 ? <EmptyState title="No downloads available" /> : (
                <div className="grid md:grid-cols-2 gap-4">
                  {purchasedProjects.map((project) => (
                    <div key={project.id} className="card p-4 border border-secondary-200 hover:shadow-md transition-shadow">
                      <div className="flex gap-4">
                        <img src={project.thumbnail || 'https://via.placeholder.com/80'} className="w-20 h-20 rounded-lg object-cover" />
                        <div className="flex-1 min-w-0">
                          <h3 className="font-medium text-secondary-900 truncate">{project.title}</h3>
                          <div className="mt-2 space-y-1 text-sm">
                            <div className="flex items-center gap-2 text-secondary-600">
                              <HiDownload className="w-4 h-4" />
                              <span>{project.downloads_remaining} downloads left</span>
                            </div>
                            <div className="flex items-center gap-2 text-secondary-600">
                              <HiCalendar className="w-4 h-4" />
                              <span>Expires: {formatDate(project.expiry_date)}</span>
                            </div>
                          </div>
                          <div className="mt-3 flex gap-2">
                            <button 
                              onClick={() => handleDownload(project)}
                              disabled={downloadingId === project.id || project.downloads_remaining <= 0}
                              className="btn btn-primary btn-sm flex items-center gap-1"
                            >
                              {downloadingId === project.id ? "Preparing..." : <><HiDownload /> Download</>}
                            </button>
                            <Link to={`/projects/${project.id}`} className="btn btn-secondary btn-sm"><HiExternalLink /></Link>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )
            )}

            {/* WISHLIST TAB */}
            {activeTab === 'wishlist' && (
              wishlist.length === 0 ? <EmptyState title="Your wishlist is empty" /> : (
                <div className="grid md:grid-cols-3 gap-6">
                  {wishlist.map((item) => (
                    <div key={item.id} className="card p-4 text-center border border-secondary-200">
                      <div className="w-full h-32 bg-secondary-100 rounded-lg mb-3 flex items-center justify-center text-secondary-400">
                        <HiHeart className="w-8 h-8" />
                      </div>
                      <Link to={`/projects/${item.id}`} className="btn btn-primary btn-sm w-full">View Project</Link>
                      <button onClick={() => removeFromWishlist(item.id)} className="text-red-500 text-sm mt-2 hover:underline">Remove</button>
                    </div>
                  ))}
                </div>
              )
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

const EmptyState = ({ title }) => (
  <div className="text-center py-12">
    <div className="w-16 h-16 bg-secondary-100 rounded-full flex items-center justify-center mx-auto mb-4 text-secondary-400">
      <HiExclamationCircle className="w-8 h-8" />
    </div>
    <h3 className="text-lg font-medium text-secondary-900">{title}</h3>
    <Link to="/projects" className="btn btn-primary mt-4 inline-block">Browse Projects</Link>
  </div>
);

export default Dashboard;


================================================
FILE: frontend\src\pages\Home.jsx
================================================
ï»¿import React from "react";
import { useState, useEffect, useContext } from 'react';
import { Link } from 'react-router-dom';
import { 
  HiLightningBolt, 
  HiCode, 
  HiSupport, 
  HiShieldCheck,
  HiArrowRight,
  HiChip
} from 'react-icons/hi';
import ProjectCard from '../components/ProjectCard';
import { projectsAPI } from '../api/projects';
import { AuthContext } from '../context/AuthContext'; // â† ADD THIS

const Home = () => {
  const [featuredProjects, setFeaturedProjects] = useState([]);
  const [loading, setLoading] = useState(true);
  const { user } = useContext(AuthContext); // â† ADD THIS

  useEffect(() => {
    const fetchProjects = async () => {
      try {
        const response = await projectsAPI.getAll({ limit: 3 });
        if (response.success) {
          setFeaturedProjects(response.data.projects);
        }
      } catch (error) {
        console.error('Failed to fetch projects:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchProjects();
  }, []);

  const features = [
    {
      icon: HiCode,
      title: 'Production-Ready Code',
      description: 'Clean, well-documented code that follows industry best practices.',
    },
    {
      icon: HiChip,
      title: 'Complete Hardware Specs',
      description: 'Detailed component lists and circuit diagrams for easy replication.',
    },
    {
      icon: HiSupport,
      title: 'Technical Support',
      description: 'Get help from our team of experienced developers.',
    },
    {
      icon: HiShieldCheck,
      title: 'Secure Downloads',
      description: 'Instant access to your purchases with secure download links.',
    },
  ];

  return (
    <div className="fade-in">
      {/* Hero Section */}
      <section className="relative bg-gradient-to-br from-primary-600 via-primary-700 to-primary-900 text-white overflow-hidden">
        {/* Background Pattern */}
        <div className="absolute inset-0 opacity-10">
          <div className="absolute inset-0" style={{
            backgroundImage: `url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,
          }}></div>
        </div>

        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24 lg:py-32 relative">
          <div className="grid lg:grid-cols-2 gap-12 items-center">
            <div>
              <div className="inline-flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-4 py-2 mb-6">
                <HiLightningBolt className="w-5 h-5 text-yellow-400" />
                <span className="text-sm font-medium">Premium IoT Projects</span>
              </div>
              
              <h1 className="text-4xl lg:text-6xl font-bold mb-6 leading-tight">
                Build Amazing
                <span className="block text-primary-200">IoT Projects</span>
              </h1>
              
              <p className="text-lg text-primary-100 mb-8 max-w-lg">
                Get instant access to production-ready IoT and embedded systems projects. 
                Complete source code, documentation, and support included.
              </p>
              
              <div className="flex flex-wrap gap-4">
                <Link to="/projects" className="btn btn-lg bg-white text-primary-700 hover:bg-primary-50">
                  Browse Projects
                  <HiArrowRight className="w-5 h-5 ml-2" />
                </Link>
                {!user && (
                  <Link to="/signup" className="btn btn-lg bg-primary-500 text-white hover:bg-primary-400 border-2 border-white/20">
                    Get Started
                  </Link>
                )}
              </div>

              {/* Stats */}
              <div className="grid grid-cols-3 gap-8 mt-12 pt-8 border-t border-white/20">
                <div>
                  <div className="text-3xl font-bold">50+</div>
                  <div className="text-primary-200 text-sm">Projects</div>
                </div>
                <div>
                  <div className="text-3xl font-bold">1000+</div>
                  <div className="text-primary-200 text-sm">Customers</div>
                </div>
                <div>
                  <div className="text-3xl font-bold">4.9</div>
                  <div className="text-primary-200 text-sm">Rating</div>
                </div>
              </div>
            </div>

            {/* Hero Image */}
            <div className="hidden lg:block">
              <div className="relative">
                <div className="absolute -inset-4 bg-white/10 rounded-3xl blur-2xl"></div>
                <img
                  src="/public/hero-iot.png"
                  alt="IoT Projects"
                  className="relative rounded-2xl shadow-2xl"
                />
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Features Section */}
      <section className="py-20 bg-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="text-center mb-16">
            <h2 className="text-3xl lg:text-4xl font-bold text-secondary-900 mb-4">
              Why Choose Inovitaz?
            </h2>
            <p className="text-lg text-secondary-600 max-w-2xl mx-auto">
              We provide everything you need to bring your IoT ideas to life.
            </p>
          </div>

          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
            {features.map((feature, index) => (
              <div 
                key={index}
                className="text-center p-6 rounded-2xl bg-secondary-50 hover:bg-primary-50 transition-colors group"
              >
                <div className="w-14 h-14 bg-primary-100 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:bg-primary-200 transition-colors">
                  <feature.icon className="w-7 h-7 text-primary-600" />
                </div>
                <h3 className="text-lg font-semibold text-secondary-900 mb-2">
                  {feature.title}
                </h3>
                <p className="text-secondary-600 text-sm">
                  {feature.description}
                </p>
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* Featured Projects Section */}
      <section className="py-20 bg-secondary-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-end mb-12">
            <div>
              <h2 className="text-3xl lg:text-4xl font-bold text-secondary-900 mb-4">
                Featured Projects
              </h2>
              <p className="text-lg text-secondary-600">
                Our most popular IoT and embedded systems projects
              </p>
            </div>
            <Link 
              to="/projects"
              className="hidden md:inline-flex items-center gap-2 text-primary-600 font-medium hover:text-primary-700 transition-colors"
            >
              View All Projects
              <HiArrowRight className="w-5 h-5" />
            </Link>
          </div>

          {loading ? (
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {[...Array(3)].map((_, i) => (
                <div key={i} className="card">
                  <div className="h-48 skeleton"></div>
                  <div className="p-5">
                    <div className="h-6 skeleton rounded mb-2"></div>
                    <div className="h-4 skeleton rounded w-3/4 mb-4"></div>
                    <div className="h-8 skeleton rounded w-1/3"></div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {featuredProjects.map((project) => (
                <ProjectCard key={project.id} project={project} />
              ))}
            </div>
          )}

          <div className="mt-12 text-center md:hidden">
            <Link 
              to="/projects"
              className="btn btn-primary btn-lg"
            >
              View All Projects
              <HiArrowRight className="w-5 h-5 ml-2" />
            </Link>
          </div>
        </div>
      </section>

      {/* CTA Section - ONLY FOR VISITORS */}
      {!user && (
        <section className="py-20 bg-secondary-900">
          <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 className="text-3xl lg:text-4xl font-bold text-white mb-4">
              Ready to Start Building?
            </h2>
            <p className="text-lg text-secondary-300 mb-8">
              Join thousands of developers and makers who trust Inovitaz for their IoT projects.
            </p>
            <div className="flex flex-wrap justify-center gap-4">
              <Link to="/signup" className="btn btn-lg btn-primary">
                Create Free Account
              </Link>
              <Link to="/projects" className="btn btn-lg bg-secondary-800 text-white hover:bg-secondary-700">
                Explore Projects
              </Link>
            </div>
          </div>
        </section>
      )}
    </div>
  );
};

export default Home;


================================================
FILE: frontend\src\pages\Login.jsx
================================================
ï»¿import { useState } from 'react';
import { Link, useNavigate, useLocation } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import { HiMail, HiLockClosed, HiArrowRight, HiEye, HiEyeOff } from 'react-icons/hi';
import toast from 'react-hot-toast';

const Login = () => {
  const [formData, setFormData] = useState({ email: '', password: '' });
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  
  const { login, isAuthenticated } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();
  const from = location.state?.from?.pathname || '/dashboard';

  if (isAuthenticated) {
    navigate('/dashboard', { replace: true });
    return null;
  }

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      await login(formData);
      toast.success('Welcome back!');
      navigate(from, { replace: true });
    } catch (error) {
      toast.error(error.message || 'Login failed. Check credentials.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex bg-white fade-in">
      
      {/* Left Side - Form */}
      <div className="flex-1 flex items-center justify-center px-4 sm:px-6 lg:px-8 py-12">
        <div className="w-full max-w-md space-y-8">
          <div>
            <Link to="/" className="flex items-center gap-2 mb-6">
              <div className="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-700 rounded-lg flex items-center justify-center">
                <span className="text-white font-bold text-xl">I</span>
              </div>
              <span className="text-xl font-bold text-secondary-900">Inovitaz</span>
            </Link>
            <h2 className="text-3xl font-bold text-gray-900">Welcome back</h2>
            <p className="mt-2 text-sm text-gray-600">Please enter your details to sign in.</p>
          </div>

          <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
            <div className="space-y-4">
              {/* Email */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Email address</label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <HiMail className="h-5 w-5 text-gray-400" />
                  </div>
                  <input
                    type="email"
                    required
                    className="input pl-10 w-full"
                    placeholder="you@example.com"
                    value={formData.email}
                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                  />
                </div>
              </div>

              {/* Password */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <HiLockClosed className="h-5 w-5 text-gray-400" />
                  </div>
                  <input
                    type={showPassword ? 'text' : 'password'}
                    required
                    className="input pl-10 pr-10 w-full"
                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                    value={formData.password}
                    onChange={(e) => setFormData({ ...formData, password: e.target.value })}
                  />
                  <button
                    type="button"
                    className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
                    onClick={() => setShowPassword(!showPassword)}
                  >
                    {showPassword ? <HiEyeOff className="h-5 w-5" /> : <HiEye className="h-5 w-5" />}
                  </button>
                </div>
              </div>
            </div>

            <div className="flex items-center justify-between">
              <div className="flex items-center">
                <input id="remember-me" type="checkbox" className="h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500" />
                <label htmlFor="remember-me" className="ml-2 block text-sm text-gray-900">Remember me</label>
              </div>
              <div className="text-sm">
                <Link to="/support" className="font-medium text-primary-600 hover:text-primary-500">Forgot password?</Link>
              </div>
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full btn btn-primary flex justify-center items-center gap-2 py-3 shadow-lg hover:shadow-xl transition-all"
            >
              {loading ? (
                <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
              ) : (
                <>Sign in <HiArrowRight /></>
              )}
            </button>
          </form>

          <p className="mt-2 text-center text-sm text-gray-600">
            Don't have an account?{' '}
            <Link to="/signup" className="font-medium text-primary-600 hover:text-primary-500">
              Sign up for free
            </Link>
          </p>
        </div>
      </div>

      {/* Right Side - Art */}
      <div className="hidden lg:flex flex-1 bg-secondary-900 relative overflow-hidden items-center justify-center">
        <div className="absolute inset-0 bg-gradient-to-br from-primary-600 to-primary-900 opacity-90" />
        <div className="absolute inset-0" style={{ backgroundImage: 'url("https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=1600&q=80")', backgroundSize: 'cover', backgroundPosition: 'center', mixBlendMode: 'overlay' }}></div>
        <div className="relative z-10 text-center px-8">
          <h2 className="text-4xl font-bold text-white mb-4">Build the Future</h2>
          <p className="text-primary-100 text-lg max-w-md mx-auto">Join thousands of developers building amazing IoT projects.</p>
        </div>
      </div>
    </div>
  );
};

export default Login;


================================================
FILE: frontend\src\pages\NotFound.jsx
================================================
import { Link } from 'react-router-dom';
import { HiHome, HiArrowLeft } from 'react-icons/hi';

const NotFound = () => {
  return (
    <div className="min-h-screen bg-secondary-50 flex items-center justify-center px-4 fade-in">
      <div className="text-center">
        {/* 404 Illustration */}
        <div className="relative">
          <h1 className="text-[150px] md:text-[200px] font-bold text-secondary-200 leading-none select-none">
            404
          </h1>
          <div className="absolute inset-0 flex items-center justify-center">
            <div className="w-32 h-32 bg-primary-100 rounded-full flex items-center justify-center">
              <span className="text-6xl">ðŸ”</span>
            </div>
          </div>
        </div>

        {/* Text Content */}
        <div className="mt-8">
          <h2 className="text-3xl font-bold text-secondary-900 mb-4">
            Page Not Found
          </h2>
          <p className="text-secondary-600 max-w-md mx-auto mb-8">
            Oops! The page you're looking for doesn't exist or has been moved. 
            Let's get you back on track.
          </p>

          {/* Action Buttons */}
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <Link
              to="/"
              className="btn btn-primary btn-lg inline-flex items-center justify-center"
            >
              <HiHome className="w-5 h-5 mr-2" />
              Go to Home
            </Link>
            <button
              onClick={() => window.history.back()}
              className="btn btn-secondary btn-lg inline-flex items-center justify-center"
            >
              <HiArrowLeft className="w-5 h-5 mr-2" />
              Go Back
            </button>
          </div>
        </div>

        {/* Quick Links */}
        <div className="mt-12 pt-8 border-t border-secondary-200">
          <p className="text-secondary-500 mb-4">Or check out these pages:</p>
          <div className="flex flex-wrap justify-center gap-4">
            <Link
              to="/projects"
              className="text-primary-600 hover:text-primary-700 font-medium"
            >
              Browse Projects
            </Link>
            <span className="text-secondary-300">â€¢</span>
            <Link
              to="/login"
              className="text-primary-600 hover:text-primary-700 font-medium"
            >
              Login
            </Link>
            <span className="text-secondary-300">â€¢</span>
            <Link
              to="/signup"
              className="text-primary-600 hover:text-primary-700 font-medium"
            >
              Sign Up
            </Link>
          </div>
        </div>
      </div>
    </div>
  );
};

export default NotFound;


================================================
FILE: frontend\src\pages\Privacy.jsx
================================================
export default function Privacy() {
  return (
    <div className="min-h-screen bg-secondary-50 fade-in py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-3xl mx-auto bg-white rounded-2xl shadow-sm border border-secondary-200 px-8 py-10">
        <h1 className="text-3xl font-bold text-secondary-900 mb-2">Privacy Policy</h1>
        <p className="text-secondary-500 text-sm mb-8">Last updated: {new Date().toLocaleDateString()}</p>

        <div className="space-y-8 text-secondary-700">
          <p>
            At <strong>Inovitaz</strong>, we respect your privacy. This policy explains how we handle your data.
          </p>

          <section>
            <h2 className="text-xl font-semibold text-secondary-900 mb-3">Data We Collect</h2>
            <ul className="list-disc pl-5 space-y-2">
              <li><strong>Account Info:</strong> Name, email address (for login and delivery).</li>
              <li><strong>Payment Info:</strong> We do NOT store card details. Payments are processed securely via Razorpay.</li>
              <li><strong>Usage Data:</strong> Download history and order logs.</li>
            </ul>
          </section>

          <section>
            <h2 className="text-xl font-semibold text-secondary-900 mb-3">How We Use Data</h2>
            <p>
              We use your email solely to send order confirmations, download links, and critical account updates. We do not sell your data to third parties.
            </p>
          </section>

          <section>
            <h2 className="text-xl font-semibold text-secondary-900 mb-3">Security</h2>
            <p>
              We use industry-standard encryption (HTTPS/TLS) and secure database practices to protect your personal information. Passwords are hashed and never stored in plain text.
            </p>
          </section>

          <section>
            <h2 className="text-xl font-semibold text-secondary-900 mb-3">Contact Us</h2>
            <p>
              If you have questions about this policy, please contact our support team at <span className="font-medium text-primary-600">inovitaz.help@gmail.com</span>.
            </p>
          </section>
        </div>
      </div>
    </div>
  );
}


================================================
FILE: frontend\src\pages\ProjectDetails.jsx
================================================
import { useParams, Link, useNavigate } from "react-router-dom";
import { useEffect, useState, useContext } from "react";
import { projectsAPI } from "../api/projects";
import { AuthContext } from "../context/AuthContext";
import Linkify from 'react-linkify'; 
import { 
  HiStar, 
  HiShoppingCart, 
  HiChip, 
  HiHeart,
  HiOutlineHeart,
  HiCheckCircle,
  HiLockClosed,
  HiClock,
  HiDownload,
  HiPhotograph,
  HiClipboardList,
  HiLink,
  HiUserCircle,
  HiExternalLink
} from "react-icons/hi";
import toast from "react-hot-toast";
import LoadingSpinner from "../components/LoadingSpinner";

export default function ProjectDetails() {
  const { id } = useParams();
  const { user, logout } = useContext(AuthContext);
  const navigate = useNavigate();

  const [project, setProject] = useState(null);
  const [loading, setLoading] = useState(true);
  const [processing, setProcessing] = useState(false);
  const [activeTab, setActiveTab] = useState('overview');
  const [reviews, setReviews] = useState([]);
  const [isWishlisted, setIsWishlisted] = useState(false);

  // Review Form State
  const [newReview, setNewReview] = useState({ rating: 5, comment: "" });
  const [submittingReview, setSubmittingReview] = useState(false);

  useEffect(() => {
    loadProject();
    loadReviews();
    checkWishlist();
  }, [id]);

  async function loadProject() {
    try {
      const res = await projectsAPI.getById(id);
      if (res?.success) setProject(res.data);
    } catch (err) {
      console.error(err);
    } finally {
      setLoading(false);
    }
  }

  async function loadReviews() {
    try {
      const res = await fetch(`${import.meta.env.VITE_API_BASE_URL}/projects/${id}/reviews`);
      const data = await res.json();
      if (data.success) {
        setReviews(data.data.reviews || []);
      }
    } catch (err) {
      console.error("Failed to load reviews", err);
    }
  }

  async function handleSubmitReview(e) {
    e.preventDefault();
    if (!newReview.comment.trim()) return toast.error("Please write a comment");
    
    setSubmittingReview(true);
    try {
      const res = await fetch(`${import.meta.env.VITE_API_BASE_URL}/reviews`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${localStorage.getItem("token")}`,
        },
        body: JSON.stringify({ 
          project_id: id,
          rating: newReview.rating, 
          comment: newReview.comment 
        }),
      });

      const data = await res.json();
      if (data.success) {
        toast.success("Review submitted!");
        setNewReview({ rating: 5, comment: "" });
        loadReviews();
      } else {
        toast.error(data.message || "Failed to submit review");
      }
    } catch (err) {
      toast.error("Something went wrong");
    } finally {
      setSubmittingReview(false);
    }
  }

  function checkWishlist() {
    const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
    setIsWishlisted(wishlist.includes(id));
  }

  async function toggleWishlist() {
    if (!user) {
      toast.error('Please login to add to wishlist');
      return;
    }
    try {
      if (isWishlisted) {
        await projectsAPI.removeFromWishlist(id);
        toast.success('Removed from wishlist');
        setIsWishlisted(false);
      } else {
        await projectsAPI.addToWishlist(id);
        toast.success('Added to wishlist');
        setIsWishlisted(true);
      }
    } catch (error) {
      toast.error('Failed to update wishlist');
    }
  }

  // --- SMART DATA PARSER (FIXED FOR QUANTITY) ---
  let overviewText = "";
  let components = []; // Stores { name, quantity, link }
  let downloadUrl = "#";
  let circuit = { image: "", text: "" };
  let steps = "";
  let source = "";

  if (project) {
    const rawDesc = project.description || "";
    try {
      let descObj = {};
      if (typeof rawDesc === 'object') {
        descObj = rawDesc;
      } else if (rawDesc.trim().startsWith('{')) {
        descObj = JSON.parse(rawDesc);
      } else {
        descObj = { overview: rawDesc };
      }

      overviewText = descObj.overview || rawDesc;
      downloadUrl = descObj.download_url || "#";
      circuit = descObj.circuit || { image: descObj.circuitImage, text: descObj.circuitText } || {};
      steps = descObj.steps || "";
      source = descObj.source || "";

      // FIX: Correctly parse objects to keep quantity
      if (descObj.components) {
        if (Array.isArray(descObj.components)) {
          components = descObj.components.map(c => {
             // If it's an object from Admin Panel
             if (typeof c === 'object') {
                return {
                  name: c.name || "Unknown Component",
                  quantity: c.quantity || c.price || "1", // Handle 'price' legacy field or 'quantity'
                  link: c.link || ""
                };
             }
             // If it's just a string string (legacy data)
             return { name: c, quantity: "1", link: "" };
          });
        } else if (typeof descObj.components === 'string') {
          // If newline separated string
          components = descObj.components.split(/,|\n/).map(line => ({
            name: line.trim(),
            quantity: "1",
            link: ""
          })).filter(c => c.name);
        }
      }
    } catch (e) {
      overviewText = rawDesc.replace(/[{"}]/g, '').replace(/overview:/g, '');
    }
  }

  const displayPrice = project ? (project.price > 10000 ? project.price / 100 : project.price) : 0;
  
  const avgRating = reviews.length > 0 
    ? (reviews.reduce((acc, curr) => acc + curr.rating, 0) / reviews.length).toFixed(1) 
    : 0;

  const purchased = project?.isPurchased || user?.role === "admin";

  async function handleBuy() {
    if (!user) {
      toast.error("Please log in to buy.");
      navigate('/login');
      return;
    }

    if (!window.Razorpay) {
      toast.error("Payment system loading... please refresh.");
      return;
    }

    setProcessing(true);

    try {
      const orderRes = await fetch(
        `${import.meta.env.VITE_API_BASE_URL}/payment/create-order`,
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${localStorage.getItem("token")}`,
          },
          body: JSON.stringify({ projectId: project.id }),
        }
      );

      if (orderRes.status === 401) {
        toast.error("Session expired. Please login again.");
        logout(); 
        navigate('/login');
        return;
      }

      const orderData = await orderRes.json();
      if (!orderData.success) { throw new Error(orderData.message); }

      const options = {
        key: import.meta.env.VITE_RAZORPAY_KEY_ID,
        amount: orderData.amount,
        currency: "INR",
        name: "Inovitaz",
        description: project.title,
        order_id: orderData.orderId,
        handler: async function (response) {
          try {
            const verifyRes = await fetch(
              `${import.meta.env.VITE_API_BASE_URL}/payment/verify`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${localStorage.getItem("token")}`,
                },
                body: JSON.stringify({
                  projectId: project.id,
                  razorpay_order_id: response.razorpay_order_id,
                  razorpay_payment_id: response.razorpay_payment_id,
                  razorpay_signature: response.razorpay_signature,
                }),
              }
            );
            const verifyData = await verifyRes.json();
            if (verifyData.success) {
              toast.success("Payment Successful! Project Unlocked.");
              window.location.reload();
            } else {
              toast.error("Payment verification failed.");
            }
          } catch (e) {
            toast.error("Verification error.");
          }
        },
        modal: {
          ondismiss: function () {
            setProcessing(false);
            toast("Payment cancelled");
          },
        },
      };

      const razorpay = new window.Razorpay(options);
      razorpay.open();
    } catch (err) {
      console.error(err);
      toast.error(err.message || "Payment initialization failed.");
      setProcessing(false);
    }
  }

  // --- LINK DECORATORS ---
  const standardLinkDecorator = (href, text, key) => (
    <a href={href} key={key} target="_blank" rel="noopener noreferrer" className="text-blue-600 underline hover:text-blue-800 break-words z-20 relative">
      {text}
    </a>
  );

  const StarRating = ({ rating }) => (
    <div className="flex gap-1">
      {[1, 2, 3, 4, 5].map((star) => (
        <HiStar key={star} className={`w-5 h-5 ${star <= rating ? 'text-yellow-400' : 'text-gray-300'}`} />
      ))}
    </div>
  );

  const LockedOverlay = () => (
    <div className="absolute inset-0 bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center text-center z-10 rounded-lg border border-secondary-200">
      <div className="bg-white p-8 rounded-2xl shadow-2xl border border-secondary-100 max-w-sm transform scale-100 transition-transform">
        <div className="w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
          <HiLockClosed className="w-8 h-8" />
        </div>
        <h3 className="text-xl font-bold text-secondary-900 mb-2">Premium Content Locked</h3>
        <p className="text-secondary-500 mb-6 leading-relaxed">
          Purchase this project to instantly access the full source code, circuit diagrams, and documentation.
        </p>
        <button 
          onClick={handleBuy} 
          disabled={processing}
          className="w-full btn btn-primary py-3 flex items-center justify-center gap-2 text-lg shadow-lg hover:shadow-blue-500/30 transition-all"
        >
          {processing ? "Processing..." : <><HiShoppingCart /> Buy Now â‚¹{displayPrice}</>}
        </button>
      </div>
    </div>
  );

  if (loading) return <div className="min-h-screen flex items-center justify-center"><LoadingSpinner size="large" /></div>;
  if (!project) return <div className="text-center py-20">Project not found.</div>;

  const tabs = ['overview', 'components'];
  if (purchased) {
    tabs.push('circuit', 'steps');
  }
  tabs.push('reviews');

  return (
    <div className="min-h-screen bg-secondary-50 fade-in">
      {/* Header */}
      <div className="bg-white border-b border-secondary-200">
        <div className="max-w-7xl mx-auto px-4 py-10">
          <div className="grid lg:grid-cols-2 gap-10">
            {/* Image */}
            <div className="relative">
              <img 
                src={project.thumbnail || 'https://via.placeholder.com/600x400'} 
                alt={project.title} 
                className="w-full rounded-xl shadow-lg object-cover aspect-video"
                onError={(e) => e.target.src = 'https://via.placeholder.com/600x400'}
              />
            </div>

            {/* Info */}
            <div className="flex flex-col justify-center">
              <span className="text-primary-600 font-semibold tracking-wide text-sm mb-2 uppercase">{project.category}</span>
              <h1 className="text-3xl font-bold text-secondary-900 mb-2 leading-tight">{project.title}</h1>
              
              <div className="flex items-center gap-4 mb-6">
                <div className="flex items-center gap-1">
                  <StarRating rating={avgRating} />
                  <span className="text-lg font-bold ml-1">{avgRating > 0 ? avgRating : "New"}</span>
                  <span className="text-sm text-secondary-500">({reviews.length} reviews)</span>
                </div>
                <button onClick={toggleWishlist} className="ml-auto flex items-center gap-2 px-3 py-1 rounded-full hover:bg-red-50 transition-colors text-secondary-600 hover:text-red-500">
                  {isWishlisted ? <HiHeart className="w-6 h-6 text-red-500" /> : <HiOutlineHeart className="w-6 h-6" />}
                  <span className="text-sm font-medium">{isWishlisted ? 'Saved' : 'Save'}</span>
                </button>
              </div>

              <div className="flex items-baseline gap-3 mb-8">
                <span className="text-5xl font-bold text-primary-600">â‚¹{displayPrice}</span>
                <span className="text-xl text-secondary-400 line-through">â‚¹{Math.round(displayPrice * 1.5)}</span>
                <span className="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-bold">33% OFF</span>
              </div>

              {!purchased ? (
                <button onClick={handleBuy} disabled={processing} className="w-full btn btn-primary btn-lg text-lg py-4 shadow-lg hover:shadow-xl transition-all">
                  {processing ? "Processing Payment..." : "Buy Now & Unlock Full Access"}
                </button>
              ) : (
                <a href={downloadUrl} target="_blank" rel="noopener noreferrer" className="w-full btn btn-success btn-lg text-lg py-4 text-center block shadow-lg bg-green-600 hover:bg-green-700 text-white rounded-lg">
                  Download Project Files (ZIP)
                </a>
              )}
              
              {!purchased && (
                <p className="text-center text-xs text-secondary-400 mt-3 flex items-center justify-center gap-1">
                  <HiCheckCircle className="text-green-500" /> Secure payment via Razorpay
                </p>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* Content Tabs */}
      <div className="max-w-7xl mx-auto px-4 py-10">
        <div className="card overflow-hidden bg-white shadow-sm rounded-xl min-h-[400px]">
          {/* Tab Navigation */}
          <div className="flex border-b bg-gray-50 overflow-x-auto">
            {tabs.map(tab => (
              <button 
                key={tab} 
                onClick={() => setActiveTab(tab)} 
                className={`px-6 py-4 capitalize font-medium transition-colors border-b-2 whitespace-nowrap ${activeTab === tab ? 'border-primary-600 text-primary-700 bg-white' : 'border-transparent text-secondary-500 hover:text-secondary-800 hover:bg-gray-100'}`}
              >
                {tab}
              </button>
            ))}
          </div>

          <div className="p-8 relative">
            
            {/* OVERVIEW TAB */}
            {activeTab === 'overview' && (
              <div className="relative">
                <div className={`prose max-w-none text-secondary-700 leading-relaxed ${!purchased ? 'max-h-40 overflow-hidden mask-fade-bottom' : ''}`}>
                  <h3 className="text-xl font-bold text-secondary-900 mb-4">Project Overview</h3>
                  <div style={{ whiteSpace: "pre-line" }}>
                    <Linkify componentDecorator={standardLinkDecorator}>
                      {overviewText}
                    </Linkify>
                  </div>
                </div>
                {!purchased && <LockedOverlay />}
              </div>
            )}

            {/* COMPONENTS TAB - FIXED TO SHOW QUANTITY */}
            {activeTab === 'components' && (
              <div className="relative min-h-[200px]">
                {purchased ? (
                  <div>
                    <h3 className="text-xl font-bold text-secondary-900 mb-6">Required Components</h3>
                    {components.length > 0 ? (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {components.map((c, i) => (
                          <div key={i} className="flex items-center justify-between bg-secondary-50 p-4 rounded-xl border border-secondary-100 hover:shadow-md transition-all">
                            {/* Left: Name and Quantity */}
                            <div className="flex items-center gap-3">
                              <div className="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0">
                                <HiChip className="text-primary-600 w-5 h-5" />
                              </div>
                              <div>
                                <p className="font-semibold text-secondary-900">{c.name}</p>
                                <p className="text-xs text-secondary-500 font-medium bg-secondary-200 px-2 py-0.5 rounded-full inline-block mt-1">
                                  Qty: {c.quantity}
                                </p>
                              </div>
                            </div>

                            {/* Right: Buy Link */}
                            {c.link && (
                              <a 
                                href={c.link} 
                                target="_blank" 
                                rel="noopener noreferrer"
                                className="flex items-center gap-1 text-xs font-bold text-primary-700 bg-white border border-primary-200 hover:bg-primary-50 px-3 py-1.5 rounded-lg transition-colors"
                              >
                                <HiShoppingCart className="w-3 h-3" />
                                Buy
                              </a>
                            )}
                          </div>
                        ))}
                      </div>
                    ) : (
                      <p className="text-secondary-500 italic">No component list available.</p>
                    )}
                  </div>
                ) : (
                  // Blurred Dummy Content
                  <div className="filter blur-md select-none opacity-50">
                    <h3 className="text-xl font-bold text-secondary-900 mb-4">Required Components</h3>
                    <ul className="grid grid-cols-1 md:grid-cols-2 gap-3">
                        {[1,2,3,4].map((i) => (
                          <li key={i} className="flex items-center gap-3 bg-secondary-50 p-3 rounded-lg border border-secondary-100">
                            <div className="w-5 h-5 bg-gray-300 rounded-full"></div>
                            <div className="h-4 bg-gray-300 rounded w-2/3"></div>
                          </li>
                        ))}
                    </ul>
                  </div>
                )}
                {!purchased && <LockedOverlay />}
              </div>
            )}

            {/* CIRCUIT TAB */}
            {activeTab === 'circuit' && (
              <div>
                <h3 className="text-xl font-bold text-secondary-900 mb-4 flex items-center gap-2">
                  <HiPhotograph className="text-primary-500" /> Circuit Diagram
                </h3>
                {circuit.image ? (
                  <div className="mb-6">
                    <img src={circuit.image} alt="Circuit" className="rounded-lg border border-secondary-200 shadow-sm max-w-full md:max-w-2xl" />
                  </div>
                ) : (
                  <p className="text-secondary-500 italic mb-4">No diagram image available.</p>
                )}
                
                {circuit.text && (
                  <div className="bg-secondary-50 p-4 rounded-lg border border-secondary-100">
                    <h4 className="font-semibold text-secondary-900 mb-2">Wiring Instructions:</h4>
                    <div className="text-secondary-700 whitespace-pre-line">
                      <Linkify componentDecorator={standardLinkDecorator}>
                        {circuit.text}
                      </Linkify>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* STEPS TAB */}
            {activeTab === 'steps' && (
              <div>
                <h3 className="text-xl font-bold text-secondary-900 mb-4 flex items-center gap-2">
                  <HiClipboardList className="text-primary-500" /> Step-by-Step Guide
                </h3>
                <div className="prose max-w-none text-secondary-700">
                  <div style={{ whiteSpace: "pre-line" }}>
                    <Linkify componentDecorator={standardLinkDecorator}>
                      {steps || "No steps provided."}
                    </Linkify>
                  </div>
                </div>

                {source && (
                  <div className="mt-8 border-t border-secondary-200 pt-6">
                    <h4 className="text-lg font-bold text-secondary-900 mb-3">Source Code / Notes</h4>
                    <pre className="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm">
                      {source}
                    </pre>
                  </div>
                )}
              </div>
            )}

            {/* REVIEWS TAB */}
            {activeTab === 'reviews' && (
              <div>
                <h3 className="text-xl font-bold text-secondary-900 mb-6">Customer Reviews</h3>

                {purchased ? (
                  <div className="bg-blue-50 p-6 rounded-lg mb-8 border border-blue-100">
                    <h4 className="font-bold text-secondary-800 mb-3">Leave a Review</h4>
                    <form onSubmit={handleSubmitReview}>
                      <div className="flex items-center gap-2 mb-4">
                        <span className="text-sm font-medium text-secondary-600">Rating:</span>
                        <div className="flex gap-1 cursor-pointer">
                          {[1, 2, 3, 4, 5].map((star) => (
                            <HiStar 
                              key={star} 
                              onClick={() => setNewReview({...newReview, rating: star})}
                              className={`w-7 h-7 hover:scale-110 transition-transform ${star <= newReview.rating ? 'text-yellow-400' : 'text-gray-300'}`} 
                            />
                          ))}
                        </div>
                      </div>
                      <textarea
                        className="w-full p-3 border border-secondary-200 rounded-md focus:ring-2 focus:ring-primary-500 focus:outline-none mb-3"
                        rows="3"
                        placeholder="Share your experience..."
                        value={newReview.comment}
                        onChange={(e) => setNewReview({...newReview, comment: e.target.value})}
                      />
                      <button 
                        disabled={submittingReview} 
                        className="btn btn-primary px-6 py-2 shadow-sm"
                      >
                        {submittingReview ? "Submitting..." : "Submit Review"}
                      </button>
                    </form>
                  </div>
                ) : user ? (
                  <div className="bg-gray-50 p-4 rounded-lg mb-8 text-center border border-dashed border-gray-300">
                    <p className="text-secondary-500">You must purchase this project to leave a review.</p>
                  </div>
                ) : (
                  <div className="bg-gray-50 p-4 rounded-lg mb-8 text-center border border-dashed border-gray-300">
                    <p className="text-secondary-500">Please <Link to="/login" className="text-primary-600 underline">login</Link> and purchase to leave a review.</p>
                  </div>
                )}

                {reviews.length > 0 ? (
                  <div className="space-y-6">
                    {reviews.map((review, idx) => (
                      <div key={review.id || idx} className="border-b border-secondary-100 pb-6 last:border-0">
                        <div className="flex items-start gap-4">
                           <div className="bg-gray-200 rounded-full p-2">
                             <HiUserCircle className="w-8 h-8 text-gray-500"/>
                           </div>
                           <div className="flex-1">
                              <div className="flex items-center justify-between mb-1">
                                <h5 className="font-bold text-secondary-900">{review.user_name || "Verified Buyer"}</h5>
                                <span className="text-xs text-secondary-400">
                                  {review.created_at ? new Date(review.created_at).toLocaleDateString() : "Recent"}
                                </span>
                              </div>
                              <StarRating rating={review.rating} />
                              <p className="text-secondary-700 mt-2 leading-relaxed">{review.comment}</p>
                           </div>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <p className="text-secondary-500 italic text-center py-4">No reviews yet. Be the first to review!</p>
                )}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}


================================================
FILE: frontend\src\pages\Projects.jsx
================================================
ï»¿// src/pages/Projects.jsx
import { useState, useEffect } from 'react';
import { useSearchParams } from 'react-router-dom';
import { HiSearch, HiFilter, HiX } from 'react-icons/hi';
import ProjectCard from '../components/ProjectCard';
import LoadingSpinner from '../components/LoadingSpinner';
import { projectsAPI } from '../api/projects';

const Projects = () => {
  const [searchParams, setSearchParams] = useSearchParams();
  const [projects, setProjects] = useState([]);
  const [categories, setCategories] = useState([]);
  const [loading, setLoading] = useState(true);
  const [pagination, setPagination] = useState({});
  const [showFilters, setShowFilters] = useState(false);

  // Filter states
  const [search, setSearch] = useState(searchParams.get('search') || '');
  const [category, setCategory] = useState(searchParams.get('category') || '');
  const [sort, setSort] = useState(searchParams.get('sort') || 'newest');
  const [page, setPage] = useState(parseInt(searchParams.get('page')) || 1);
  
  // ADDED: New filter states
  const [difficulty, setDifficulty] = useState(searchParams.get('difficulty') || '');
  const [maxPrice, setMaxPrice] = useState(searchParams.get('maxPrice') || '999');
  const [technology, setTechnology] = useState(searchParams.get('technology') || '');

  useEffect(() => {
    fetchProjects();
    fetchCategories();
  }, [category, sort, page, difficulty, maxPrice, technology]); // MODIFIED: Added new dependencies

  const fetchProjects = async () => {
    setLoading(true);
    try {
      const response = await projectsAPI.getAll({
        search,
        category,
        sort,
        page,
        limit: 12,
        // ADDED: New filter parameters
        difficulty,
        maxPrice,
        technology,
      });

      if (response.success) {
        setProjects(response.data.projects);
        setPagination(response.data.pagination);
      }
    } catch (error) {
      console.error('Failed to fetch projects:', error);
    } finally {
      setLoading(false);
    }
  };

  const fetchCategories = async () => {
    try {
      const response = await projectsAPI.getCategories();
      if (response.success) {
        setCategories(response.data);
      }
    } catch (error) {
      console.error('Failed to fetch categories:', error);
    }
  };

  const handleSearch = (e) => {
    e.preventDefault();
    setPage(1);
    fetchProjects();
    updateSearchParams();
  };

  const updateSearchParams = () => {
    const params = new URLSearchParams();
    if (search) params.set('search', search);
    if (category) params.set('category', category);
    if (sort !== 'newest') params.set('sort', sort);
    if (page > 1) params.set('page', page.toString());
    // ADDED: New params
    if (difficulty) params.set('difficulty', difficulty);
    if (maxPrice !== '999') params.set('maxPrice', maxPrice);
    if (technology) params.set('technology', technology);
    setSearchParams(params);
  };

  const clearFilters = () => {
    setSearch('');
    setCategory('');
    setSort('newest');
    setPage(1);
    // ADDED: Clear new filters
    setDifficulty('');
    setMaxPrice('999');
    setTechnology('');
    setSearchParams({});
  };

  const sortOptions = [
    { value: 'newest', label: 'Newest First' },
    { value: 'oldest', label: 'Oldest First' },
    { value: 'price_asc', label: 'Price: Low to High' },
    { value: 'price_desc', label: 'Price: High to Low' },
    { value: 'popular', label: 'Most Popular' }, // ADDED
    { value: 'rating', label: 'Highest Rated' }, // ADDED
  ];

  // ADDED: Difficulty options
  const difficultyOptions = [
    { value: '', label: 'All Levels' },
    { value: 'beginner', label: 'Beginner' },
    { value: 'intermediate', label: 'Intermediate' },
    { value: 'advanced', label: 'Advanced' },
  ];

  // ADDED: Technology options
  const technologyOptions = [
    { value: '', label: 'All Technologies' },
    { value: 'arduino', label: 'Arduino' },
    { value: 'esp32', label: 'ESP32' },
    { value: 'esp8266', label: 'ESP8266' },
    { value: 'raspberry-pi', label: 'Raspberry Pi' },
    { value: 'stm32', label: 'STM32' },
    { value: 'pic', label: 'PIC' },
    { value: 'nodemcu', label: 'NodeMCU' },
  ];

  return (
    <div className="min-h-screen bg-secondary-50 fade-in">
      {/* Header */}
      <div className="bg-white border-b border-secondary-200">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <h1 className="text-3xl font-bold text-secondary-900 mb-2">
            Browse Projects
          </h1>
          <p className="text-secondary-600">
            Explore our collection of premium IoT and embedded systems projects
          </p>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Search and Filters */}
        <div className="bg-white rounded-xl shadow-sm border border-secondary-200 p-4 mb-8">
          <div className="flex flex-col lg:flex-row gap-4">
            {/* Search */}
            <form onSubmit={handleSearch} className="flex-1">
              <div className="relative">
                <HiSearch className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-secondary-400" />
                <input
                  type="text"
                  placeholder="Search projects..."
                  value={search}
                  onChange={(e) => setSearch(e.target.value)}
                  className="input pl-10"
                />
              </div>
            </form>

            {/* Filter Toggle (Mobile) */}
            <button
              onClick={() => setShowFilters(!showFilters)}
              className="lg:hidden btn btn-secondary"
            >
              <HiFilter className="w-5 h-5 mr-2" />
              Filters {(category || difficulty || technology || maxPrice !== '999') && 'â€¢'}
            </button>

            {/* Filters (Desktop) - ENHANCED */}
            <div className="hidden lg:flex items-center gap-3 flex-wrap">
              {/* Category */}
              <select
                value={category}
                onChange={(e) => {
                  setCategory(e.target.value);
                  setPage(1);
                }}
                className="input w-auto text-sm"
              >
                <option value="">All Categories</option>
                {categories.map((cat) => (
                  <option key={cat.category} value={cat.category}>
                    {cat.category} ({cat.count})
                  </option>
                ))}
              </select>

              {/* ADDED: Difficulty */}
              <select
                value={difficulty}
                onChange={(e) => {
                  setDifficulty(e.target.value);
                  setPage(1);
                }}
                className="input w-auto text-sm"
              >
                {difficultyOptions.map((option) => (
                  <option key={option.value} value={option.value}>
                    {option.label}
                  </option>
                ))}
              </select>

              {/* ADDED: Technology */}
              <select
                value={technology}
                onChange={(e) => {
                  setTechnology(e.target.value);
                  setPage(1);
                }}
                className="input w-auto text-sm"
              >
                {technologyOptions.map((option) => (
                  <option key={option.value} value={option.value}>
                    {option.label}
                  </option>
                ))}
              </select>

              {/* ADDED: Price Range */}
              <div className="flex items-center gap-2">
                <span className="text-sm text-secondary-600">Max:</span>
                <select
                  value={maxPrice}
                  onChange={(e) => {
                    setMaxPrice(e.target.value);
                    setPage(1);
                  }}
                  className="input w-auto text-sm"
                >
                  <option value="299">â‚¹299</option>
                  <option value="499">â‚¹499</option>
                  <option value="699">â‚¹699</option>
                  <option value="999">Any Price</option>
                </select>
              </div>

              {/* Sort */}
              <select
                value={sort}
                onChange={(e) => {
                  setSort(e.target.value);
                  setPage(1);
                }}
                className="input w-auto text-sm"
              >
                {sortOptions.map((option) => (
                  <option key={option.value} value={option.value}>
                    {option.label}
                  </option>
                ))}
              </select>

              {/* Clear Filters */}
              {(search || category || sort !== 'newest' || difficulty || technology || maxPrice !== '999') && (
                <button
                  onClick={clearFilters}
                  className="btn btn-secondary btn-sm"
                >
                  <HiX className="w-4 h-4 mr-1" />
                  Clear
                </button>
              )}
            </div>
          </div>

          {/* Mobile Filters - ENHANCED */}
          {showFilters && (
            <div className="lg:hidden mt-4 pt-4 border-t border-secondary-200 space-y-4 fade-in">
              <div>
                <label className="block text-sm font-medium text-secondary-700 mb-1">
                  Category
                </label>
                <select
                  value={category}
                  onChange={(e) => {
                    setCategory(e.target.value);
                    setPage(1);
                  }}
                  className="input"
                >
                  <option value="">All Categories</option>
                  {categories.map((cat) => (
                    <option key={cat.category} value={cat.category}>
                      {cat.category} ({cat.count})
                    </option>
                  ))}
                </select>
              </div>

              {/* ADDED: Difficulty for mobile */}
              <div>
                <label className="block text-sm font-medium text-secondary-700 mb-1">
                  Difficulty Level
                </label>
                <select
                  value={difficulty}
                  onChange={(e) => {
                    setDifficulty(e.target.value);
                    setPage(1);
                  }}
                  className="input"
                >
                  {difficultyOptions.map((option) => (
                    <option key={option.value} value={option.value}>
                      {option.label}
                    </option>
                  ))}
                </select>
              </div>

              {/* ADDED: Technology for mobile */}
              <div>
                <label className="block text-sm font-medium text-secondary-700 mb-1">
                  Technology
                </label>
                <select
                  value={technology}
                  onChange={(e) => {
                    setTechnology(e.target.value);
                    setPage(1);
                  }}
                  className="input"
                >
                  {technologyOptions.map((option) => (
                    <option key={option.value} value={option.value}>
                      {option.label}
                    </option>
                  ))}
                </select>
              </div>

              {/* ADDED: Price range for mobile */}
              <div>
                <label className="block text-sm font-medium text-secondary-700 mb-1">
                  Maximum Price
                </label>
                <select
                  value={maxPrice}
                  onChange={(e) => {
                    setMaxPrice(e.target.value);
                    setPage(1);
                  }}
                  className="input"
                >
                  <option value="299">Under â‚¹299</option>
                  <option value="499">Under â‚¹499</option>
                  <option value="699">Under â‚¹699</option>
                  <option value="999">Any Price</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-secondary-700 mb-1">
                  Sort By
                </label>
                <select
                  value={sort}
                  onChange={(e) => {
                    setSort(e.target.value);
                    setPage(1);
                  }}
                  className="input"
                >
                  {sortOptions.map((option) => (
                    <option key={option.value} value={option.value}>
                      {option.label}
                    </option>
                  ))}
                </select>
              </div>

              {(search || category || sort !== 'newest' || difficulty || technology || maxPrice !== '999') && (
                <button
                  onClick={clearFilters}
                  className="w-full btn btn-secondary"
                >
                  <HiX className="w-4 h-4 mr-1" />
                  Clear All Filters
                </button>
              )}
            </div>
          )}
        </div>

        {/* ADDED: Active Filters Display */}
        {(category || difficulty || technology || maxPrice !== '999') && (
          <div className="flex flex-wrap gap-2 mb-4">
            <span className="text-sm text-secondary-600">Active filters:</span>
            {category && (
              <span className="px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-sm flex items-center gap-1">
                {category}
                <button onClick={() => setCategory('')} className="hover:text-primary-900">
                  <HiX className="w-3 h-3" />
                </button>
              </span>
            )}
            {difficulty && (
              <span className="px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-sm flex items-center gap-1">
                {difficulty}
                <button onClick={() => setDifficulty('')} className="hover:text-primary-900">
                  <HiX className="w-3 h-3" />
                </button>
              </span>
            )}
            {technology && (
              <span className="px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-sm flex items-center gap-1">
                {technology}
                <button onClick={() => setTechnology('')} className="hover:text-primary-900">
                  <HiX className="w-3 h-3" />
                </button>
              </span>
            )}
            {maxPrice !== '999' && (
              <span className="px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-sm flex items-center gap-1">
                Max â‚¹{maxPrice}
                <button onClick={() => setMaxPrice('999')} className="hover:text-primary-900">
                  <HiX className="w-3 h-3" />
                </button>
              </span>
            )}
          </div>
        )}

        {/* Results Count */}
        {!loading && (
          <p className="text-secondary-600 mb-6">
            Showing {projects.length} of {pagination.total || 0} projects
            {search && ` for "${search}"`}
          </p>
        )}

        {/* Projects Grid */}
        {loading ? (
          <div className="flex justify-center py-12">
            <LoadingSpinner size="large" text="Loading projects..." />
          </div>
        ) : projects.length === 0 ? (
          <div className="text-center py-12">
            <div className="w-24 h-24 bg-secondary-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <HiSearch className="w-12 h-12 text-secondary-400" />
            </div>
            <h3 className="text-lg font-semibold text-secondary-900 mb-2">
              No projects found
            </h3>
            <p className="text-secondary-600 mb-4">
              Try adjusting your search or filter criteria
            </p>
            <button onClick={clearFilters} className="btn btn-primary">
              Clear Filters
            </button>
          </div>
        ) : (
          <>
            <div className="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
              {projects.map((project) => (
                <ProjectCard key={project.id} project={project} />
              ))}
            </div>

            {/* Pagination */}
            {pagination.pages > 1 && (
              <div className="flex justify-center items-center gap-2 mt-12">
                <button
                  onClick={() => setPage(page - 1)}
                  disabled={page === 1}
                  className="btn btn-secondary btn-sm"
                >
                  Previous
                </button>

                <div className="flex gap-1">
                  {[...Array(Math.min(5, pagination.pages))].map((_, i) => {
                    // Show first 5 pages or less
                    const pageNum = i + 1;
                    return (
                      <button
                        key={pageNum}
                        onClick={() => setPage(pageNum)}
                        className={`w-10 h-10 rounded-lg font-medium transition-colors ${
                          page === pageNum
                            ? 'bg-primary-600 text-white'
                            : 'bg-secondary-100 text-secondary-700 hover:bg-secondary-200'
                        }`}
                      >
                        {pageNum}
                      </button>
                    );
                  })}
                  {pagination.pages > 5 && (
                    <>
                      <span className="px-2">...</span>
                      <button
                        onClick={() => setPage(pagination.pages)}
                        className={`w-10 h-10 rounded-lg font-medium transition-colors ${
                          page === pagination.pages
                            ? 'bg-primary-600 text-white'
                            : 'bg-secondary-100 text-secondary-700 hover:bg-secondary-200'
                        }`}
                      >
                        {pagination.pages}
                      </button>
                    </>
                  )}
                </div>

                <button
                  onClick={() => setPage(page + 1)}
                  disabled={page === pagination.pages}
                  className="btn btn-secondary btn-sm"
                >
                  Next
                </button>
              </div>
            )}
          </>
        )}
      </div>
    </div>
  );
};

export default Projects;


================================================
FILE: frontend\src\pages\Refund.jsx
================================================
import { HiExclamationCircle, HiMail, HiPhone } from "react-icons/hi";

export default function Refund() {
  return (
    <div className="min-h-screen bg-secondary-50 fade-in py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-3xl mx-auto bg-white rounded-2xl shadow-sm border border-secondary-200 overflow-hidden">
        
        <div className="px-8 py-10">
          <h1 className="text-3xl font-bold text-secondary-900 mb-2">Refund Policy</h1>
          <p className="text-secondary-500 text-sm mb-8">Last updated: {new Date().toLocaleDateString()}</p>

          <div className="bg-red-50 border-l-4 border-red-500 p-4 mb-8">
            <div className="flex items-start">
              <div className="flex-shrink-0">
                <HiExclamationCircle className="h-5 w-5 text-red-500" />
              </div>
              <div className="ml-3">
                <h3 className="text-sm font-medium text-red-800">Digital Product Notice</h3>
                <div className="mt-2 text-sm text-red-700">
                  <p>Due to the nature of digital downloadable products, <strong>all sales are final</strong>. Once a purchase is completed, access is granted permanently, making refunds unavailable.</p>
                </div>
              </div>
            </div>
          </div>

          <div className="space-y-6 text-secondary-700">
            <section>
              <h2 className="text-xl font-semibold text-secondary-900 mb-3">Exceptions</h2>
              <p className="leading-relaxed">
                We stand by our quality. The only exception for a refund is if a payment is successfully charged but <strong>access to the file is NOT provided</strong> due to a platform technical error.
              </p>
            </section>

            <section>
              <h2 className="text-xl font-semibold text-secondary-900 mb-3">How to Request</h2>
              <p className="mb-4">
                If you face a technical delivery issue, please contact us within <strong>24 hours</strong> of purchase.
              </p>
              <div className="bg-secondary-50 p-4 rounded-lg border border-secondary-100">
                <div className="flex items-center gap-3 mb-2">
                  <HiMail className="text-primary-600" />
                  <a href="mailto:inovitaz.help@gmail.com" className="hover:underline font-medium">inovitaz.help@gmail.com</a>
                </div>
                <div className="flex items-center gap-3">
                  <HiPhone className="text-primary-600" />
                  <a href="tel:+919705594777" className="hover:underline font-medium">+91 9705594777</a>
                </div>
              </div>
            </section>

            <section>
              <h2 className="text-xl font-semibold text-secondary-900 mb-3">Abuse Policy</h2>
              <p>
                Any attempt to abuse this policy, initiate fraudulent chargebacks, or unauthorized distribution claims will result in a permanent ban from the platform and legal action where applicable.
              </p>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}


================================================
FILE: frontend\src\pages\Signup.jsx
================================================
ï»¿import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { HiMail, HiLockClosed, HiEye, HiEyeOff, HiUser, HiArrowRight } from 'react-icons/hi';
import { useAuth } from '../hooks/useAuth';
import toast from 'react-hot-toast';

const Signup = () => {
  const navigate = useNavigate();
  const { register, isAuthenticated } = useAuth();
  
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
    confirmPassword: '',
  });
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const [errors, setErrors] = useState({});
  const [agreedToTerms, setAgreedToTerms] = useState(false);

  if (isAuthenticated) {
    navigate('/dashboard', { replace: true });
    return null;
  }

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
    if (errors[name]) setErrors((prev) => ({ ...prev, [name]: '' }));
  };

  const validate = () => {
    const newErrors = {};
    if (!formData.name.trim()) newErrors.name = 'Name is required';
    else if (formData.name.trim().length < 2) newErrors.name = 'Name must be at least 2 characters';
    
    if (!formData.email) newErrors.email = 'Email is required';
    else if (!/\S+@\S+\.\S+/.test(formData.email)) newErrors.email = 'Invalid email format';
    
    if (!formData.password) newErrors.password = 'Password is required';
    else if (formData.password.length < 6) newErrors.password = 'Password must be at least 6 characters';
    
    if (formData.password !== formData.confirmPassword) newErrors.confirmPassword = 'Passwords do not match';
    if (!agreedToTerms) newErrors.terms = 'You must agree to the terms';

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validate()) return;

    setLoading(true);
    try {
      const result = await register({
        name: formData.name,
        email: formData.email,
        password: formData.password,
      });
      if (result.success) {
        toast.success('Account created successfully!');
        navigate('/dashboard', { replace: true });
      }
    } catch (error) {
      toast.error(error.message || 'Registration failed');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex bg-white fade-in">
      {/* Left Side - Form */}
      <div className="flex-1 flex items-center justify-center px-4 sm:px-6 lg:px-8 py-12">
        <div className="w-full max-w-md space-y-8">
          <div>
            <Link to="/" className="flex items-center gap-2 mb-6">
              <div className="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-700 rounded-lg flex items-center justify-center">
                <span className="text-white font-bold text-xl">I</span>
              </div>
              <span className="text-xl font-bold text-secondary-900">Inovitaz</span>
            </Link>
            <h2 className="text-3xl font-bold text-gray-900">Create an account</h2>
            <p className="mt-2 text-sm text-gray-600">Join thousands of makers building the future.</p>
          </div>

          <form className="mt-8 space-y-5" onSubmit={handleSubmit}>
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <HiUser className="h-5 w-5 text-gray-400" />
                </div>
                <input
                  name="name"
                  type="text"
                  value={formData.name}
                  onChange={handleChange}
                  className={`input pl-10 w-full ${errors.name ? 'border-red-500' : ''}`}
                  placeholder="John Doe"
                />
              </div>
              {errors.name && <p className="mt-1 text-xs text-red-600">{errors.name}</p>}
            </div>

            {/* Email */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <HiMail className="h-5 w-5 text-gray-400" />
                </div>
                <input
                  name="email"
                  type="email"
                  value={formData.email}
                  onChange={handleChange}
                  className={`input pl-10 w-full ${errors.email ? 'border-red-500' : ''}`}
                  placeholder="you@example.com"
                />
              </div>
              {errors.email && <p className="mt-1 text-xs text-red-600">{errors.email}</p>}
            </div>

            {/* Password */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <HiLockClosed className="h-5 w-5 text-gray-400" />
                </div>
                <input
                  name="password"
                  type={showPassword ? 'text' : 'password'}
                  value={formData.password}
                  onChange={handleChange}
                  className={`input pl-10 pr-10 w-full ${errors.password ? 'border-red-500' : ''}`}
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                />
                <button
                  type="button"
                  className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
                  onClick={() => setShowPassword(!showPassword)}
                >
                  {showPassword ? <HiEyeOff className="h-5 w-5" /> : <HiEye className="h-5 w-5" />}
                </button>
              </div>
              {errors.password && <p className="mt-1 text-xs text-red-600">{errors.password}</p>}
            </div>

            {/* Confirm Password */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <HiLockClosed className="h-5 w-5 text-gray-400" />
                </div>
                <input
                  name="confirmPassword"
                  type={showConfirmPassword ? 'text' : 'password'}
                  value={formData.confirmPassword}
                  onChange={handleChange}
                  className={`input pl-10 pr-10 w-full ${errors.confirmPassword ? 'border-red-500' : ''}`}
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                />
                <button
                  type="button"
                  className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                >
                  {showConfirmPassword ? <HiEyeOff className="h-5 w-5" /> : <HiEye className="h-5 w-5" />}
                </button>
              </div>
              {errors.confirmPassword && <p className="mt-1 text-xs text-red-600">{errors.confirmPassword}</p>}
            </div>

            {/* Terms */}
            <div className="flex items-start">
              <input
                id="terms"
                type="checkbox"
                checked={agreedToTerms}
                onChange={(e) => setAgreedToTerms(e.target.checked)}
                className="h-4 w-4 mt-1 text-primary-600 border-gray-300 rounded focus:ring-primary-500"
              />
              <label htmlFor="terms" className="ml-2 block text-sm text-gray-600">
                I agree to the <Link to="/terms" className="text-primary-600 hover:underline">Terms</Link> and <Link to="/privacy" className="text-primary-600 hover:underline">Privacy Policy</Link>
              </label>
            </div>
            {errors.terms && <p className="text-xs text-red-600">{errors.terms}</p>}

            <button
              type="submit"
              disabled={loading}
              className="w-full btn btn-primary flex justify-center items-center gap-2 py-3 shadow-lg hover:shadow-xl transition-all"
            >
              {loading ? (
                <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
              ) : (
                <>Create Account <HiArrowRight /></>
              )}
            </button>
          </form>

          <p className="mt-2 text-center text-sm text-gray-600">
            Already have an account?{' '}
            <Link to="/login" className="font-medium text-primary-600 hover:text-primary-500">
              Sign in instead
            </Link>
          </p>
        </div>
      </div>

      {/* Right Side - Art */}
      <div className="hidden lg:flex flex-1 bg-secondary-900 relative overflow-hidden items-center justify-center">
        <div className="absolute inset-0 bg-gradient-to-bl from-primary-700 to-secondary-900 opacity-90" />
        <div className="absolute inset-0" style={{ backgroundImage: 'url("https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=1600&q=80")', backgroundSize: 'cover', backgroundPosition: 'center', mixBlendMode: 'overlay' }}></div>
        <div className="relative z-10 text-center px-8">
          <h2 className="text-4xl font-bold text-white mb-4">Join the Community</h2>
          <p className="text-primary-100 text-lg max-w-md mx-auto">Access premium projects and connect with fellow engineers.</p>
        </div>
      </div>
    </div>
  );
};

export default Signup;


================================================
FILE: frontend\src\pages\Support.jsx
================================================
import { useState } from "react";
import { 
  HiMail, 
  HiPhone, 
  HiChat, 
  HiLocationMarker, 
  HiChevronDown, 
  HiChevronUp,
  HiQuestionMarkCircle 
} from "react-icons/hi";

export default function Support() {
  return (
    <div className="min-h-screen bg-secondary-50 fade-in">
      
      {/* 1. Hero Section */}
      <div className="bg-gradient-to-br from-primary-700 to-primary-900 text-white py-16">
        <div className="max-w-4xl mx-auto px-6 text-center">
          <h1 className="text-4xl font-bold mb-4">How can we help you?</h1>
          <p className="text-primary-100 text-lg max-w-2xl mx-auto">
            Whether you have a question about a project, pricing, or need technical assistance, our team is ready to answer all your questions.
          </p>
        </div>
      </div>

      {/* 2. Contact Cards - Floating overlap */}
      <div className="max-w-7xl mx-auto px-6 -mt-10 pb-16">
        <div className="grid gap-6 md:grid-cols-3">
          
          {/* WhatsApp */}
          <div className="bg-white rounded-2xl shadow-lg p-8 text-center border border-secondary-100 hover:-translate-y-1 transition-transform duration-300">
            <div className="w-14 h-14 mx-auto bg-green-100 rounded-full flex items-center justify-center mb-4">
              <HiChat className="w-7 h-7 text-green-600" />
            </div>
            <h2 className="text-xl font-bold text-secondary-900 mb-2">Chat on WhatsApp</h2>
            <p className="text-secondary-500 mb-6 text-sm">
              Fastest way to get answers. <br/>Available 9 AM - 9 PM.
            </p>
            <a
              href="https://wa.me/919705594777"
              target="_blank"
              rel="noreferrer"
              className="block w-full py-2.5 rounded-lg font-semibold bg-green-500 hover:bg-green-600 text-white transition-colors"
            >
              Start Chat
            </a>
          </div>

          {/* Email */}
          <div className="bg-white rounded-2xl shadow-lg p-8 text-center border border-secondary-100 hover:-translate-y-1 transition-transform duration-300">
            <div className="w-14 h-14 mx-auto bg-blue-100 rounded-full flex items-center justify-center mb-4">
              <HiMail className="w-7 h-7 text-blue-600" />
            </div>
            <h2 className="text-xl font-bold text-secondary-900 mb-2">Send an Email</h2>
            <p className="text-secondary-500 mb-6 text-sm">
              For detailed technical queries. <br/>Response within 24 hours.
            </p>
            <a
              href="mailto:inovitaz.help@gmail.com"
              className="block w-full py-2.5 rounded-lg font-semibold bg-blue-600 hover:bg-blue-700 text-white transition-colors"
            >
              Compose Email
            </a>
          </div>

          {/* Phone */}
          <div className="bg-white rounded-2xl shadow-lg p-8 text-center border border-secondary-100 hover:-translate-y-1 transition-transform duration-300">
            <div className="w-14 h-14 mx-auto bg-purple-100 rounded-full flex items-center justify-center mb-4">
              <HiPhone className="w-7 h-7 text-purple-600" />
            </div>
            <h2 className="text-xl font-bold text-secondary-900 mb-2">Call Us</h2>
            <p className="text-secondary-500 mb-6 text-sm">
              Speak directly to our team. <br/>Mon â€” Fri, 9 AM â€” 6 PM.
            </p>
            <a
              href="tel:+919705594777"
              className="block w-full py-2.5 rounded-lg font-semibold bg-purple-600 hover:bg-purple-700 text-white transition-colors"
            >
              +91 9705594777
            </a>
          </div>
        </div>

        {/* 3. FAQ Section */}
        <div className="mt-20 max-w-3xl mx-auto">
          <div className="text-center mb-10">
            <h2 className="text-2xl font-bold text-secondary-900 flex items-center justify-center gap-2">
              <HiQuestionMarkCircle className="text-primary-500" />
              Frequently Asked Questions
            </h2>
          </div>
          
          <div className="space-y-4">
            <FAQItem 
              question="Do the projects come with source code?" 
              answer="Yes! Every purchase includes the complete source code, circuit diagrams, and a documentation PDF explaining how to set it up." 
            />
            <FAQItem 
              question="Is the hardware included?" 
              answer="No, Inovitaz is a digital marketplace. We provide the code and schematics. You will need to purchase the hardware components (like Arduino, ESP32) separately from electronics vendors." 
            />
            <FAQItem 
              question="What if the code doesn't work?" 
              answer="Our code is tested before listing. However, if you face issues, you can contact our technical support via WhatsApp or Email for assistance." 
            />
            <FAQItem 
              question="Can I get a refund?" 
              answer="Since these are digital products, refunds are generally not provided once downloaded. However, if there is a genuine technical defect we cannot fix, we will review refund requests on a case-by-case basis." 
            />
          </div>
        </div>

        {/* 4. Location Footer */}
        <div className="mt-20 pt-10 border-t border-secondary-200 text-center">
          <div className="inline-flex items-center gap-2 px-4 py-2 bg-secondary-100 rounded-full text-secondary-600 text-sm font-medium">
            <HiLocationMarker className="w-4 h-4 text-primary-600" />
            Amaravathi, Andhra Pradesh, India
          </div>
        </div>

      </div>
    </div>
  );
}

// Helper Component for Accordion
function FAQItem({ question, answer }) {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <div className="bg-white border border-secondary-200 rounded-xl overflow-hidden">
      <button 
        onClick={() => setIsOpen(!isOpen)}
        className="w-full px-6 py-4 text-left flex justify-between items-center hover:bg-secondary-50 transition-colors"
      >
        <span className="font-semibold text-secondary-900">{question}</span>
        {isOpen ? <HiChevronUp className="text-primary-500" /> : <HiChevronDown className="text-secondary-400" />}
      </button>
      {isOpen && (
        <div className="px-6 pb-4 text-secondary-600 text-sm leading-relaxed border-t border-secondary-100 bg-secondary-50/50">
          {answer}
        </div>
      )}
    </div>
  );
}


================================================
FILE: frontend\src\pages\Terms.jsx
================================================
export default function Terms() {
  return (
    <div className="min-h-screen bg-secondary-50 fade-in py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-3xl mx-auto bg-white rounded-2xl shadow-sm border border-secondary-200 px-8 py-10">
        <h1 className="text-3xl font-bold text-secondary-900 mb-2">Terms & Conditions</h1>
        <p className="text-secondary-500 text-sm mb-8">Last updated: {new Date().toLocaleDateString()}</p>

        <div className="space-y-8 text-secondary-700">
          <section>
            <h2 className="text-xl font-semibold text-secondary-900 mb-3">1. Intellectual Property</h2>
            <p className="leading-relaxed">
              All content, source code, designs, and documentation sold on <strong>Inovitaz Innovations Pvt. Ltd.</strong> are the exclusive intellectual property of Inovitaz. Purchasing a project grants you a <strong>personal, non-exclusive license</strong> to use the files for academic or personal learning purposes only.
            </p>
          </section>

          <section>
            <h2 className="text-xl font-semibold text-secondary-900 mb-3">2. Prohibited Uses</h2>
            <ul className="list-disc pl-5 space-y-2">
              <li>Reselling, redistributing, or publishing our code/files online.</li>
              <li>Using our projects for commercial mass production without a commercial license.</li>
              <li>Sharing your account credentials to allow others to download files.</li>
            </ul>
          </section>

          <section>
            <h2 className="text-xl font-semibold text-secondary-900 mb-3">3. User Accounts</h2>
            <p>
              We reserve the right to suspend or terminate accounts found violating these terms, sharing purchased content illegally, or engaging in fraudulent activity.
            </p>
          </section>

          <section>
            <h2 className="text-xl font-semibold text-secondary-900 mb-3">4. Limitation of Liability</h2>
            <p>
              Inovitaz provides project files "as-is" for educational purposes. We are not liable for hardware damage, project failure, academic grading results, or any direct/indirect damages arising from the use of our products. Hardware safety is the user's responsibility.
            </p>
          </section>
        </div>
      </div>
    </div>
  );
}


================================================
FILE: frontend\tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    './index.html',
    './src/**/*.{js,jsx,ts,tsx}',
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#eff6ff',
          100: '#dbeafe',
          200: '#bfdbfe',
          300: '#93c5fd',
          400: '#60a5fa',
          500: '#3b82f6',
          600: '#2563eb',
          700: '#1d4ed8',
          800: '#1e40af',
          900: '#1e3a8a',
        },
        secondary: {
          50: '#f8fafc',
          100: '#f1f5f9',
          200: '#e2e8f0',
          300: '#cbd5e1',
          400: '#94a3b8',
          500: '#64748b',
          600: '#475569',
          700: '#334155',
          800: '#1e293b',
          900: '#0f172a',
        },
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      },
    },
  },
  plugins: [],
};


================================================
FILE: frontend\vite.config.js
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  server: {
    host: true,   // so you can open it from mobile on same Wi-Fi
    port: 5173,
  },
});


================================================
FILE: README.md
================================================

```
inovitaz-app
â”œâ”€ backend
â”‚  â”œâ”€ .env
â”‚  â”œâ”€ .env.example
â”‚  â”œâ”€ package-lock.json
â”‚  â”œâ”€ package.json
â”‚  â”œâ”€ scripts
â”‚  â”‚  â””â”€ setup-db.js
â”‚  â”œâ”€ server.js
â”‚  â”œâ”€ sql
â”‚  â”‚  â””â”€ schema.sql
â”‚  â”œâ”€ src
â”‚  â”‚  â”œâ”€ config
â”‚  â”‚  â”‚  â””â”€ db.js
â”‚  â”‚  â”œâ”€ controllers
â”‚  â”‚  â”‚  â”œâ”€ admin.controller.js
â”‚  â”‚  â”‚  â”œâ”€ auth.controller.js
â”‚  â”‚  â”‚  â”œâ”€ coupon.controller.js
â”‚  â”‚  â”‚  â”œâ”€ order.controller.js
â”‚  â”‚  â”‚  â”œâ”€ payment.controller.js
â”‚  â”‚  â”‚  â”œâ”€ project.controller.js
â”‚  â”‚  â”‚  â”œâ”€ review.controller.js
â”‚  â”‚  â”‚  â””â”€ wishlist.controller.js
â”‚  â”‚  â”œâ”€ middlewares
â”‚  â”‚  â”‚  â”œâ”€ auth.middleware.js
â”‚  â”‚  â”‚  â”œâ”€ authOptional.js
â”‚  â”‚  â”‚  â””â”€ error.middleware.js
â”‚  â”‚  â”œâ”€ models
â”‚  â”‚  â”‚  â”œâ”€ payment.model.js
â”‚  â”‚  â”‚  â”œâ”€ project.model.js
â”‚  â”‚  â”‚  â””â”€ user.model.js
â”‚  â”‚  â”œâ”€ routes
â”‚  â”‚  â”‚  â”œâ”€ admin.routes.js
â”‚  â”‚  â”‚  â”œâ”€ auth.routes.js
â”‚  â”‚  â”‚  â”œâ”€ coupon.routes.js
â”‚  â”‚  â”‚  â”œâ”€ order.routes.js
â”‚  â”‚  â”‚  â”œâ”€ payment.routes.js
â”‚  â”‚  â”‚  â”œâ”€ project.routes.js
â”‚  â”‚  â”‚  â”œâ”€ review.routes.js
â”‚  â”‚  â”‚  â””â”€ wishlist.routes.js
â”‚  â”‚  â”œâ”€ services
â”‚  â”‚  â”‚  â””â”€ razorpay.js
â”‚  â”‚  â””â”€ utils
â”‚  â”‚     â”œâ”€ jwt.js
â”‚  â”‚     â””â”€ validator.js
â”‚  â””â”€ test-db.js
â””â”€ frontend
   â”œâ”€ .env
   â”œâ”€ eslint.config.js
   â”œâ”€ index.html
   â”œâ”€ package-lock.json
   â”œâ”€ package.json
   â”œâ”€ postcss.config.js
   â”œâ”€ public
   â”‚  â”œâ”€ hero-iot.png
   â”‚  â”œâ”€ InovitaZ.png
   â”‚  â”œâ”€ n.png
   â”‚  â””â”€ vite.svg
   â”œâ”€ README.md
   â”œâ”€ src
   â”‚  â”œâ”€ api
   â”‚  â”‚  â”œâ”€ auth.js
   â”‚  â”‚  â”œâ”€ axios.js
   â”‚  â”‚  â”œâ”€ payments.js
   â”‚  â”‚  â””â”€ projects.js
   â”‚  â”œâ”€ App.css
   â”‚  â”œâ”€ App.jsx
   â”‚  â”œâ”€ assets
   â”‚  â”‚  â””â”€ react.svg
   â”‚  â”œâ”€ components
   â”‚  â”‚  â”œâ”€ AdminRoute.jsx
   â”‚  â”‚  â”œâ”€ BuyModal.jsx
   â”‚  â”‚  â”œâ”€ Footer.jsx
   â”‚  â”‚  â”œâ”€ LoadingSpinner.jsx
   â”‚  â”‚  â”œâ”€ Navbar.jsx
   â”‚  â”‚  â”œâ”€ PaymentModal.jsx
   â”‚  â”‚  â”œâ”€ ProjectCard.jsx
   â”‚  â”‚  â”œâ”€ ProtectedRoute.jsx
   â”‚  â”‚  â””â”€ ScrollToTop.jsx
   â”‚  â”œâ”€ context
   â”‚  â”‚  â””â”€ AuthContext.jsx
   â”‚  â”œâ”€ hooks
   â”‚  â”‚  â””â”€ useAuth.js
   â”‚  â”œâ”€ index.css
   â”‚  â”œâ”€ layout
   â”‚  â”‚  â””â”€ MainLayout.jsx
   â”‚  â”œâ”€ lib
   â”‚  â”‚  â””â”€ payments.js
   â”‚  â”œâ”€ main.jsx
   â”‚  â””â”€ pages
   â”‚     â”œâ”€ About.jsx
   â”‚     â”œâ”€ AdminDashboard.jsx
   â”‚     â”œâ”€ Dashboard.jsx
   â”‚     â”œâ”€ Home.jsx
   â”‚     â”œâ”€ Login.jsx
   â”‚     â”œâ”€ NotFound.jsx
   â”‚     â”œâ”€ Privacy.jsx
   â”‚     â”œâ”€ ProjectDetails.jsx
   â”‚     â”œâ”€ Projects.jsx
   â”‚     â”œâ”€ Refund.jsx
   â”‚     â”œâ”€ Signup.jsx
   â”‚     â”œâ”€ Support.jsx
   â”‚     â””â”€ Terms.jsx
   â”œâ”€ tailwind.config.js
   â””â”€ vite.config.js

```

